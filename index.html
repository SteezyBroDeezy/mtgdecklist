<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deck Skeleton + Mana Calculator - MTG Commander Deck Builder</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Crimson+Text:wght@400;600;700&family=Pirata+One&family=MedievalSharp&family=UnifrakturMaguntia:wght@400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --white-mana: #F0E68C;
            --blue-mana: #0E4C92;
            --black-mana: #150B00;
            --red-mana: #D3202A;
            --green-mana: #00733E;
            --colorless-mana: #CAC5C0;
            
            /* Bone/Rustic Theme */
            --bg-primary: #1a1612;
            --bg-secondary: #2a241f;
            --bg-tertiary: #3a3228;
            --bg-card: #4a3d30;
            --border-color: #6b5d4f;
            --text-primary: #f5ebe0;
            --text-secondary: #d4c4b0;
            --text-muted: #a89884;
            --accent: #8b6f47;
            --accent-bright: #c9a772;
            --gold: #d4af37;
            --bone: #e8dcc4;
            --rust: #8b4513;
            
            --gradient-mystical: linear-gradient(135deg, #2a241f 0%, #3a2820 50%, #2a241f 100%);
            --gradient-card: linear-gradient(160deg, #4a3d30 0%, #3a2f24 100%);
        }

        body {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            font-weight: 600;
            background: linear-gradient(135deg, #1a1612 0%, #2d1f1a 35%, #1a1612 70%, #0f0d0b 100%);
            color: var(--text-primary);
            min-height: 100vh;
            background-attachment: fixed;
        }

        .app-header {
            background: var(--gradient-mystical);
            border-bottom: 2px solid var(--border-color);
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Pirata One', cursive;
            font-size: 2.2rem;
            font-weight: 400;
            background: linear-gradient(135deg, var(--bone) 0%, var(--gold) 50%, var(--bone) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            cursor: pointer;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 2px;
        }

        .logo-subtitle {
            font-size: 0.75rem;
            color: var(--text-secondary);
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-top: 0.3rem;
            font-family: 'MedievalSharp', cursive;
        }

        .btn {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            font-family: 'Cinzel', serif;
            letter-spacing: 1px;
        }

        input, select, textarea {
            font-size: 1.1rem !important;
            font-weight: 600 !important;
            font-family: 'Cinzel', serif !important;
        }

        label {
            font-size: 1.2rem !important;
            font-weight: 700 !important;
            font-family: 'Cinzel', serif !important;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Cinzel', serif !important;
            font-weight: 900 !important;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .hero {
            text-align: center;
            padding: 4rem 2rem 2rem 2rem;
            position: relative;
        }

        .hero h1 {
            font-family: 'Cinzel', serif;
            font-size: 3.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--gold) 0%, var(--accent-bright) 50%, var(--gold) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-bright) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-primary:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.5);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: var(--bg-card);
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.2);
        }

        @keyframes subtle-glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
            }
            50% {
                box-shadow: 0 0 40px rgba(212, 175, 55, 0.4);
            }
        }

        .featured-calculator-box {
            animation: subtle-glow 3s ease-in-out infinite;
        }

        .deck-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .deck-card {
            background: var(--gradient-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .deck-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
        }

        .mana-pip {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
        }

        .pip-W { background: var(--white-mana); }
        .pip-U { background: var(--blue-mana); }
        .pip-B { background: var(--black-mana); }
        .pip-R { background: var(--red-mana); }
        .pip-G { background: var(--green-mana); }
        .pip-C { background: var(--colorless-mana); }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal {
            background: var(--gradient-card);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            max-width: 1400px;
            width: 100%;
            max-height: 95vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-card);
        }

        .modal-title {
            font-family: 'Cinzel Decorative', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--gold);
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 2rem;
            cursor: pointer;
        }

        .modal-content-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .modal-body {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .stats-panel {
            width: 400px;
            background: var(--bg-secondary);
            border-left: 2px solid var(--border-color);
            padding: 1.5rem;
            overflow-y: auto;
        }

        .form-input {
            width: 100%;
            padding: 0.8rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .color-picker {
            display: flex;
            gap: 0.8rem;
            margin-top: 0.5rem;
        }

        .color-option {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 3px solid var(--bg-secondary);
            cursor: pointer;
            transition: all 0.3s;
        }

        .color-option.selected {
            border-color: var(--gold);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }

        .color-option.selected::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            text-shadow: 0 0 3px black;
        }

        .color-option.pip-C.selected::after {
            content: '‚úì';
        }

        /* Commander Card Preview */
        .commander-preview {
            margin: 1rem 0;
            text-align: center;
        }

        .commander-card-image {
            max-width: 250px;
            border-radius: 12px;
            border: 2px solid var(--accent);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }

        /* Mana Base Calculator */
        .mana-calculator {
            background: var(--bg-tertiary);
            border: 2px solid var(--accent);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .calculator-title {
            font-family: 'Cinzel Decorative', serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 1rem;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .pip-counter {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .pip-input-group {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .pip-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .pip-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .small-input {
            width: 80px;
            padding: 0.5rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            text-align: center;
        }

        .dual-land-input {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .mana-results {
            background: var(--bg-secondary);
            border: 2px solid var(--green-mana);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .result-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .result-value {
            color: var(--accent-bright);
            font-size: 1.2rem;
            font-weight: 700;
        }

        .category-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.8rem;
        }

        .subcategories {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 0.6rem;
        }

        .number-input {
            width: 55px;
            padding: 0.4rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            text-align: center;
        }

        .notable-card-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .card-preview {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.8rem;
            position: relative;
        }

        .card-preview-image {
            width: 100%;
            border-radius: 6px;
        }

        .card-remove {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--red-mana);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
        }

        @media (max-width: 1200px) {
            .modal-content-wrapper {
                flex-direction: column;
            }
            .stats-panel {
                width: 100%;
                border-left: none;
                border-top: 2px solid var(--border-color);
                max-height: 400px;
            }
        }

        @media (max-width: 768px) {
            .pip-counter {
                grid-template-columns: 1fr;
            }
            .pip-input-group {
                min-width: auto;
            }
            .hero h1 {
                font-size: 2.2rem;
            }
            .hero {
                padding: 2rem 1rem;
            }
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            .header-content > div {
                width: 100%;
                justify-content: center;
            }
        }

        /* ============================================ */
        /* AGGRESSIVE MOBILE OPTIMIZATION */
        /* Hide text-heavy content, focus on actions */
        /* ============================================ */
        
        @media (max-width: 768px) {
            /* Hide text-heavy intro sections on mobile */
            .mobile-hide {
                display: none !important;
            }
            
            /* Show mobile simplified home, hide desktop version */
            .mobile-simple-home {
                display: block !important;
            }
            
            .desktop-home-content {
                display: none !important;
            }
            
            /* Mobile homepage - simplified */
            .mobile-simple-home {
                padding: 1rem;
                max-width: 100%;
            }
            
            /* Mobile action buttons - big and full width */
            .mobile-action-button {
                width: 100%;
                padding: 1.5rem !important;
                font-size: 1.3rem !important;
                margin-bottom: 1rem;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 1rem;
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            }
            
            .mobile-action-button span {
                font-size: 1.8rem;
            }
            
            /* Mana calculator - simplified on mobile */
            .mana-calc-mobile {
                padding: 1rem;
            }
            
            .mana-calc-mobile h2 {
                font-size: 1.5rem;
                margin-bottom: 1rem;
            }
            
            /* Hide verbose explanations in calculator */
            .calc-explanation {
                display: none;
            }
            
            /* Mobile input groups - bigger touch targets */
            .mobile-input-group {
                margin-bottom: 1.5rem;
            }
            
            .mobile-input-group label {
                font-size: 1.1rem;
                font-weight: 600;
                margin-bottom: 0.5rem;
                display: block;
            }
            
            .mobile-number-input {
                display: flex;
                align-items: center;
                gap: 1rem;
                margin-bottom: 1rem;
            }
            
            .mobile-number-input button {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
                border-radius: 8px;
                border: 2px solid var(--gold);
                background: var(--bg-tertiary);
                color: var(--gold);
                cursor: pointer;
            }
            
            .mobile-number-input input {
                flex: 1;
                text-align: center;
                font-size: 1.3rem;
                padding: 0.75rem;
                border-radius: 8px;
            }
            
            /* Browse decks - full width cards */
            .mobile-deck-card {
                width: 100%;
                margin-bottom: 1rem;
            }
            
            /* Modal on mobile - full screen */
            .mobile-modal {
                width: 100% !important;
                height: 100% !important;
                max-width: 100% !important;
                max-height: 100% !important;
                border-radius: 0 !important;
                padding: 1rem !important;
            }
            
            /* Header on mobile - compact */
            .app-header {
                padding: 0.75rem 0.5rem;
            }
            
            .header-content {
                gap: 0.5rem;
            }
            
            .header-content button {
                padding: 0.75rem 1rem !important;
                font-size: 1rem !important;
            }
            
            /* Logo smaller on mobile */
            .logo {
                font-size: 1.2rem !important;
            }
            
            .logo-subtitle {
                font-size: 0.7rem !important;
            }
            
            /* Collapsible sections on mobile */
            .mobile-collapsible {
                border: 2px solid var(--border-color);
                border-radius: 8px;
                margin-bottom: 1rem;
                overflow: hidden;
            }
            
            .mobile-collapsible-header {
                padding: 1rem;
                background: var(--bg-secondary);
                cursor: pointer;
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-weight: 600;
            }
            
            .mobile-collapsible-content {
                padding: 1rem;
                background: var(--bg-tertiary);
            }
            
            /* Browse search and sort - stacked on mobile */
            .mobile-browse-controls {
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-bottom: 1rem;
            }
            
            .mobile-browse-controls input,
            .mobile-browse-controls select {
                width: 100%;
                font-size: 1.1rem;
                padding: 1rem;
            }
            
            /* Deck stats - bigger on mobile */
            .mobile-deck-stats {
                font-size: 1rem;
                display: flex;
                gap: 1.5rem;
                justify-content: center;
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
  // Your Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBjwMNNj6k2kzCJNNh6jMLd2vvUN8NUhuE",
    authDomain: "mtg-decklist-app.firebaseapp.com",
    projectId: "mtg-decklist-app",
    storageBucket: "mtg-decklist-app.firebasestorage.app",
    messagingSenderId: "948508221922",
    appId: "1:948508221922:web:367f67f7109c92a99799bb"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  
  console.log("Firebase initialized!");
</script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // Enhanced category structure with exile wipes
        const DECK_CATEGORIES = {
            lands: {
                name: 'üèû Lands',
                icon: 'üèû',
                categories: [
                    {
                        id: 'basics',
                        name: 'Basic Lands',
                        subcategories: [
                            { id: 'plains', name: 'Plains', defaultValue: 0, description: 'Basic land that taps for white mana' },
                            { id: 'islands', name: 'Islands', defaultValue: 0, description: 'Basic land that taps for blue mana' },
                            { id: 'swamps', name: 'Swamps', defaultValue: 0, description: 'Basic land that taps for black mana' },
                            { id: 'mountains', name: 'Mountains', defaultValue: 0, description: 'Basic land that taps for red mana' },
                            { id: 'forests', name: 'Forests', defaultValue: 0, description: 'Basic land that taps for green mana' },
                            { id: 'wastes', name: 'Wastes', defaultValue: 0, description: 'Basic land that taps for colorless mana' }
                        ]
                    },
                    {
                        id: 'nonbasics',
                        name: 'Non-Basic Lands',
                        subcategories: [
                            { id: 'duals', name: 'Dual Lands', defaultValue: 0, description: 'Lands that produce two colors (Check lands, Pain lands, Tango lands, etc.)' },
                            { id: 'trilands', name: 'Tri-Lands', defaultValue: 0, description: 'Lands that produce three colors (Triomes, Arcane Sanctum, etc.)' },
                            { id: 'fetches', name: 'Fetch Lands', defaultValue: 0, description: 'Search for other lands (Evolving Wilds, Terramorphic Expanse, Prismatic Vista)' },
                            { id: 'shocks', name: 'Shock Lands', defaultValue: 0, description: 'Dual lands that can enter untapped for 2 life (Temple Garden, Watery Grave, etc.)' },
                            { id: 'utility', name: 'Utility Lands', defaultValue: 0, description: 'Lands with special abilities (Reliquary Tower, Rogue\'s Passage, Yavimaya Cradle)' },
                            { id: 'creature-lands', name: 'Creature Lands', defaultValue: 0, description: 'Lands that become creatures (Mutavault, Celestial Colonnade, manlands)' },
                            { id: 'mdfc-lands', name: 'MDFC Lands', defaultValue: 0, description: 'Modal double-faced cards with land on back (Pathway lands, Zendikar MDFCs)' }
                        ]
                    }
                ]
            },
            creatures: {
                name: 'üßü Creatures',
                icon: 'üßü',
                categories: [
                    {
                        id: 'mana-creatures',
                        name: 'Ramp Creatures',
                        subcategories: [
                            { id: 'dorks', name: 'Mana Dorks', defaultValue: 0, description: 'Creatures that tap for mana (Birds of Paradise, Llanowar Elves, Faeburrow Elder)' },
                            { id: 'land-creatures', name: 'Land Fetch Creatures', defaultValue: 0, description: 'Creatures that search for lands (Wood Elves, Farhaven Elf, Solemn Simulacrum)' },
                            { id: 'treasure-creatures', name: 'Treasure Makers', defaultValue: 0, description: 'Creatures that create treasure tokens (Dockside Extortionist, Pitiless Plunderer)' }
                        ]
                    },
                    {
                        id: 'draw-creatures',
                        name: 'Card Draw Creatures',
                        subcategories: [
                            { id: 'draw-etb', name: 'Draw on ETB', defaultValue: 0, description: 'Draw cards when creature enters (Mulldrifter, Wall of Omens, Elvish Visionary)' },
                            { id: 'draw-death', name: 'Draw on Death', defaultValue: 0, description: 'Draw when creature or others die (Grim Haruspex, Midnight Reaper, Skullclamp targets)' },
                            { id: 'draw-attack', name: 'Draw on Attack/Damage', defaultValue: 0, description: 'Draw when attacking or dealing damage (Tymna, Edric, Bident of Thassa creatures)' },
                            { id: 'tutor-creatures', name: 'Tutor Creatures', defaultValue: 0, description: 'Search your library for specific cards (Recruiter of the Guard, Imperial Recruiter)' },
                            { id: 'looting-creatures', name: 'Looting Creatures', defaultValue: 0, description: 'Draw then discard (Merfolk Looter, Looter il-Kor, rummaging effects)' }
                        ]
                    },
                    {
                        id: 'removal-creatures',
                        name: 'Removal Creatures',
                        subcategories: [
                            { id: 'etb-removal', name: 'ETB Removal', defaultValue: 0, description: 'Remove permanents when entering (Ravenous Chupacabra, Reclamation Sage)' },
                            { id: 'fight-creatures', name: 'Fight Creatures', defaultValue: 0, description: 'Creatures that fight or use power-based removal (Kogla, Apex Devastator triggers)' },
                            { id: 'exile-creatures', name: 'Exile Effects', defaultValue: 0, description: 'Exile instead of destroy (Containment Priest, Angel of Serenity)' },
                            { id: 'bounce-creatures', name: 'Bounce Creatures', defaultValue: 0, description: 'Return permanents to hand (Man-o\'-War, Venser Shaper Savant)' }
                        ]
                    },
                    {
                        id: 'sac-creatures',
                        name: 'Sacrifice Outlets',
                        subcategories: [
                            { id: 'free-sac', name: 'Free Sac Outlets', defaultValue: 0, description: 'Sacrifice without mana cost (Viscera Seer, Carrion Feeder, Goblin Bombardment)' },
                            { id: 'paid-sac', name: 'Paid Sac Outlets', defaultValue: 0, description: 'Sacrifice requiring mana (Yawgmoth, Birthing Pod, High Market)' },
                            { id: 'aristocrats', name: 'Aristocrats (Death Triggers)', defaultValue: 0, description: 'Gain value when creatures die (Blood Artist, Zulaport Cutthroat, Judith)' }
                        ]
                    },
                    {
                        id: 'utility-creatures',
                        name: 'Utility Creatures',
                        subcategories: [
                            { id: 'hatebears', name: 'Hatebears', defaultValue: 0, description: 'Disrupt opponents strategies (Thalia, Drannith Magistrate, Opposition Agent)' },
                            { id: 'protection-creatures', name: 'Protection Creatures', defaultValue: 0, description: 'Protect your board (Selfless Spirit, Dauntless Bodyguard, Spellskite)' },
                            { id: 'recursion-creatures', name: 'Recursion Creatures', defaultValue: 0, description: 'Return cards from graveyard (Eternal Witness, Sun Titan, Karmic Guide)' },
                            { id: 'token-makers', name: 'Token Makers', defaultValue: 0, description: 'Create creature tokens (Avenger of Zendikar, Deep Forest Hermit, Hornet Queen)' },
                            { id: 'blink-targets', name: 'Blink/Flicker Targets', defaultValue: 0, description: 'High-value ETB creatures for blinking (Mulldrifter, Archaeomancer, any ETB value)' }
                        ]
                    },
                    {
                        id: 'tribal-creatures',
                        name: 'Tribal Creatures',
                        subcategories: [
                            { id: 'tribal-payoffs', name: 'Tribal Payoffs', defaultValue: 0, description: 'Reward for playing tribe (Door of Destinies, Coat of Arms, tribal anthem effects)' },
                            { id: 'tribal-lords', name: 'Tribal Lords', defaultValue: 0, description: 'Buff creatures of your tribe (Lord of Atlantis, Elvish Champion, any type lord)' },
                            { id: 'tribal-support', name: 'Tribal Support', defaultValue: 0, description: 'Help tribal strategy without being the tribe (Kindred Discovery, Vanquisher\'s Banner)' },
                            { id: 'changeling', name: 'Changelings', defaultValue: 0, description: 'All creature types (Changeling Outcast, Unsettled Mariner, tribal wildcards)' }
                        ]
                    },
                    {
                        id: 'combat-creatures',
                        name: 'Combat Creatures',
                        subcategories: [
                            { id: 'evasion', name: 'Evasive Creatures', defaultValue: 0, description: 'Flying, unblockable, menace, etc. (Flyers, Invisible Stalker, Etali)' },
                            { id: 'finishers', name: 'Finishers', defaultValue: 0, description: 'Win the game with combat (Craterhoof Behemoth, Triumph of the Hordes carriers)' },
                            { id: 'combat-tricks', name: 'Combat Trick Creatures', defaultValue: 0, description: 'Surprise combat abilities (Mother of Runes, flash creatures, combat effects)' },
                            { id: 'defenders', name: 'Defenders/Blockers', defaultValue: 0, description: 'High toughness or defensive abilities (Wall of Roots, Stuffy Doll, Fog Bank)' }
                        ]
                    },
                    {
                        id: 'creatures-other',
                        name: 'Other Creatures',
                        subcategories: [
                            { id: 'creatures-uncategorized', name: 'Other/Uncategorized', defaultValue: 0, description: 'Unique or miscellaneous creatures that don\'t fit other categories' }
                        ]
                    }
                ]
            },
            noncreature: {
                name: '‚ö° Non-Creature Spells',
                icon: '‚ö°',
                categories: [
                    {
                        id: 'ramp',
                        name: 'Ramp & Mana',
                        subcategories: [
                            { id: 'fast-mana', name: 'Fast Mana (0-1 CMC)', defaultValue: 0, description: 'Zero or one mana acceleration (Sol Ring, Mana Crypt, Mox Diamond, Jeweled Lotus)' },
                            { id: 'efficient-ramp', name: 'Efficient Ramp (2 CMC)', defaultValue: 0, description: 'Two mana rocks and ramp (Signets, Talismans, Farseek, Nature\'s Lore)' },
                            { id: 'expensive-ramp', name: 'Expensive Ramp (3+ CMC)', defaultValue: 0, description: 'Three or more mana ramp (Commander\'s Sphere, Cultivate, Kodama\'s Reach)' },
                            { id: 'land-ramp', name: 'Land Ramp Spells', defaultValue: 0, description: 'Spells that put lands onto battlefield (Rampant Growth, Explosive Vegetation)' },
                            { id: 'rituals', name: 'Rituals', defaultValue: 0, description: 'Temporary mana burst (Dark Ritual, Jeska\'s Will, Mana Geyser)' }
                        ]
                    },
                    {
                        id: 'draw',
                        name: 'Card Draw',
                        subcategories: [
                            { id: 'cantrips', name: 'Cantrips (0-1 CMC)', defaultValue: 0, description: 'Cheap cycle or draw one (Ponder, Preordain, Brainstorm, Opt)' },
                            { id: 'raw-draw', name: 'Raw Draw Spells', defaultValue: 0, description: 'Draw multiple cards immediately (Blue Sun\'s Zenith, Painful Truths, Harmonize)' },
                            { id: 'draw-engines', name: 'Draw Engines', defaultValue: 0, description: 'Repeatable card draw (Rhystic Study, Phyrexian Arena, Mystic Remora)' },
                            { id: 'wheeling', name: 'Wheel Effects', defaultValue: 0, description: 'Everyone discards and draws (Wheel of Fortune, Windfall, Reforge the Soul)' },
                            { id: 'tutors', name: 'Tutors', defaultValue: 0, description: 'Search library for specific cards (Demonic Tutor, Vampiric Tutor, Enlightened Tutor)' },
                            { id: 'impulse-draw', name: 'Impulse Draw', defaultValue: 0, description: 'Exile and play (Outpost Siege, Light Up the Stage, red exile draw)' }
                        ]
                    },
                    {
                        id: 'removal-spells',
                        name: 'Spot Removal',
                        subcategories: [
                            { id: 'creature-removal', name: 'Creature Removal', defaultValue: 0, description: 'Kill or exile creatures (Path to Exile, Swords to Plowshares, Murder)' },
                            { id: 'artifact-enchantment-removal', name: 'Artifact/Enchantment Removal', defaultValue: 0, description: 'Destroy artifacts and/or enchantments (Naturalize, Return to Dust, Nature\'s Claim)' },
                            { id: 'artifact-removal', name: 'Artifact Removal Only', defaultValue: 0, description: 'Only hits artifacts (Vandalblast, By Force, Smelt)' },
                            { id: 'enchantment-removal', name: 'Enchantment Removal Only', defaultValue: 0, description: 'Only hits enchantments (Back to Nature, Tranquility, Demystify)' },
                            { id: 'planeswalker-removal', name: 'Planeswalker Removal', defaultValue: 0, description: 'Directly remove planeswalkers (Hero\'s Downfall, Dreadbore, Bedevil)' },
                            { id: 'land-removal', name: 'Land Removal', defaultValue: 0, description: 'Destroy or exile lands (Ghost Quarter, Strip Mine, Wasteland)' },
                            { id: 'flexible-removal', name: 'Flexible Removal', defaultValue: 0, description: 'Hit multiple permanent types (Anguished Unmaking, Generous Gift, Beast Within)' }
                        ]
                    },
                    {
                        id: 'wipes',
                        name: 'Board Wipes',
                        subcategories: [
                            { id: 'destroy-wipes', name: 'Destroy Wipes', defaultValue: 0, description: 'Destroy all creatures (Wrath of God, Damnation, Day of Judgment)' },
                            { id: 'exile-wipes', name: 'Exile Wipes', defaultValue: 0, description: 'Exile all creatures (Merciless Eviction, Farewell, Final Judgment)' },
                            { id: 'asymmetric', name: 'Asymmetric Wipes', defaultValue: 0, description: 'One-sided wipes (Toxic Deluge at low life, Blasphemous Act with indestructible)' },
                            { id: 'creature-wipes', name: 'Creature-Only Wipes', defaultValue: 0, description: 'Only destroy creatures, spare other permanents' },
                            { id: 'permanent-wipes', name: 'All Permanent Wipes', defaultValue: 0, description: 'Destroy all permanents (Cyclonic Rift, Nevinyrral\'s Disk)' }
                        ]
                    },
                    {
                        id: 'protection',
                        name: 'Protection & Interaction',
                        subcategories: [
                            { id: 'counterspells', name: 'Counterspells', defaultValue: 0, description: 'Counter target spell (Counterspell, Swan Song, Arcane Denial, Negate)' },
                            { id: 'protection-spells', name: 'Protection Spells', defaultValue: 0, description: 'Protect your permanents (Heroic Intervention, Teferi\'s Protection, Flawless Maneuver)' },
                            { id: 'redirection', name: 'Redirection', defaultValue: 0, description: 'Change targets of spells/abilities (Deflecting Swat, Bolt Bend, Redirect)' },
                            { id: 'phasing', name: 'Phasing Effects', defaultValue: 0, description: 'Phase out to protect (Teferi\'s Protection, Ghostway, Eerie Interlude)' }
                        ]
                    },
                    {
                        id: 'reanimation',
                        name: 'Reanimation & Recursion',
                        subcategories: [
                            { id: 'reanimation', name: 'Reanimation', defaultValue: 0, description: 'Return creatures from graveyard to battlefield (Animate Dead, Reanimate, Living Death)' },
                            { id: 'graveyard-recursion', name: 'Graveyard Recursion', defaultValue: 0, description: 'Return any cards from graveyard (Regrowth, Eternal Witness effects as spells)' },
                            { id: 'self-mill', name: 'Self-Mill', defaultValue: 0, description: 'Put cards from library to graveyard (Entomb, Buried Alive, Traumatize self)' },
                            { id: 'graveyard-hate', name: 'Graveyard Hate', defaultValue: 0, description: 'Exile opponent graveyards (Rest in Peace, Bojuka Bog, Tormod\'s Crypt)' }
                        ]
                    },
                    {
                        id: 'tokens-anthems',
                        name: 'Tokens & Anthems',
                        subcategories: [
                            { id: 'token-spells', name: 'Token Generation', defaultValue: 0, description: 'Create creature tokens (Secure the Wastes, White Sun\'s Zenith, Army of the Damned)' },
                            { id: 'anthems', name: 'Anthems/Buffs', defaultValue: 0, description: 'Permanent buffs to your creatures (Glorious Anthem, Shared Animosity, Beastmaster Ascension)' },
                            { id: 'pump-spells', name: 'Pump Spells', defaultValue: 0, description: 'Temporary power boost (Giant Growth, Berserk, Become Immense)' }
                        ]
                    },
                    {
                        id: 'extra-turns',
                        name: 'Extra Turns & Combat',
                        subcategories: [
                            { id: 'extra-turns', name: 'Extra Turns', defaultValue: 0, description: 'Take additional turns (Time Warp, Temporal Manipulation, Nexus of Fate)' },
                            { id: 'extra-combats', name: 'Extra Combats', defaultValue: 0, description: 'Additional combat phases (Relentless Assault, Seize the Day, Combat Celebrant)' },
                            { id: 'combat-trick-spells', name: 'Combat Tricks', defaultValue: 0, description: 'Instant-speed combat advantages (Boros Charm, Heroic Intervention, pump spells)' }
                        ]
                    },
                    {
                        id: 'planeswalkers',
                        name: 'Planeswalkers',
                        subcategories: [
                            { id: 'planeswalker-removal', name: 'Removal Walkers', defaultValue: 0, description: 'Planeswalkers with removal abilities (Liliana, Elspeth removal modes)' },
                            { id: 'planeswalker-draw', name: 'Draw Walkers', defaultValue: 0, description: 'Planeswalkers that draw cards (Teferi, Jace, card advantage walkers)' },
                            { id: 'planeswalker-ramp', name: 'Ramp Walkers', defaultValue: 0, description: 'Planeswalkers that make mana (Nissa, Garruk, ramp walkers)' },
                            { id: 'planeswalker-other', name: 'Other Walkers', defaultValue: 0, description: 'Utility or unique planeswalkers (Karn, Ugin, miscellaneous)' }
                        ]
                    },
                    {
                        id: 'combo-pieces',
                        name: 'Combo Pieces',
                        subcategories: [
                            { id: 'combo-enablers', name: 'Combo Enablers', defaultValue: 0, description: 'Cards that set up combos (Intruder Alarm, Ashnod\'s Altar, untappers)' },
                            { id: 'combo-payoffs', name: 'Combo Payoffs', defaultValue: 0, description: 'Win conditions for combos (Thassa\'s Oracle, Lab Man, drain effects)' },
                            { id: 'infinite-pieces', name: 'Infinite Combo Pieces', defaultValue: 0, description: 'Create infinite loops (Dramatic Reversal + Isochron Scepter pieces)' }
                        ]
                    },
                    {
                        id: 'stax-tax',
                        name: 'Stax & Tax Effects',
                        subcategories: [
                            { id: 'stax-pieces', name: 'Stax Pieces', defaultValue: 0, description: 'Lock down opponents (Winter Orb, Static Orb, Trinisphere, rule of law effects)' },
                            { id: 'tax-effects', name: 'Tax Effects', defaultValue: 0, description: 'Make things cost more (Thalia, Sphere of Resistance, Smothering Tithe)' },
                            { id: 'resource-denial', name: 'Resource Denial', defaultValue: 0, description: 'Prevent resources (Armageddon, Contamination, land destruction)' }
                        ]
                    },
                    {
                        id: 'spells-other',
                        name: 'Other Spells',
                        subcategories: [
                            { id: 'equipment', name: 'Equipment', defaultValue: 0, description: 'Equip to creatures for bonuses (Sword of X and Y, Skullclamp, Lightning Greaves)' },
                            { id: 'auras', name: 'Auras', defaultValue: 0, description: 'Enchant creatures or permanents (Rancor, All That Glitters, Animate Dead)' },
                            { id: 'spells-uncategorized', name: 'Other/Uncategorized', defaultValue: 0, description: 'Unique or miscellaneous spells that don\'t fit other categories' }
                        ]
                    }
                ]
            }
        };

        // CMC Explanation constant
        const CMC_EXPLANATION = {
            title: "What is CMC?",
            text: "CMC = Converted Mana Cost (also called Mana Value). It's the total cost to cast a spell. For example: Sol Ring (1 CMC), Signets (2 CMC), Cultivate (3 CMC). Lower CMC cards are generally faster!"
        };

        const FUNNY_MANA_QUOTES = [
            "Remember: basics are for basics. You're not basic. üé©",
            "Mana screw? Not today, friend! üé≤",
            "Your mana base is so smooth, it could host a podcast. üéôÔ∏è",
            "Perfectly balanced, as all mana bases should be. ‚öóÔ∏è",
            "Now go forth and cast spells like you own the place! üîÆ",
            "Your lands are looking sharp! Unlike your opponent's life total. üòé",
            "This mana base slaps harder than a Craterhoof trigger. ü¶å",
            "More consistent than your friend who always plays blue. üíô",
            "Smoother than a greased-up Vorinclex. ü§¢",
            "Chef's kiss! *mwah* üë®‚Äçüç≥",
            "Your mana base just entered the chat. üí¨",
            "Built different. No, seriously, it's optimal now. ‚ú®",
            "Mana flooding? We don't know her. üåä",
            "This is the way. üõ°Ô∏è",
            "Your opponents are going to hate this (in a respectful way). üòà",
            "Who needs green ramp when your mana base is this good? üå≤",
            "Finally, a land base that respects your commander. üéñÔ∏è",
            "No pain lands needed when you're this prepared! üí™",
            "Your deck is about to pop off! üéÜ",
            "Time to shuffle up and dominate! üÉè",
            "More reliable than a Sol Ring in your opening hand. üíç",
            "Smoother than tapping Ancient Tomb with no consequences. üèõÔ∏è",
            "Your mana curve is more beautiful than a foil Black Lotus. üå∏",
            "This mana base doesn't need a Mana Crypt to be fast. ‚ö°",
            "More balanced than getting a Rhystic Study to resolve. üìö",
            "Your opponents just got Cyclonic Rift'd... but for their hopes. üåÄ",
            "Lands this good should be banned in casual pods. üö´",
            "You're about to Demonic Tutor for victory. üòà",
            "This mana base is more legendary than Urza himself. üßô",
            "Smoother than casting a turn 1 Birds of Paradise. üê¶",
            "Your lands are more optimized than a cEDH deck. üèÜ",
            "More consistent than that guy who always plays Atraxa. üëæ",
            "Time to channel your inner Spike. This is competitive-ready! üî•",
            "Your mana base passed the Bolt test... and the Thoughtseize test. ‚ö°",
            "Lands this good could make even a Colossal Dreadmaw viable. ü¶ñ",
            "More powerful than exiling three cards to Force of Will. üí®",
            "Your mana base doesn't need to ask 'Did you pay the 1?' ü§ë",
            "This is more satisfying than resolving a kicked Rite of Replication. ü™û",
            "Smoother than turn 2 Smothering Tithe in a 4-player pod. üí∞",
            "Your lands are more reliable than your opponent's Sensei's Divining Top. üîù",
            "This mana base makes Omnath jealous. üåà",
            "More polished than a freshly opened Secret Lair. ‚ú®",
            "You're about to make your opponents scoop faster than a Worldfire. üî•",
            "This mana base is stickier than Teferi's Protection. üõ°Ô∏è",
            "Lands so good, even Gitrog Monster is taking notes. üê∏",
            "More explosive than a Dockside Extortionist at a treasure convention. üíé",
            "Your mana base just said 'No' to variance. ‚õî",
            "Smoother than drawing your entire deck with Thassa's Oracle. üêü",
            "This is more threatening than an unanswered Doubling Season. üå±",
            "Your lands are more consistent than your friend's excuse for playing Stax. ‚öôÔ∏è",
            "This mana base could support a 5-color super friends deck. No, really. üé≠",
            "More optimized than a Food Chain combo. üçñ",
            "Your opponents are about to get Armageddon'd... metaphorically. üí•",
            "Lands this good make Azusa weep tears of joy. üò≠",
            "This is cleaner than a board state before Wrath of God. ‚öîÔ∏è",
            "More reliable than 'Draw, Sol Ring, go.' üíç",
            "Your mana base doesn't miss, unlike your opponent's Chaos Warp. üé≤",
            "This is spicier than a Tibalt, Cosmic Imposter steal. üòà",
            "Smoother than a turn 3 Winota flip into Craterhoof. ü¶å",
            "Your lands are more synchronized than a Grand Arbiter lock. ‚öñÔ∏è",
            "This mana base hits harder than an Eldrazi Conscription. üëæ",
            "More satisfying than Narset wheeling away your opponent's hand. üé°",
            "Your mana is more bountiful than a Zendikar Rising full-art forest. üå≤",
            "This could support casting Expropriate. Twice. üëë",
            "Lands so good, your opponents can't even get salty. üßÇ",
            "More elegant than a Swords to Plowshares on a Blightsteel. ‚öîÔ∏è",
            "Your mana base just won the commander game before turn 1. üèÖ"
        ];


        const DEMO_DECKS = [
            {
                id: 1,
                name: "Atraxa Superfriends",
                commander: "Atraxa, Praetors' Voice",
                colors: ['W', 'U', 'B', 'G'],
                strategy: "Planeswalkers",
                lands: 37,
                creatures: 18,
                noncreature: 44,
                isExample: true
            },
            {
                id: 2,
                name: "Krenko Goblin Tribal",
                commander: "Krenko, Mob Boss",
                colors: ['R'],
                strategy: "Tribal Aggro",
                lands: 35,
                creatures: 42,
                noncreature: 22,
                isExample: true
            },
            {
                id: 3,
                name: "Muldrotha Value Engine",
                commander: "Muldrotha, the Gravetide",
                colors: ['U', 'B', 'G'],
                strategy: "Graveyard Value",
                lands: 38,
                creatures: 32,
                noncreature: 29,
                isExample: true
            },
            {
                id: 4,
                name: "Narset Extra Turns",
                commander: "Narset, Enlightened Master",
                colors: ['W', 'U', 'R'],
                strategy: "Extra Turns",
                lands: 37,
                creatures: 15,
                noncreature: 47,
                isExample: true
            },
            {
                id: 5,
                name: "Godo Combo",
                commander: "Godo, Bandit Warlord",
                colors: ['R'],
                strategy: "Combo",
                lands: 36,
                creatures: 12,
                noncreature: 51,
                isExample: true
            },
            {
                id: 6,
                name: "Tatyova Landfall",
                commander: "Tatyova, Benthic Druid",
                colors: ['U', 'G'],
                strategy: "Landfall",
                lands: 45,
                creatures: 28,
                noncreature: 26,
                isExample: true
            },
            {
                id: 7,
                name: "Urza Artifacts",
                commander: "Urza, Lord High Artificer",
                colors: ['U'],
                strategy: "Artifact Combo",
                lands: 34,
                creatures: 22,
                noncreature: 43,
                isExample: true
            },
            {
                id: 8,
                name: "Edgar Markov Vampires",
                commander: "Edgar Markov",
                colors: ['W', 'B', 'R'],
                strategy: "Tribal Aggro",
                lands: 36,
                creatures: 38,
                noncreature: 25,
                isExample: true
            },
            {
                id: 9,
                name: "Kozilek Eldrazi",
                commander: "Kozilek, Butcher of Truth",
                colors: ['C'],
                strategy: "Colorless Ramp",
                lands: 36,
                creatures: 28,
                noncreature: 35,
                isExample: true
            },
            {
                id: 10,
                name: "The Gitrog Monster",
                commander: "The Gitrog Monster",
                colors: ['B', 'G'],
                strategy: "Lands Matter",
                lands: 42,
                creatures: 24,
                noncreature: 33,
                isExample: true
            }
        ];

        const fetchCardFromScryfall = async (cardName) => {
            try {
                const response = await fetch(
                    `https://api.scryfall.com/cards/named?fuzzy=${encodeURIComponent(cardName)}`
                );
                if (!response.ok) throw new Error('Card not found');
                return await response.json();
            } catch (error) {
                console.error('Error fetching card:', error);
                return null;
            }
        };

        function App() {
            const [view, setView] = useState('home');
            const [decks, setDecks] = useState(() => {
                const saved = localStorage.getItem('commanderCodexDecks');
                return saved ? JSON.parse(saved) : DEMO_DECKS;
            });
            const [showCreateModal, setShowCreateModal] = useState(false);
            const [deckToCopy, setDeckToCopy] = useState(null);
            const [showEditModal, setShowEditModal] = useState(false);
            const [deckToEdit, setDeckToEdit] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedDeck, setSelectedDeck] = useState(null);
            const [user, setUser] = useState(null);
            const [showAuthModal, setShowAuthModal] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [showBugReportModal, setShowBugReportModal] = useState(false);
            const [selectedDecksToDelete, setSelectedDecksToDelete] = useState([]);
            const [deleteMode, setDeleteMode] = useState(false);
            const [publicDecks, setPublicDecks] = useState([]);
            const [myDecksSearch, setMyDecksSearch] = useState('');
            const [browseSearch, setBrowseSearch] = useState('');
            const [browseSortBy, setBrowseSortBy] = useState('newest'); // NEW: Sort option
            const [showInfoExpanded, setShowInfoExpanded] = useState(false);
            const [showManaCalcInfo, setShowManaCalcInfo] = useState(false);
            const [showMobileAbout, setShowMobileAbout] = useState(false);
            const [showManaCalcAbout, setShowManaCalcAbout] = useState(false);
            const [manaCalculation, setManaCalculation] = useState(null);
            const [showResults, setShowResults] = useState(false);
            const [randomQuote, setRandomQuote] = useState('');

            // Rate Limiting - Simple client-side protection
            const rateLimits = {
                deckCreation: { max: 10, window: 3600000 }, // 10 decks per hour
                auth: { max: 5, window: 300000 } // 5 auth attempts per 5 minutes
            };

            const checkRateLimit = (action) => {
                const now = Date.now();
                const key = `rateLimit_${action}`;
                const stored = localStorage.getItem(key);
                const attempts = stored ? JSON.parse(stored) : [];
                
                // Remove old attempts outside the window
                const windowStart = now - rateLimits[action].window;
                const recentAttempts = attempts.filter(time => time > windowStart);
                
                // Check if limit exceeded
                if (recentAttempts.length >= rateLimits[action].max) {
                    const oldestAttempt = Math.min(...recentAttempts);
                    const timeUntilReset = Math.ceil((oldestAttempt + rateLimits[action].window - now) / 60000);
                    return { allowed: false, resetIn: timeUntilReset };
                }
                
                // Add current attempt
                recentAttempts.push(now);
                localStorage.setItem(key, JSON.stringify(recentAttempts));
                
                return { allowed: true };
            };

            // Bug Report Submission
            const submitBugReport = async (description, email) => {
                if (!description || description.trim().length < 10) {
                    alert('‚ùå Please provide a detailed description (at least 10 characters).');
                    return false;
                }

                try {
                    await db.collection('bug-reports').add({
                        description: description.trim(),
                        email: email?.trim() || 'anonymous',
                        userAgent: navigator.userAgent,
                        timestamp: new Date(),
                        userId: user?.uid || 'anonymous',
                        url: window.location.href
                    });

                    return true;
                } catch (error) {
                    console.error('Error submitting bug report:', error);
                    alert('‚ùå Error submitting report. Please try again.');
                    return false;
                }
            };

            // Tri-Lands Auto-Calculation Helper
            const calculateTriLandPips = (triLandCount, deckColors) => {
                if (triLandCount === 0 || !deckColors || deckColors.length !== 3) {
                    return { W: 0, U: 0, B: 0, R: 0, G: 0 };
                }

                // Each tri-land adds 1 pip to each of the 3 colors
                const pips = { W: 0, U: 0, B: 0, R: 0, G: 0 };
                deckColors.forEach(color => {
                    pips[color] = triLandCount;
                });

                return pips;
            };

            // Save decks to localStorage whenever they change
            useEffect(() => {
                localStorage.setItem('commanderCodexDecks', JSON.stringify(decks));
            }, [decks]);
            
            // Add deck to public collection (preventing duplicates)
            const addToPublicDecks = async (deck) => {
                console.log("addToPublicDecks called with:", deck);
                
                if (!deck.isPublic) {
                    console.log("Deck is not public, skipping");
                    return;
                }
                
                if (!deck.id) {
                    console.error("ERROR: Deck has no ID!", deck);
                    return;
                }
                
                try {
                    // Check if deck already exists in public collection
                    const existingDeck = await db.collection("publicDecks")
                        .where("originalDeckId", "==", deck.id)
                        .get();
                    
                    if (!existingDeck.empty) {
                        console.log("Deck already in public collection, updating...");
                        // Update existing public deck
                        const docId = existingDeck.docs[0].id;
                        await db.collection("publicDecks").doc(docId).update({
                            name: deck.name,
                            commander: deck.commander,
                            colors: deck.colors,
                            categories: deck.categories,
                            sideboard: deck.sideboard || {},
                            notableCards: deck.notableCards || [],
                            updatedAt: new Date()
                        });
                        console.log("‚úÖ Public deck updated successfully!");
                        return;
                    }
                    
                    // Add new public deck
                    console.log("Adding new public deck with data:", {
                        name: deck.name,
                        commander: deck.commander,
                        originalDeckId: deck.id,
                        userId: deck.userId
                    });
                    
                    await db.collection("publicDecks").add({
                        ...deck,
                        originalDeckId: deck.id,
                        userId: deck.userId,
                        viewCount: 0,              // ‚Üê NEW: Track views
                        buildSimilarCount: 0,      // ‚Üê NEW: Track builds
                        createdAt: deck.createdAt || new Date(),
                        updatedAt: new Date()
                    });
                    console.log("‚úÖ Deck added to public collection!");
                } catch (error) {
                    console.error("‚ùå Error adding to public collection:", error);
                }
            };

            // Remove deck from public collection
            const removeFromPublicDecks = async (deckId) => {
                try {
                    const snapshot = await db.collection("publicDecks")
                        .where("originalDeckId", "==", deckId)
                        .get();
                    
                    const deletePromises = snapshot.docs.map(doc => doc.ref.delete());
                    await Promise.all(deletePromises);
                    console.log("Deck removed from public collection!");
                } catch (error) {
                    console.error("Error removing from public collection:", error);
                }
            };

            // Load all public decks
            const loadPublicDecks = async () => {
                console.log("Loading public decks...");
                try {
                    const snapshot = await db.collection("publicDecks")
                        .orderBy("updatedAt", "desc")
                        .limit(100)
                        .get();
                    
                    const decks = [];
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        decks.push({
                            ...data,
                            id: doc.id,  // Use the publicDecks document ID (override any id in data)
                            publicDeckId: doc.id  // Also store as publicDeckId for clarity
                        });
                    });
                    
                    setPublicDecks(decks);
                    console.log("‚úÖ Loaded", decks.length, "public decks");
                } catch (error) {
                    console.error("‚ùå Error loading public decks:", error);
                }
            };

            // Load public decks on component mount
            useEffect(() => {
                loadPublicDecks();
            }, []);

            // Increment view count when someone views a deck
            const incrementViewCount = async (publicDeckId) => {
                console.log("üî¢ incrementViewCount called with ID:", publicDeckId);
                try {
                    // First, get the deck to check if viewCount exists
                    const deckRef = db.collection("publicDecks").doc(publicDeckId);
                    console.log("üìñ Fetching deck document...");
                    const deckDoc = await deckRef.get();
                    
                    if (deckDoc.exists) {
                        const data = deckDoc.data();
                        console.log("‚úÖ Deck found, current viewCount:", data.viewCount);
                        // If viewCount doesn't exist, initialize it first
                        if (data.viewCount === undefined) {
                            console.log("üÜï viewCount doesn't exist, initializing to 1...");
                            await deckRef.update({ viewCount: 1 });
                            console.log("‚úÖ View count initialized to 1 for deck:", publicDeckId);
                        } else {
                            console.log("‚ûï Incrementing existing viewCount...");
                            await deckRef.update({
                                viewCount: firebase.firestore.FieldValue.increment(1)
                            });
                            console.log("‚úÖ View count incremented for deck:", publicDeckId);
                        }
                    } else {
                        console.log("‚ùå Deck document not found:", publicDeckId);
                    }
                } catch (error) {
                    console.error("‚ùå Error incrementing view count:", error);
                }
            };

            // Increment build similar count when someone builds similar
            const incrementBuildCount = async (publicDeckId) => {
                try {
                    // First, get the deck to check if buildSimilarCount exists
                    const deckRef = db.collection("publicDecks").doc(publicDeckId);
                    const deckDoc = await deckRef.get();
                    
                    if (deckDoc.exists) {
                        const data = deckDoc.data();
                        // If buildSimilarCount doesn't exist, initialize it first
                        if (data.buildSimilarCount === undefined) {
                            await deckRef.update({ buildSimilarCount: 1 });
                            console.log("‚úÖ Build count initialized to 1 for deck:", publicDeckId);
                        } else {
                            await deckRef.update({
                                buildSimilarCount: firebase.firestore.FieldValue.increment(1)
                            });
                            console.log("‚úÖ Build count incremented for deck:", publicDeckId);
                        }
                    }
                } catch (error) {
                    console.error("‚ùå Error incrementing build count:", error);
                }
            };
                    
            // Save a deck to Firebase
const saveDeckToFirebase = async (deck) => {
    if (!user) {
        alert("Please log in to save decks to the cloud!");
        return;
    }
    
    // Rate limiting check
    const rateCheck = checkRateLimit('deckCreation');
    if (!rateCheck.allowed) {
        alert(`‚ö†Ô∏è Rate Limit Reached!\n\nYou've created too many decks recently.\n\nPlease wait ${rateCheck.resetIn} minute(s) before creating more decks.\n\nThis helps protect our servers from abuse.`);
        return false;
    }
    
    try {
        // Check if user document exists, create if not
        const userDocRef = db.collection('users').doc(user.uid);
        const userDoc = await userDocRef.get();
        
        let currentCount = 0;
        
        if (!userDoc.exists) {
            // User document doesn't exist - create it
            console.log("User document not found, creating...");
            
            // Count existing decks for this user
            const existingDecks = await db.collection('decks')
                .where('userId', '==', user.uid)
                .get();
            currentCount = existingDecks.size;
            
            // Create user document with current deck count
            await userDocRef.set({
                email: user.email,
                deckCount: currentCount,
                createdAt: new Date()
            });
            console.log(`‚úÖ User document created with ${currentCount} existing decks`);
        } else {
            // User document exists - get current count
            currentCount = userDoc.data()?.deckCount || 0;
        }

        // Enforce 100 deck limit
        if (currentCount >= 100) {
            alert('‚ö†Ô∏è Maximum 100 Decks Reached!\n\nYou have reached the maximum limit of 100 decks per account.\n\nPlease delete some existing decks before creating new ones.\n\nCurrent count: ' + currentCount + '/100');
            return false;
        }

        const deckWithUser = {
            ...deck,
            userId: user.uid,
            createdAt: new Date(),
            updatedAt: new Date()
        };
        
        const docRef = await db.collection("decks").add(deckWithUser);
        console.log("Deck saved to Firebase!");

        // Increment deck count in Firestore
        await userDocRef.update({
            deckCount: currentCount + 1
        });
        
        // If deck is public, add to public collection
        if (deck.isPublic) {
            await addToPublicDecks({...deckWithUser, id: docRef.id});
            // Refresh public decks list
            await loadPublicDecks();
        }
        
        // Show success with count
        alert(`‚úÖ Deck saved successfully!\n\nYou now have ${currentCount + 1}/100 decks.`);
        
        return true;
    } catch (error) {
        console.error("Error saving deck:", error);
        alert("Error saving deck: " + error.message);
        return false;
    }
};

            // Load user's decks from Firebase
            const loadDecksFromFirebase = async (userId) => {
                if (!userId) return;
                
                try {
                    const snapshot = await db.collection("decks")
                        .where("userId", "==", userId)
                        .orderBy("updatedAt", "desc")
                        .get();
                    
                    const firebaseDecks = [];
                    snapshot.forEach((doc) => {
                        firebaseDecks.push({
                            
                            ...doc.data(),
                            id: doc.id
                        });
                    });
                    
                    setDecks(firebaseDecks);
                    console.log("Loaded", firebaseDecks.length, "decks from Firebase");
                } catch (error) {
                    console.error("Error loading decks:", error);
                }
            };

// ‚Üë FIREBASE DECK FUNCTIONS END HERE ‚Üë



            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((currentUser) => {
                    setUser(currentUser);
                    if (currentUser) {
                        console.log("User logged in:", currentUser.email);
                        loadDecksFromFirebase(currentUser.uid);
                    } else {
                        console.log("User logged out");
                        setDecks([]);
                    }
                });
                
                return () => unsubscribe();
            }, []);

            // Authentication functions
            const handleSignUp = async (email, password) => {
                // Rate limiting check
                const rateCheck = checkRateLimit('auth');
                if (!rateCheck.allowed) {
                    alert(`‚ö†Ô∏è Too Many Attempts!\n\nPlease wait ${rateCheck.resetIn} minute(s) before trying again.\n\nThis helps protect against automated attacks.`);
                    return;
                }

                try {
                    // Validate email format
                    if (!email.includes('@')) {
                        alert('‚ùå Please enter a valid email address.');
                        return;
                    }

                    // Create the account (Firebase auth will check for duplicate email)
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    const user = userCredential.user;

                    // Store user data in Firestore
                    await db.collection('users').doc(user.uid).set({
                        email: email,
                        createdAt: new Date(),
                        deckCount: 0
                    });

                    alert("‚úÖ Account created successfully!");
                    setShowAuthModal(false);
                } catch (error) {
                    // Handle specific errors
                    if (error.code === 'auth/email-already-in-use') {
                        alert('‚ùå This email is already registered.\n\nPlease log in or use a different email.');
                    } else if (error.code === 'auth/invalid-email') {
                        alert('‚ùå Invalid email format.\n\nPlease check your email address.');
                    } else if (error.code === 'auth/weak-password') {
                        alert('‚ùå Password should be at least 6 characters long.');
                    } else {
                        alert('‚ùå Error creating account: ' + error.message);
                    }
                }
            };

            const handleLogin = (email, password) => {
                // Rate limiting check
                const rateCheck = checkRateLimit('auth');
                if (!rateCheck.allowed) {
                    alert(`‚ö†Ô∏è Too Many Attempts!\n\nPlease wait ${rateCheck.resetIn} minute(s) before trying again.\n\nThis helps protect against automated attacks.`);
                    return;
                }

                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
            alert("Logged in successfully!");
            setShowAuthModal(false);
        })
        .catch((error) => {
            // More helpful error message
            if (error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found' || error.code === 'auth/invalid-credential') {
                alert("‚ùå Incorrect email or password. Please try again.");
            } else if (error.code === 'auth/too-many-requests') {
                alert("‚ö†Ô∏è Too many failed attempts. Please try again later or reset your password.");
            } else {
                alert("Error: " + error.message);
            }
        });
                };

            const handleLogout = () => {
    auth.signOut();
};

              // Delete decks function
            const handleDeleteDecks = async () => {
                if (selectedDecksToDelete.length === 0) {
                    alert("Please select at least one deck to delete.");
                    return;
                }

                if (!window.confirm(`Are you sure you want to delete ${selectedDecksToDelete.length} deck(s)? This cannot be undone!`)) {
                    return;
                }

                try {
                    // Delete from Firebase
                    const deletePromises = selectedDecksToDelete.map(deckId => 
                        db.collection("decks").doc(deckId).delete()
                    );
                    
                    await Promise.all(deletePromises);

                    // Check if user document exists, create if not
                    const userDocRef = db.collection('users').doc(user.uid);
                    const userDoc = await userDocRef.get();
                    
                    let currentCount = 0;
                    
                    if (!userDoc.exists) {
                        // User document doesn't exist - create it
                        console.log("User document not found, creating...");
                        
                        // Count remaining decks for this user
                        const remainingDecks = await db.collection('decks')
                            .where('userId', '==', user.uid)
                            .get();
                        currentCount = remainingDecks.size;
                        
                        // Create user document with current deck count
                        await userDocRef.set({
                            email: user.email,
                            deckCount: currentCount,
                            createdAt: new Date()
                        });
                        console.log(`‚úÖ User document created with ${currentCount} remaining decks`);
                    } else {
                        // User document exists - decrement count
                        currentCount = userDoc.data()?.deckCount || 0;
                        const newCount = Math.max(0, currentCount - selectedDecksToDelete.length);
                        await userDocRef.update({
                            deckCount: newCount
                        });
                        currentCount = newCount;
                    }
                    
                    alert(`‚úÖ Successfully deleted ${selectedDecksToDelete.length} deck(s)!\n\nYou now have ${currentCount}/100 decks.`);
                    
                    // Reload decks
                    await loadDecksFromFirebase(user.uid);
                    
                    // Reset delete mode
                    setSelectedDecksToDelete([]);
                    setDeleteMode(false);
                } catch (error) {
                    console.error("Error deleting decks:", error);
                    alert("Error deleting decks: " + error.message);
                }
            };

            const toggleDeckSelection = (deckId) => {
                if (selectedDecksToDelete.includes(deckId)) {
                    setSelectedDecksToDelete(selectedDecksToDelete.filter(id => id !== deckId));
                } else {
                    setSelectedDecksToDelete([...selectedDecksToDelete, deckId]);
                }
            };

return (


      
                <>
                    {/* MOBILE HEADER - Logo + Title + Buttons */}
                    <header className="app-header mobile-header-only" style={{display: 'none'}}>
                        <style>{`
                            @media (max-width: 768px) {
                                .mobile-header-only {
                                    display: block !important;
                                }
                                .desktop-header-only {
                                    display: none !important;
                                }
                            }
                        `}</style>
                        
                        <div className="header-content" style={{
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center',
                            padding: '0.75rem 1rem',
                            width: '100%'
                        }}>
                            {/* Logo + Title */}
                            <div onClick={() => setView('home')} style={{
                                display: 'flex',
                                alignItems: 'center',
                                gap: '0.5rem',
                                cursor: 'pointer',
                                flex: 1
                            }}>
                                <svg width="35" height="35" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{filter: 'drop-shadow(2px 2px 4px rgba(0,0,0,0.5))'}}>
                                    <path d="M32 2C15.5 2 2 15.5 2 32c0 10 4.9 18.9 12.4 24.4v6.6c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-3.2h13.6v3.2c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-6.6C57.1 50.9 62 42 62 32 62 15.5 48.5 2 32 2z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="2" strokeLinejoin="miter"/>
                                    <ellipse cx="22" cy="26" rx="6" ry="8" fill="#000"/>
                                    <ellipse cx="42" cy="26" rx="6" ry="8" fill="#000"/>
                                    <path d="M22 28 L20 32 L22 34 M42 28 L44 32 L42 34" stroke="rgba(139, 111, 71, 0.3)" strokeWidth="1.5" fill="none"/>
                                    <path d="M28 34 Q32 37 36 34" fill="none" stroke="#000" strokeWidth="2"/>
                                    <path d="M32 36 L32 40" stroke="#000" strokeWidth="1.5"/>
                                    <rect x="26" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                    <rect x="29" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                    <rect x="32" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                    <rect x="35" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                    <path d="M15 30 Q12 32 15 34 M49 30 Q52 32 49 34" stroke="rgba(139, 111, 71, 0.4)" strokeWidth="1.5" fill="none"/>
                                    <path d="M18 32 C18 28, 20 26, 22 26 M46 32 C46 28, 44 26, 42 26" stroke="rgba(255,255,255,0.2)" strokeWidth="1" fill="none"/>
                                    <path d="M10 40 L14 36 L14 44 Z M54 40 L50 36 L50 44 Z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                </svg>
                                <span style={{
                                    fontFamily: 'Pirata One, cursive',
                                    fontSize: window.innerWidth <= 768 ? '1.6rem' : '1.3rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)',
                                    color: 'var(--bone)',
                                    whiteSpace: 'nowrap',
                                    fontFamily: 'Pirata One, cursive'
                                }}>
                                    MTG Deck Skeleton
                                </span>
                                <svg width="35" height="35" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{filter: 'drop-shadow(2px 2px 4px rgba(0,0,0,0.5))'}}>
                                    <path d="M32 2C15.5 2 2 15.5 2 32c0 10 4.9 18.9 12.4 24.4v6.6c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-3.2h13.6v3.2c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-6.6C57.1 50.9 62 42 62 32 62 15.5 48.5 2 32 2z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="2" strokeLinejoin="miter"/>
                                    <ellipse cx="22" cy="26" rx="6" ry="8" fill="#000"/>
                                    <ellipse cx="42" cy="26" rx="6" ry="8" fill="#000"/>
                                    <path d="M22 28 L20 32 L22 34 M42 28 L44 32 L42 34" stroke="rgba(139, 111, 71, 0.3)" strokeWidth="1.5" fill="none"/>
                                    <path d="M28 34 Q32 37 36 34" fill="none" stroke="#000" strokeWidth="2"/>
                                    <path d="M32 36 L32 40" stroke="#000" strokeWidth="1.5"/>
                                    <rect x="26" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                    <rect x="29" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                    <rect x="32" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                    <rect x="35" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                    <path d="M15 30 Q12 32 15 34 M49 30 Q52 32 49 34" stroke="rgba(139, 111, 71, 0.4)" strokeWidth="1.5" fill="none"/>
                                    <path d="M18 32 C18 28, 20 26, 22 26 M46 32 C46 28, 44 26, 42 26" stroke="rgba(255,255,255,0.2)" strokeWidth="1" fill="none"/>
                                    <path d="M10 40 L14 36 L14 44 Z M54 40 L50 36 L50 44 Z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                </svg>
                            </div>
                            
                            {/* Mana Calc + Login/Settings Buttons */}
                            <div style={{display: 'flex', gap: '0.5rem', alignItems: 'center'}}>
                                {/* Home Button */}
                                <button 
                                    className="btn btn-secondary"
                                    onClick={() => setView('home')}
                                    style={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        width: '45px',
                                        height: '45px',
                                        padding: '0.5rem',
                                        fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)',
                                        borderRadius: '8px'
                                    }}
                                >
                                    üè†
                                </button>
                                
                                {/* Mana Calc Button - Always visible */}
                                <button 
                                    className="btn btn-secondary"
                                    onClick={() => setView('calculator')}
                                    style={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '0.3rem',
                                        padding: '0.5rem 0.75rem',
                                        fontSize: '0.85rem',
                                        borderRadius: '12px',
                                        whiteSpace: 'nowrap'
                                    }}
                                >
                                    <svg width="18" height="18" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{flexShrink: 0}}>
                                        {/* Potion Flask */}
                                        <path d="M 24 8 L 24 22 L 20 32 Q 18 38 18 44 Q 18 52 22 56 Q 26 60 32 60 Q 38 60 42 56 Q 46 52 46 44 Q 46 38 44 32 L 40 22 L 40 8 Z" 
                                              fill="rgba(66, 135, 245, 0.3)" 
                                              stroke="var(--blue-mana)" 
                                              strokeWidth="2.5"/>
                                        {/* Liquid inside */}
                                        <path d="M 21 36 Q 20 40 20 44 Q 20 50 23 54 Q 27 58 32 58 Q 37 58 41 54 Q 44 50 44 44 Q 44 40 43 36 Z" 
                                              fill="rgba(136, 106, 234, 0.5)"/>
                                        {/* Cork/Stopper */}
                                        <rect x="26" y="4" width="12" height="6" rx="2" 
                                              fill="var(--bone)" 
                                              stroke="var(--border-color)" 
                                              strokeWidth="1.5"/>
                                        {/* Highlights */}
                                        <ellipse cx="28" cy="30" rx="4" ry="8" 
                                                 fill="rgba(255, 255, 255, 0.3)"/>
                                        {/* Bubbles */}
                                        <circle cx="30" cy="48" r="2" fill="rgba(255, 255, 255, 0.4)"/>
                                        <circle cx="35" cy="45" r="1.5" fill="rgba(255, 255, 255, 0.4)"/>
                                        <circle cx="34" cy="52" r="1" fill="rgba(255, 255, 255, 0.4)"/>
                                    </svg>
                                    Mana Calc
                                </button>
                                
                                {user ? (
                                    <>
                                        <button 
                                            className="btn btn-secondary"
                                            onClick={() => setShowSettings(true)}
                                            style={{
                                                display: 'flex',
                                                alignItems: 'center',
                                                justifyContent: 'center',
                                                width: '45px',
                                                height: '45px',
                                                padding: '0.5rem',
                                                fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)',
                                                borderRadius: '8px'
                                            }}
                                        >
                                            ‚öôÔ∏è
                                        </button>
                                        <button 
                                            className="btn btn-secondary"
                                            onClick={() => {
                                                auth.signOut();
                                                setView('home');
                                            }}
                                            style={{
                                                padding: '0.5rem 1rem',
                                                fontSize: '0.9rem',
                                                whiteSpace: 'nowrap'
                                            }}
                                        >
                                            Sign Out
                                        </button>
                                    </>
                                ) : (
                                    <button 
                                        className="btn btn-primary"
                                        onClick={() => setShowAuthModal(true)}
                                        style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.5rem',
                                            padding: '0.5rem 1rem',
                                            fontSize: '0.9rem'
                                        }}
                                    >
                                        <span>üîë</span>
                                        <span>Login</span>
                                    </button>
                                )}
                            </div>
                        </div>
                    </header>

                    {/* DESKTOP HEADER - Full Navigation */}
                    <header className="app-header desktop-header-only">
                        <div className="header-content">
                            <div className="logo" onClick={() => setView('home')} style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                <svg width="40" height="40" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{filter: 'drop-shadow(2px 2px 4px rgba(0,0,0,0.5))'}}>
    <path d="M32 2C15.5 2 2 15.5 2 32c0 10 4.9 18.9 12.4 24.4v6.6c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-3.2h13.6v3.2c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-6.6C57.1 50.9 62 42 62 32 62 15.5 48.5 2 32 2z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="2" strokeLinejoin="miter"/>
    <ellipse cx="22" cy="26" rx="6" ry="8" fill="#000"/>
    <ellipse cx="42" cy="26" rx="6" ry="8" fill="#000"/>
    <path d="M22 28 L20 32 L22 34 M42 28 L44 32 L42 34" stroke="rgba(139, 111, 71, 0.3)" strokeWidth="1.5" fill="none"/>
    <path d="M28 34 Q32 37 36 34" fill="none" stroke="#000" strokeWidth="2"/>
    <path d="M32 36 L32 40" stroke="#000" strokeWidth="1.5"/>
    <rect x="26" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
    <rect x="29" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
    <rect x="32" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
    <rect x="35" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
    <path d="M15 30 Q12 32 15 34 M49 30 Q52 32 49 34" stroke="rgba(139, 111, 71, 0.4)" strokeWidth="1.5" fill="none"/>
    <path d="M18 32 C18 28, 20 26, 22 26 M46 32 C46 28, 44 26, 42 26" stroke="rgba(255,255,255,0.2)" strokeWidth="1" fill="none"/>
    <path d="M10 40 L14 36 L14 44 Z M54 40 L50 36 L50 44 Z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
</svg>
                                <div>
                                    <div style={{fontSize: '2.2rem', lineHeight: 1, fontFamily: 'Pirata One, cursive', fontWeight: 400, letterSpacing: '2px'}}>MTG Deck Skeleton</div>
                                    <div className="logo-subtitle">+ Mana Calculator</div>
                                </div>
                            </div>
                            <div style={{display: 'flex', gap: '1rem', alignItems: 'center'}}>
                                <button 
                                    className="btn btn-secondary"
                                    onClick={() => setView('home')}
                                    style={{
                                        display: 'flex', 
                                        alignItems: 'center', 
                                        gap: '0.75rem',
                                        padding: '0.75rem 1.5rem',
                                        whiteSpace: 'nowrap',
                                        fontSize: '1.1rem'
                                    }}
                                >
                                    <span style={{fontSize: '1.8rem'}}>üè†</span>
                                    <span>Home</span>
                                </button>
                                <button 
                                    className="btn btn-secondary"
                                    onClick={() => setShowCreateModal(true)}
                                    style={{
                                        display: 'flex', 
                                        alignItems: 'center', 
                                        gap: '0.75rem',
                                        padding: '0.75rem 1.5rem',
                                        whiteSpace: 'nowrap',
                                        fontSize: '1.1rem'
                                    }}
                                >
                                    <span style={{fontSize: '1.8rem'}}>‚öîÔ∏è</span>
                                    <span>Create Deck</span>
                                </button>
                                <button 
                                    className="btn btn-secondary"
                                    onClick={() => setView('browse')}
                                    style={{
                                        display: 'flex', 
                                        alignItems: 'center', 
                                        gap: '0.75rem',
                                        padding: '0.75rem 1.5rem',
                                        whiteSpace: 'nowrap',
                                        fontSize: '1.1rem'
                                    }}
                                >
                                    <span style={{fontSize: '1.8rem'}}>üìö</span>
                                    <span>Browse Decks</span>
                                </button>
                                <button 
                                    className="btn btn-secondary"
                                    onClick={() => {
                                        setView('home');
                                        setTimeout(() => {
                                            const calc = document.querySelector('.featured-calculator-box');
                                            if (calc) {
                                                const offset = 100;
                                                const elementPosition = calc.getBoundingClientRect().top;
                                                const offsetPosition = elementPosition + window.pageYOffset - offset;
                                                window.scrollTo({top: offsetPosition, behavior: 'smooth'});
                                            }
                                        }, 100);
                                    }}
                                    style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}
                                >
                                    <svg width="24" height="24" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{flexShrink: 0}}>
                                        {/* Potion Flask */}
                                        <path d="M 24 8 L 24 22 L 20 32 Q 18 38 18 44 Q 18 52 22 56 Q 26 60 32 60 Q 38 60 42 56 Q 46 52 46 44 Q 46 38 44 32 L 40 22 L 40 8 Z" 
                                              fill="rgba(66, 135, 245, 0.3)" 
                                              stroke="var(--blue-mana)" 
                                              strokeWidth="2.5"/>
                                        {/* Liquid inside */}
                                        <path d="M 21 36 Q 20 40 20 44 Q 20 50 23 54 Q 27 58 32 58 Q 37 58 41 54 Q 44 50 44 44 Q 44 40 43 36 Z" 
                                              fill="rgba(136, 106, 234, 0.5)"/>
                                        {/* Cork/Stopper */}
                                        <rect x="26" y="4" width="12" height="6" rx="2" 
                                              fill="var(--bone)" 
                                              stroke="var(--border-color)" 
                                              strokeWidth="1.5"/>
                                        {/* Highlights */}
                                        <ellipse cx="28" cy="30" rx="4" ry="8" 
                                                 fill="rgba(255, 255, 255, 0.3)"/>
                                        {/* Bubbles */}
                                        <circle cx="30" cy="48" r="2" fill="rgba(255, 255, 255, 0.4)"/>
                                        <circle cx="35" cy="45" r="1.5" fill="rgba(255, 255, 255, 0.4)"/>
                                        <circle cx="34" cy="52" r="1" fill="rgba(255, 255, 255, 0.4)"/>
                                    </svg>
                                    <span>Mana Calculator</span>
                                </button>
                                {user ? (
                                    <>
                                        <button 
                                            className="btn btn-secondary"
                                            onClick={() => setView('mydecks')}
                                            style={{
                                                display: 'flex', 
                                                alignItems: 'center', 
                                                gap: '0.75rem',
                                                padding: '0.75rem 1.5rem',
                                                whiteSpace: 'nowrap',
                                                fontSize: '1.1rem'
                                            }}
                                        >
                                            <span style={{fontSize: '1.8rem'}}>üìö</span>
                                            <span>My Decks</span>
                                        </button>
                                        <button 
                                            className="btn btn-secondary"
                                            onClick={() => setShowSettings(true)}
                                            style={{
                                                display: 'flex', 
                                                alignItems: 'center', 
                                                justifyContent: 'center',
                                                width: '40px',
                                                height: '40px',
                                                padding: '0.5rem',
                                                fontSize: '1.2rem'
                                            }}
                                            title="Account Settings"
                                        >
                                            ‚öôÔ∏è
                                        </button>
                                        <button 
                                            className="btn btn-primary"
                                            onClick={handleLogout}
                                            style={{display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '0.5rem 1.2rem', lineHeight: 1.3}}
                                        >
                                            <span style={{fontWeight: 600, fontSize: '0.95rem'}}>
                                                üë§ {user.email}
                                            </span>
                                            <span style={{fontSize: '0.7rem', opacity: 0.9}}>
                                                Click to Logout
                                            </span>
                                        </button>
                                    </>
                                ) : (
                                    <button 
                                        className="btn btn-primary"
                                        onClick={() => setShowAuthModal(true)}
                                        style={{display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '0.5rem 1.2rem', lineHeight: 1.3}}
                                    >
                                        <span style={{fontWeight: 600, fontSize: '0.95rem'}}>
                                            Login / Sign Up
                                        </span>
                                        <span style={{fontSize: '0.7rem', opacity: 0.9}}>
                                            Save your decklists free!
                                        </span>
                                    </button>
                                )}
                            </div>
                        </div>
                    </header>
                    
                    {view === 'home' && (
                        <div className="container">
                            {/* MOBILE-ONLY: Simplified Action Menu */}
                            <div className="mobile-simple-home" style={{display: 'none'}}>
                                <div style={{textAlign: 'center', marginBottom: '2rem'}}>
                                    <div style={{display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.75rem', marginBottom: '1rem'}}>
                                        <svg width="50" height="50" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{filter: 'drop-shadow(2px 2px 4px rgba(0,0,0,0.5))'}}>
                                            <path d="M32 2C15.5 2 2 15.5 2 32c0 10 4.9 18.9 12.4 24.4v6.6c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-3.2h13.6v3.2c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-6.6C57.1 50.9 62 42 62 32 62 15.5 48.5 2 32 2z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="2" strokeLinejoin="miter"/>
                                            <ellipse cx="22" cy="26" rx="6" ry="8" fill="#000"/>
                                            <ellipse cx="42" cy="26" rx="6" ry="8" fill="#000"/>
                                            <path d="M22 28 L20 32 L22 34 M42 28 L44 32 L42 34" stroke="rgba(139, 111, 71, 0.3)" strokeWidth="1.5" fill="none"/>
                                            <path d="M28 34 Q32 37 36 34" fill="none" stroke="#000" strokeWidth="2"/>
                                            <path d="M32 36 L32 40" stroke="#000" strokeWidth="1.5"/>
                                            <rect x="26" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="29" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="32" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="35" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <path d="M15 30 Q12 32 15 34 M49 30 Q52 32 49 34" stroke="rgba(139, 111, 71, 0.4)" strokeWidth="1.5" fill="none"/>
                                            <path d="M18 32 C18 28, 20 26, 22 26 M46 32 C46 28, 44 26, 42 26" stroke="rgba(255,255,255,0.2)" strokeWidth="1" fill="none"/>
                                            <path d="M10 40 L14 36 L14 44 Z M54 40 L50 36 L50 44 Z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                        </svg>
                                        <h1 style={{fontFamily: 'Cinzel Decorative, serif', fontSize: '2.5rem', fontWeight: 700, color: 'var(--gold)', margin: 0, textShadow: '2px 2px 4px rgba(0,0,0,0.5)'}}>
                                            MTG Deck Skeleton
                                        </h1>
                                        <svg width="50" height="50" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{filter: 'drop-shadow(2px 2px 4px rgba(0,0,0,0.5))'}}>
                                            <path d="M32 2C15.5 2 2 15.5 2 32c0 10 4.9 18.9 12.4 24.4v6.6c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-3.2h13.6v3.2c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-6.6C57.1 50.9 62 42 62 32 62 15.5 48.5 2 32 2z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="2" strokeLinejoin="miter"/>
                                            <ellipse cx="22" cy="26" rx="6" ry="8" fill="#000"/>
                                            <ellipse cx="42" cy="26" rx="6" ry="8" fill="#000"/>
                                            <path d="M22 28 L20 32 L22 34 M42 28 L44 32 L42 34" stroke="rgba(139, 111, 71, 0.3)" strokeWidth="1.5" fill="none"/>
                                            <path d="M28 34 Q32 37 36 34" fill="none" stroke="#000" strokeWidth="2"/>
                                            <path d="M32 36 L32 40" stroke="#000" strokeWidth="1.5"/>
                                            <rect x="26" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="29" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="32" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="35" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <path d="M15 30 Q12 32 15 34 M49 30 Q52 32 49 34" stroke="rgba(139, 111, 71, 0.4)" strokeWidth="1.5" fill="none"/>
                                            <path d="M18 32 C18 28, 20 26, 22 26 M46 32 C46 28, 44 26, 42 26" stroke="rgba(255,255,255,0.2)" strokeWidth="1" fill="none"/>
                                            <path d="M10 40 L14 36 L14 44 Z M54 40 L50 36 L50 44 Z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                        </svg>
                                    </div>
                                    <p style={{color: 'var(--text-secondary)', fontSize: '1.1rem'}}>
                                        Track Commander deck ratios
                                    </p>
                                    {!user && (
                                        <p style={{
                                            color: 'var(--gold)',
                                            fontSize: '0.9rem',
                                            fontStyle: 'italic',
                                            marginTop: '0.5rem'
                                        }}>
                                            üíæ Create an account to save your decks
                                        </p>
                                    )}
                                </div>

                                <div style={{maxWidth: '500px', margin: '0 auto'}}>
                                    <button 
                                        className="mobile-action-button btn btn-primary"
                                        onClick={() => setShowCreateModal(true)}
                                    >
                                        <span>‚öîÔ∏è</span>
                                        <span>Create Deck</span>
                                    </button>

                                    <button 
                                        className="mobile-action-button btn btn-secondary"
                                        onClick={() => setView('browse')}
                                    >
                                        <span>üìö</span>
                                        <span>Browse Decks</span>
                                    </button>

                                    <button 
                                        className="mobile-action-button btn btn-secondary"
                                        onClick={() => setView('calculator')}
                                        style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            gap: '0.75rem'
                                        }}
                                    >
                                        <svg width="24" height="24" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{filter: 'drop-shadow(1px 1px 2px rgba(0,0,0,0.5))'}}>
                                            {/* Potion Flask */}
                                            <path d="M 24 8 L 24 22 L 20 32 Q 18 38 18 44 Q 18 52 22 56 Q 26 60 32 60 Q 38 60 42 56 Q 46 52 46 44 Q 46 38 44 32 L 40 22 L 40 8 Z" 
                                                  fill="rgba(66, 135, 245, 0.3)" 
                                                  stroke="var(--blue-mana)" 
                                                  strokeWidth="2.5"/>
                                            {/* Liquid inside */}
                                            <path d="M 21 36 Q 20 40 20 44 Q 20 50 23 54 Q 27 58 32 58 Q 37 58 41 54 Q 44 50 44 44 Q 44 40 43 36 Z" 
                                                  fill="rgba(136, 106, 234, 0.5)"/>
                                            {/* Cork/Stopper */}
                                            <rect x="26" y="4" width="12" height="6" rx="2" 
                                                  fill="var(--bone)" 
                                                  stroke="var(--border-color)" 
                                                  strokeWidth="1.5"/>
                                            {/* Highlights */}
                                            <ellipse cx="28" cy="30" rx="4" ry="8" 
                                                     fill="rgba(255, 255, 255, 0.3)"/>
                                            {/* Bubbles */}
                                            <circle cx="30" cy="48" r="2" fill="rgba(255, 255, 255, 0.4)"/>
                                            <circle cx="35" cy="45" r="1.5" fill="rgba(255, 255, 255, 0.4)"/>
                                            <circle cx="34" cy="52" r="1" fill="rgba(255, 255, 255, 0.4)"/>
                                        </svg>
                                        <span>Mana Calculator</span>
                                    </button>

                                    {user ? (
                                        <button 
                                            className="mobile-action-button btn btn-secondary"
                                            onClick={() => setView('mydecks')}
                                        >
                                            <span>üìö</span>
                                            <span>My Decks</span>
                                        </button>
                                    ) : (
                                        <button 
                                            className="mobile-action-button btn btn-primary"
                                            onClick={() => setShowAuthModal(true)}
                                        >
                                            <span>üîë</span>
                                            <span>Login / Sign Up</span>
                                        </button>
                                    )}

                                    <p style={{textAlign: 'center', color: 'var(--text-muted)', fontSize: '0.9rem', marginTop: '2rem'}}>
                                        No account needed to use the calculator!
                                    </p>
                                </div>

                                    {/* About Deck Skeleton - Expandable at bottom */}
                                    <button 
                                        onClick={() => setShowMobileAbout(!showMobileAbout)}
                                        style={{
                                            width: '100%',
                                            padding: '1rem',
                                            marginTop: '1.5rem',
                                            background: 'var(--bg-secondary)',
                                            border: '2px solid var(--border-color)',
                                            borderRadius: '12px',
                                            color: 'var(--text-primary)',
                                            fontSize: '1rem',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center'
                                        }}
                                    >
                                        <span>üìã About Deck Skeleton</span>
                                        <span>{showMobileAbout ? '‚ñº' : '‚ñ∂'}</span>
                                    </button>
                                    
                                    {showMobileAbout && (
                                        <div style={{
                                            padding: '1.2rem',
                                            marginTop: '1rem',
                                            background: 'var(--bg-tertiary)',
                                            border: '2px solid var(--accent)',
                                            borderRadius: '12px',
                                            fontSize: '0.95rem',
                                            lineHeight: '1.7',
                                            color: 'var(--text-secondary)'
                                        }}>
                                            <p style={{marginBottom: '0.8rem', fontWeight: 600, color: 'var(--accent-bright)'}}>
                                                Built for 100-card Commander Magic: The Gathering decks
                                            </p>
                                            <p style={{marginBottom: '0.8rem'}}>
                                                Track your deck by <strong>categories</strong> (Creatures, Non-Creature Spells, Lands) and <strong>subtypes</strong> (Removal, Ramp, Draw, Card Advantage, etc.)
                                            </p>
                                            <p style={{marginBottom: '0.8rem'}}>
                                                ‚ú® <strong>No card-by-card entry!</strong> Just track the counts of each type
                                            </p>
                                            <p style={{marginBottom: '0.8rem'}}>
                                                üìä Store deck ratios for quick editing and referencing
                                            </p>
                                            <p style={{marginBottom: 0}}>
                                                üéØ Deck didn't work? Adjust ratios easily and save with an account!
                                            </p>
                                        </div>
                                    )}

                                    {/* About Mana Calculator - Expandable button */}
                                    <button 
                                        onClick={() => setShowManaCalcAbout(!showManaCalcAbout)}
                                        style={{
                                            width: '100%',
                                            padding: '1rem',
                                            marginTop: '1rem',
                                            background: 'var(--bg-secondary)',
                                            border: '2px solid var(--border-color)',
                                            borderRadius: '12px',
                                            color: 'var(--text-primary)',
                                            fontSize: '1rem',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center'
                                        }}
                                    >
                                        <span>‚öóÔ∏è About Mana Calculator</span>
                                        <span>{showManaCalcAbout ? '‚ñº' : '‚ñ∂'}</span>
                                    </button>
                                    
                                    {showManaCalcAbout && (
                                        <div style={{
                                            padding: '1.2rem',
                                            marginTop: '1rem',
                                            background: 'var(--bg-tertiary)',
                                            border: '2px solid rgba(66, 135, 245, 0.5)',
                                            borderRadius: '12px',
                                            fontSize: '0.95rem',
                                            lineHeight: '1.7',
                                            color: 'var(--text-secondary)'
                                        }}>
                                            <p style={{marginBottom: '0.8rem', fontWeight: 600, color: 'rgba(66, 135, 245, 0.9)'}}>
                                                Calculate your optimal mana base for Commander
                                            </p>
                                            <p style={{marginBottom: '0.8rem'}}>
                                                üìä <strong>How it works:</strong> Enter your color pip requirements (like {'{W}{W}'} or {'{U}{B}{B}'}) and total lands
                                            </p>
                                            <p style={{marginBottom: '0.8rem'}}>
                                                üéØ <strong>Smart weighting:</strong> Double pips {'{U}{U}'} count more than single {'{U}'} because they're harder to cast
                                            </p>
                                            <p style={{marginBottom: '0.8rem'}}>
                                                üèîÔ∏è <strong>Dual lands:</strong> Include your Shocklands, Fetchlands, etc. to get accurate recommendations
                                            </p>
                                            <p style={{marginBottom: 0}}>
                                                ‚ú® Get the perfect land distribution for reliable color fixing!
                                            </p>
                                        </div>
                                    )}
                            </div>

                            {/* DESKTOP: Full detailed homepage */}
                            <div className="desktop-home-content">
                            <div className="hero">
                                <div style={{display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '1rem', marginBottom: '1rem'}}>
                                    <svg width="60" height="60" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{filter: 'drop-shadow(2px 2px 4px rgba(0,0,0,0.5))'}}>
                                        <path d="M32 2C15.5 2 2 15.5 2 32c0 10 4.9 18.9 12.4 24.4v6.6c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-3.2h13.6v3.2c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-6.6C57.1 50.9 62 42 62 32 62 15.5 48.5 2 32 2z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="2" strokeLinejoin="miter"/>
                                        <ellipse cx="22" cy="26" rx="6" ry="8" fill="#000"/>
                                        <ellipse cx="42" cy="26" rx="6" ry="8" fill="#000"/>
                                        <path d="M22 28 L20 32 L22 34 M42 28 L44 32 L42 34" stroke="rgba(139, 111, 71, 0.3)" strokeWidth="1.5" fill="none"/>
                                        <path d="M28 34 Q32 37 36 34" fill="none" stroke="#000" strokeWidth="2"/>
                                        <path d="M32 36 L32 40" stroke="#000" strokeWidth="1.5"/>
                                        <rect x="26" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                        <rect x="29" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                        <rect x="32" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                        <rect x="35" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                        <path d="M15 30 Q12 32 15 34 M49 30 Q52 32 49 34" stroke="rgba(139, 111, 71, 0.4)" strokeWidth="1.5" fill="none"/>
                                        <path d="M18 32 C18 28, 20 26, 22 26 M46 32 C46 28, 44 26, 42 26" stroke="rgba(255,255,255,0.2)" strokeWidth="1" fill="none"/>
                                        <path d="M10 40 L14 36 L14 44 Z M54 40 L50 36 L50 44 Z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                    </svg>
                                    <h1 style={{
                                        fontFamily: 'Cinzel Decorative, serif', 
                                        fontSize: '3.5rem', 
                                        fontWeight: 700,
                                        letterSpacing: '2px', 
                                        margin: 0,
                                        color: 'var(--gold)',
                                        textShadow: '3px 3px 6px rgba(0,0,0,0.7)'
                                    }}>MTG Deck Skeleton</h1>
                                    <svg width="60" height="60" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{filter: 'drop-shadow(2px 2px 4px rgba(0,0,0,0.5))'}}>
                                        <path d="M32 2C15.5 2 2 15.5 2 32c0 10 4.9 18.9 12.4 24.4v6.6c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-3.2h13.6v3.2c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-6.6C57.1 50.9 62 42 62 32 62 15.5 48.5 2 32 2z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="2" strokeLinejoin="miter"/>
                                        <ellipse cx="22" cy="26" rx="6" ry="8" fill="#000"/>
                                        <ellipse cx="42" cy="26" rx="6" ry="8" fill="#000"/>
                                        <path d="M22 28 L20 32 L22 34 M42 28 L44 32 L42 34" stroke="rgba(139, 111, 71, 0.3)" strokeWidth="1.5" fill="none"/>
                                        <path d="M28 34 Q32 37 36 34" fill="none" stroke="#000" strokeWidth="2"/>
                                        <path d="M32 36 L32 40" stroke="#000" strokeWidth="1.5"/>
                                        <rect x="26" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                        <rect x="29" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                        <rect x="32" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                        <rect x="35" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                        <path d="M15 30 Q12 32 15 34 M49 30 Q52 32 49 34" stroke="rgba(139, 111, 71, 0.4)" strokeWidth="1.5" fill="none"/>
                                        <path d="M18 32 C18 28, 20 26, 22 26 M46 32 C46 28, 44 26, 42 26" stroke="rgba(255,255,255,0.2)" strokeWidth="1" fill="none"/>
                                        <path d="M10 40 L14 36 L14 44 Z M54 40 L50 36 L50 44 Z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                    </svg>
                                </div>
                                <h2 style={{fontFamily: 'MedievalSharp, cursive', fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)', color: 'var(--bone)', marginTop: '0.5rem', marginBottom: '1.5rem'}}>+ Mana Calculator</h2>
                                
                                {/* Desktop: Simple tagline */}
                                <div className="desktop-only">
                                    <p style={{fontSize: '1.15rem', color: 'var(--text-secondary)', marginBottom: '2rem', lineHeight: '1.5'}}>
                                        Track your Commander deck ratios ‚Äî no card-by-card entry needed. Store, edit, and optimize your builds with ease.
                                    </p>
                                </div>
                                
                                {/* Action Buttons - MOVED UP */}
                                <div style={{
                                    display: 'flex', 
                                    gap: '1.5rem', 
                                    justifyContent: 'center', 
                                    marginBottom: '2rem',
                                    flexWrap: 'wrap'
                                }}>
                                    <button 
                                        className="btn btn-primary" 
                                        onClick={() => setShowCreateModal(true)}
                                        style={{
                                            padding: '1.2rem 2.5rem', 
                                            fontSize: '1.2rem',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.8rem'
                                        }}
                                    >
                                        <span style={{fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)'}}>‚öîÔ∏è</span>
                                        <span>Create a New Deck</span>
                                    </button>
                                    <button 
                                        className="btn btn-secondary" 
                                        onClick={() => setView('browse')}
                                        style={{
                                            padding: '1.2rem 2.5rem', 
                                            fontSize: '1.2rem',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.8rem'
                                        }}
                                    >
                                        <span style={{fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)'}}>üìö</span>
                                        <span>Browse Public Decks</span>
                                    </button>
                                    <button 
                                        className="btn btn-secondary" 
                                        onClick={() => {
                                            const calc = document.querySelector('.featured-calculator-box');
                                            if (calc) {
                                                const offset = 100;
                                                const elementPosition = calc.getBoundingClientRect().top;
                                                const offsetPosition = elementPosition + window.pageYOffset - offset;
                                                window.scrollTo({top: offsetPosition, behavior: 'smooth'});
                                            }
                                        }}
                                        style={{
                                            padding: '1.2rem 2.5rem', 
                                            fontSize: '1.2rem',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.8rem'
                                        }}
                                    >
                                        <span style={{fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)'}}>‚öóÔ∏è</span>
                                        <span>Mana Calculator</span>
                                    </button>
                                </div>
                                
                                {/* Mobile: Expandable info boxes - MOVED DOWN with MORE DETAIL */}
                                <div className="mobile-only">
                                    {/* Main Info Button */}
                                    <button 
                                        onClick={() => setShowInfoExpanded(!showInfoExpanded)}
                                        style={{
                                            width: '100%',
                                            padding: '1rem',
                                            marginBottom: '1rem',
                                            background: 'var(--bg-secondary)',
                                            border: '2px solid var(--border-color)',
                                            borderRadius: '12px',
                                            color: 'var(--text-primary)',
                                            fontSize: '1rem',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center'
                                        }}
                                    >
                                        <span>üìã What is Deck Skeleton?</span>
                                        <span>{showInfoExpanded ? '‚ñº' : '‚ñ∂'}</span>
                                    </button>
                                    
                                    {showInfoExpanded && (
                                        <div style={{
                                            padding: '1.2rem',
                                            marginBottom: '1rem',
                                            background: 'var(--bg-tertiary)',
                                            border: '2px solid var(--accent)',
                                            borderRadius: '12px',
                                            fontSize: '0.95rem',
                                            lineHeight: '1.7',
                                            color: 'var(--text-secondary)'
                                        }}>
                                            <p style={{marginBottom: '0.8rem', fontWeight: 600, color: 'var(--accent-bright)'}}>
                                                Built for 100-card Commander Magic: The Gathering decks
                                            </p>
                                            <p style={{marginBottom: '0.8rem'}}>
                                                Track your deck by <strong>categories</strong> (Creatures, Non-Creature Spells, Lands) and <strong>subtypes</strong> (Removal, Ramp, Draw, Card Advantage, etc.)
                                            </p>
                                            <p style={{marginBottom: '0.8rem'}}>
                                                ‚ú® <strong>No card-by-card entry!</strong> Just track the counts of each type
                                            </p>
                                            <p style={{marginBottom: '0.8rem'}}>
                                                üìä Store deck ratios for quick editing and referencing
                                            </p>
                                            <p style={{marginBottom: 0}}>
                                                üéØ Deck didn't work? Adjust ratios easily and save with an account!
                                            </p>
                                        </div>
                                    )}
                                    
                                    {/* Mana Calc Info Button */}
                                    <button 
                                        onClick={() => setShowManaCalcInfo(!showManaCalcInfo)}
                                        style={{
                                            width: '100%',
                                            padding: '1rem',
                                            marginBottom: '1rem',
                                            background: 'var(--bg-secondary)',
                                            border: '2px solid var(--border-color)',
                                            borderRadius: '12px',
                                            color: 'var(--text-primary)',
                                            fontSize: '1rem',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center'
                                        }}
                                    >
                                        <span>‚öóÔ∏è Mana Calculator Feature</span>
                                        <span>{showManaCalcInfo ? '‚ñº' : '‚ñ∂'}</span>
                                    </button>
                                    
                                    {showManaCalcInfo && (
                                        <div style={{
                                            padding: '1.2rem',
                                            marginBottom: '1.5rem',
                                            background: 'var(--bg-tertiary)',
                                            border: '2px solid var(--gold)',
                                            borderRadius: '12px',
                                            fontSize: '0.95rem',
                                            lineHeight: '1.7',
                                            color: 'var(--text-secondary)'
                                        }}>
                                            <p style={{marginBottom: '0.8rem', color: 'var(--gold)', fontWeight: 600, fontSize: '1.1rem'}}>
                                                ‚ö° Build optimal mana bases with precision!
                                            </p>
                                            <p style={{marginBottom: '0.8rem'}}>
                                                Enter your deck's mana symbols and let the calculator determine exactly how many lands of each color you need.
                                            </p>
                                            
                                            <div style={{background: 'var(--bg-primary)', padding: '1rem', borderRadius: '6px', marginTop: '1rem'}}>
                                                <p style={{marginBottom: '0.5rem', color: 'var(--gold)', fontWeight: 600}}>üéØ How It Works:</p>
                                                <ul style={{marginLeft: '1.2rem', marginBottom: 0, lineHeight: '1.8'}}>
                                                    <li><strong>Pip Counting:</strong> Counts all colored mana symbols (‚ö™‚ö´üî¥üîµüü¢) in your deck. Double/triple pips like {'{W}{W}'} count as 2 pips.</li>
                                                    <li><strong>Percentage Distribution:</strong> Calculates what % of your colored mana comes from each color.</li>
                                                    <li><strong>Land Allocation:</strong> Distributes your total lands proportionally based on pip percentages.</li>
                                                    <li><strong>Dual Land Credit:</strong> Subtracts dual lands from basic land needs (e.g., if you need 12 white sources and have 4 W/U duals, you only need 8 basic Plains).</li>
                                                    <li><strong>Tri-Land Magic:</strong> In 3-color decks, each tri-land counts as 1 source for all 3 colors!</li>
                                                </ul>
                                            </div>
                                            
                                            <p style={{marginTop: '1rem', marginBottom: 0, color: 'var(--gold)', fontSize: '0.9rem'}}>
                                                ‚ú® Best for 1-3 color decks (mono, dual, or tri-color)
                                            </p>
                                        </div>
                                    )}
                                </div>
                                
                                <p style={{fontSize: '0.9rem', color: 'var(--text-muted)', marginTop: '0.5rem'}}>
                                    No account needed to use! Create an account to save your decks.
                                </p>
                            </div>


                            <div id="public-decks" style={{marginTop: '5rem', marginBottom: '3rem'}}>
                                {/* Introduction to the Tool - MOVED UP */}
                                <div style={{
                                    maxWidth: '900px',
                                    margin: '0 auto 4rem auto',
                                    background: 'var(--bg-card)',
                                    border: '1px solid var(--border-color)',
                                    borderRadius: '12px',
                                    padding: '2.5rem',
                                    textAlign: 'left'
                                }}>
                                    <h2 style={{
                                        fontFamily: 'Pirata One, cursive',
                                        fontSize: '2.2rem',
                                        color: 'var(--gold)',
                                        marginBottom: '1.5rem',
                                        textAlign: 'center'
                                    }}>
                                        Track Your Commander Deck Ratios
                                    </h2>
                                    
                                    <p style={{
                                        fontSize: '1.1rem',
                                        lineHeight: '1.8',
                                        color: 'var(--text-primary)',
                                        marginBottom: '1.5rem'
                                    }}>
                                        Building a Commander deck can be overwhelming. Which ratios work best? How many creatures versus removal? 
                                        Our deck ratio tracker lets you <strong style={{color: 'var(--accent-bright)'}}>focus on the big picture</strong> without 
                                        getting lost in individual card names.
                                    </p>

                                    <div style={{
                                        background: 'var(--bg-tertiary)',
                                        border: '1px solid var(--accent)',
                                        borderRadius: '12px',
                                        padding: '1.5rem',
                                        marginBottom: '1.5rem'
                                    }}>
                                        <div style={{fontWeight: 600, color: 'var(--gold)', marginBottom: '1rem', fontSize: '1.1rem'}}>
                                            üìä Example: Building a Vampire Tribal Deck
                                        </div>
                                        <div style={{color: 'var(--text-secondary)', lineHeight: '1.7'}}>
                                            <strong>Instead of listing every card:</strong><br/>
                                            ‚ùå "Sol Ring, Arcane Signet, Talisman of Hierarchy, Phyrexian Arena, Necropotence..."<br/>
                                            <br/>
                                            <strong>Track your ratios:</strong><br/>
                                            ‚úÖ 36 Lands ‚Ä¢ 38 Creatures ‚Ä¢ 25 Non-Creature Spells<br/>
                                            ‚úÖ 12 Ramp Sources ‚Ä¢ 10 Removal Spells ‚Ä¢ 8 Card Draw<br/>
                                            ‚úÖ 30 Vampires ‚Ä¢ 8 Support Creatures
                                        </div>
                                    </div>

                                    <div style={{
                                        display: 'grid',
                                        gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
                                        gap: '1.5rem',
                                        marginBottom: '1.5rem'
                                    }}>
                                        <div style={{
                                            background: 'var(--bg-secondary)',
                                            padding: '1.2rem',
                                            borderRadius: '12px',
                                            border: '1px solid var(--border-color)'
                                        }}>
                                            <div style={{fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)', marginBottom: '0.5rem'}}>‚ö°</div>
                                            <div style={{fontWeight: 600, marginBottom: '0.5rem', color: 'var(--accent-bright)'}}>Quick Overview</div>
                                            <div style={{fontSize: '0.9rem', color: 'var(--text-secondary)', lineHeight: '1.6'}}>
                                                See your deck's structure at a glance. Perfect for identifying imbalances before building.
                                            </div>
                                        </div>

                                        <div style={{
                                            background: 'var(--bg-secondary)',
                                            padding: '1.2rem',
                                            borderRadius: '12px',
                                            border: '1px solid var(--border-color)'
                                        }}>
                                            <div style={{fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)', marginBottom: '0.5rem'}}>üíæ</div>
                                            <div style={{fontWeight: 600, marginBottom: '0.5rem', color: 'var(--accent-bright)'}}>Easy Reference</div>
                                            <div style={{fontSize: '0.9rem', color: 'var(--text-secondary)', lineHeight: '1.6'}}>
                                                Store your current deck ratios for easy tweaking and future reference when brewing new decks.
                                            </div>
                                        </div>

                                        <div style={{
                                            background: 'var(--bg-secondary)',
                                            padding: '1.2rem',
                                            borderRadius: '12px',
                                            border: '1px solid var(--border-color)'
                                        }}>
                                            <div style={{fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)', marginBottom: '0.5rem'}}>üéØ</div>
                                            <div style={{fontWeight: 600, marginBottom: '0.5rem', color: 'var(--accent-bright)'}}>üìà No Card Names Needed</div>
                                            <div style={{fontSize: '0.9rem', color: 'var(--text-secondary)', lineHeight: '1.6'}}>
                                                Skip the tedious card-by-card entry. Focus on strategy and structure, not inventory.
                                            </div>
                                        </div>
                                    </div>

                                    <p style={{
                                        fontSize: '1rem',
                                        color: 'var(--text-secondary)',
                                        textAlign: 'center',
                                        marginTop: '2rem'
                                    }}>
                                        Whether you're fine-tuning an existing deck or planning a new brew, 
                                        our ratio tracker helps you <strong style={{color: 'var(--accent-bright)'}}>build better, faster</strong>.
                                    </p>
                                </div>

                                {/* Example Deck Showcase - NOW SECOND */}
                                <div style={{
                                    maxWidth: '1100px',
                                    margin: '0 auto 5rem auto',
                                    background: 'var(--bg-card)',
                                    border: '2px solid var(--accent)',
                                    borderRadius: '16px',
                                    padding: '2.5rem',
                                    boxShadow: '0 8px 32px rgba(0, 0, 0, 0.3)'
                                }}>
                                    <div style={{textAlign: 'center', marginBottom: '2rem'}}>
                                        <h2 style={{
                                            fontFamily: 'Pirata One, cursive',
                                            fontSize: '2.2rem',
                                            color: 'var(--gold)',
                                            marginBottom: '0.5rem'
                                        }}>
                                            üìã See It In Action
                                        </h2>
                                        <p style={{fontSize: '1.05rem', color: 'var(--text-secondary)'}}>
                                            Here's what a tracked Commander deck looks like
                                        </p>
                                    </div>

                                    {/* Example Deck Card */}
                                    <div style={{
                                        background: 'var(--bg-tertiary)',
                                        border: '2px solid var(--border-color)',
                                        borderRadius: '12px',
                                        padding: '2rem',
                                        marginBottom: '2rem'
                                    }}>
                                        {/* Deck Header */}
                                        <div style={{marginBottom: '1.5rem'}}>
                                            <h3 style={{
                                                fontFamily: 'Pirata One, cursive',
                                                fontSize: '1.8rem',
                                                color: 'var(--accent-bright)',
                                                marginBottom: '0.5rem'
                                            }}>
                                                Atraxa Superfriends
                                            </h3>
                                            <div style={{color: 'var(--text-secondary)', marginBottom: '0.5rem'}}>
                                                Commander: Atraxa, Praetors' Voice
                                            </div>
                                            <div style={{display: 'flex', gap: '0.3rem', marginBottom: '1rem'}}>
                                                <div className="mana-pip pip-W"></div>
                                                <div className="mana-pip pip-U"></div>
                                                <div className="mana-pip pip-B"></div>
                                                <div className="mana-pip pip-G"></div>
                                            </div>
                                        </div>

                                        {/* Main Categories */}
                                        <div style={{
                                            display: 'grid',
                                            gridTemplateColumns: 'repeat(auto-fit, minmax(140px, 1fr))',
                                            gap: '1rem',
                                            marginBottom: '2rem'
                                        }}>
                                            <div style={{
                                                background: 'var(--bg-secondary)',
                                                padding: '1rem',
                                                borderRadius: '12px',
                                                border: '1px solid rgba(212, 175, 55, 0.3)',
                                                textAlign: 'center'
                                            }}>
                                                <div style={{fontSize: '2rem', fontWeight: 700, color: 'var(--accent-bright)', marginBottom: '0.3rem'}}>37</div>
                                                <div style={{fontSize: '0.85rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '0.5px'}}>Lands</div>
                                            </div>
                                            <div style={{
                                                background: 'var(--bg-secondary)',
                                                padding: '1rem',
                                                borderRadius: '12px',
                                                border: '1px solid rgba(212, 175, 55, 0.3)',
                                                textAlign: 'center'
                                            }}>
                                                <div style={{fontSize: '2rem', fontWeight: 700, color: 'var(--accent-bright)', marginBottom: '0.3rem'}}>18</div>
                                                <div style={{fontSize: '0.85rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '0.5px'}}>Creatures</div>
                                            </div>
                                            <div style={{
                                                background: 'var(--bg-secondary)',
                                                padding: '1rem',
                                                borderRadius: '12px',
                                                border: '1px solid rgba(212, 175, 55, 0.3)',
                                                textAlign: 'center'
                                            }}>
                                                <div style={{fontSize: '2rem', fontWeight: 700, color: 'var(--accent-bright)', marginBottom: '0.3rem'}}>44</div>
                                                <div style={{fontSize: '0.85rem', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '0.5px'}}>Spells</div>
                                            </div>
                                        </div>

                                        {/* Subtype Breakdown */}
                                        <div style={{
                                            background: 'rgba(212, 175, 55, 0.1)',
                                            border: '1px solid rgba(212, 175, 55, 0.3)',
                                            borderRadius: '12px',
                                            padding: '1.5rem'
                                        }}>
                                            <h4 style={{
                                                color: 'var(--accent-bright)',
                                                marginBottom: '1rem',
                                                fontSize: '1.1rem',
                                                fontWeight: 600
                                            }}>
                                                üìä Subtype Breakdown
                                            </h4>
                                            <div style={{
                                                display: 'grid',
                                                gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                                                gap: '0.8rem',
                                                fontSize: '0.95rem'
                                            }}>
                                                <div style={{display: 'flex', justifyContent: 'space-between', padding: '0.5rem', background: 'var(--bg-secondary)', borderRadius: '4px'}}>
                                                    <span style={{color: 'var(--text-secondary)'}}>Planeswalkers:</span>
                                                    <strong style={{color: 'var(--accent-bright)'}}>26</strong>
                                                </div>
                                                <div style={{display: 'flex', justifyContent: 'space-between', padding: '0.5rem', background: 'var(--bg-secondary)', borderRadius: '4px'}}>
                                                    <span style={{color: 'var(--text-secondary)'}}>Ramp:</span>
                                                    <strong style={{color: 'var(--accent-bright)'}}>12</strong>
                                                </div>
                                                <div style={{display: 'flex', justifyContent: 'space-between', padding: '0.5rem', background: 'var(--bg-secondary)', borderRadius: '4px'}}>
                                                    <span style={{color: 'var(--text-secondary)'}}>Card Draw:</span>
                                                    <strong style={{color: 'var(--accent-bright)'}}>8</strong>
                                                </div>
                                                <div style={{display: 'flex', justifyContent: 'space-between', padding: '0.5rem', background: 'var(--bg-secondary)', borderRadius: '4px'}}>
                                                    <span style={{color: 'var(--text-secondary)'}}>Removal:</span>
                                                    <strong style={{color: 'var(--accent-bright)'}}>10</strong>
                                                </div>
                                                <div style={{display: 'flex', justifyContent: 'space-between', padding: '0.5rem', background: 'var(--bg-secondary)', borderRadius: '4px'}}>
                                                    <span style={{color: 'var(--text-secondary)'}}>Board Wipes:</span>
                                                    <strong style={{color: 'var(--accent-bright)'}}>4</strong>
                                                </div>
                                                <div style={{display: 'flex', justifyContent: 'space-between', padding: '0.5rem', background: 'var(--bg-secondary)', borderRadius: '4px'}}>
                                                    <span style={{color: 'var(--text-secondary)'}}>Protection:</span>
                                                    <strong style={{color: 'var(--accent-bright)'}}>6</strong>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Key Point */}
                                    <div style={{
                                        textAlign: 'center',
                                        padding: '1.5rem',
                                        background: 'linear-gradient(135deg, rgba(66, 135, 245, 0.1) 0%, rgba(136, 106, 234, 0.1) 100%)',
                                        border: '1px solid rgba(66, 135, 245, 0.3)',
                                        borderRadius: '8px'
                                    }}>
                                        <div style={{fontSize: '1.1rem', color: 'var(--text-primary)', marginBottom: '0.5rem'}}>
                                            <strong>üí™ That's the power of ratio tracking!</strong>
                                        </div>
                                        <div style={{fontSize: '0.95rem', color: 'var(--text-secondary)'}}>
                                            No card names entered‚Äîjust counts. See your deck structure instantly, tweak ratios easily, and build better decks faster.
                                        </div>
                                    </div>
                                </div>


                                {/* Mana Base Calculator */}
                                <div className="featured-calculator-box" style={{
                                    background: 'linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(196, 167, 125, 0.05) 100%)',
                                    border: '2px solid var(--gold)',
                                    borderRadius: '16px',
                                    padding: '2rem',
                                    marginBottom: '3rem',
                                    position: 'relative',
                                    overflow: 'hidden',
                                    maxWidth: '1200px',
                                    margin: '0 auto 3rem auto'
                                }}>
                                    <div style={{textAlign: 'center', marginBottom: '2rem'}}>
                                        <div style={{
                                            display: 'inline-flex',
                                            alignItems: 'center',
                                            gap: '0.8rem',
                                            background: 'var(--bg-card)',
                                            padding: '0.8rem 1.5rem',
                                            borderRadius: '50px',
                                            marginBottom: '1rem',
                                            border: '1px solid var(--gold)'
                                        }}>
                                            <span style={{fontSize: '1.8rem'}}>‚öóÔ∏è</span>
                                            <span style={{
                                                fontFamily: 'Pirata One, cursive',
                                                fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)',
                                                color: 'var(--gold)',
                                                fontWeight: 700
                                            }}>
                                                Mana Base Calculator
                                            </span>
                                        </div>
                                        <p style={{fontSize: '1.1rem', color: 'var(--text-secondary)', maxWidth: '700px', margin: '0 auto'}}>
                                            Calculate the perfect land distribution for your Commander deck based on color requirements
                                        </p>
                                    </div>

                                    <StandaloneManaCalculator />
                                </div>
                        </div>
                        {/* End desktop-home-content */}
                            </div>
                        </div>
                    )}
                    {showCreateModal && (
                        <CreateDeckModal 
                            initialData={deckToCopy}
                            user={user}
                            setShowAuthModal={setShowAuthModal}
                            onClose={() => {
                                setShowCreateModal(false);
                                setDeckToCopy(null);
                            }}
                            onSave={async (deck) => {
                                const newDeck = { ...deck, id: Date.now() };
                                
                                // Save to Firebase if logged in
                                if (user) {
                                    const saved = await saveDeckToFirebase(newDeck);
                                    if (saved) {
                                        await loadDecksFromFirebase(user.uid);
                                    }
                                } else {
                                    // Not logged in - just save locally
                                    setDecks([...decks, newDeck]);
                                }
                                
                                setShowCreateModal(false);
                                setDeckToCopy(null);
                            }}
                        />
                    )}

                    {showEditModal && deckToEdit && (
                        <EditDeckModal 
                            deck={deckToEdit}
                            user={user}
                            setShowAuthModal={setShowAuthModal}
                            onClose={() => {
                                setShowEditModal(false);
                                setDeckToEdit(null);
                            }}
                            onSave={async (updatedDeck) => {
                                if (!user) {
                                    alert('You must be logged in to save changes');
                                    return;
                                }

                                // Use deck.id (from props) as the source of truth
                                const deckId = deckToEdit.id;
                                
                                console.log("=== SAVE DECK DEBUG ===");
                                console.log("Deck ID:", deckId);
                                console.log("User UID:", user.uid);
                                console.log("Deck userId:", deckToEdit.userId);
                                console.log("UpdatedDeck data:", updatedDeck);
                                console.log("=====================");

                                // Verify ownership
                                if (deckToEdit.userId && deckToEdit.userId !== user.uid) {
                                    alert('‚ö†Ô∏è Permission Denied\n\nYou can only edit your own decks.\n\nThis deck belongs to another user.');
                                    return;
                                }

                                try {
                                    // First, check if document exists and verify ownership
                                    const deckRef = db.collection("decks").doc(String(deckId));
                                    const deckDoc = await deckRef.get();
                                    
                                    if (deckDoc.exists) {
                                        const existingData = deckDoc.data();
                                        if (existingData.userId && existingData.userId !== user.uid) {
                                            alert('‚ö†Ô∏è Permission Denied\n\nThis deck belongs to another user.\n\nUse "Build Similar Deck" to create your own copy!');
                                            return;
                                        }
                                    }
                                    
                                    // Use set with merge instead of update - handles both create and update cases
                                    await db.collection("decks").doc(String(deckId)).set({
                                        name: updatedDeck.name,
                                        commander: updatedDeck.commander,
                                        colors: updatedDeck.colors,
                                        categories: updatedDeck.categories,
                                        sideboard: updatedDeck.sideboard || {},
                                        notableCards: updatedDeck.notableCards || [],
                                        isPublic: updatedDeck.isPublic,
                                        userId: user.uid,
                                        lands: updatedDeck.lands || 0,
                                        creatures: updatedDeck.creatures || 0,
                                        noncreature: updatedDeck.noncreature || 0,
                                        updatedAt: new Date(),
                                        // Keep createdAt if it exists, otherwise set it
                                        createdAt: deckToEdit.createdAt || new Date()
                                    }, { merge: true });

                                    // Handle public collection syncing
                                    if (updatedDeck.isPublic) {
                                        await addToPublicDecks({
                                            ...updatedDeck, 
                                            id: deckId,
                                            userId: user.uid
                                        });
                                    } else {
                                        await removeFromPublicDecks(deckId);
                                    }

                                    // Reload decks from Firebase
                                    await loadDecksFromFirebase(user.uid);
                                    await loadPublicDecks();
                                    
                                    // Close modal
                                    setShowEditModal(false);
                                    setDeckToEdit(null);
                                    setSelectedDeck(null);
                                    
                                    alert('‚úÖ Deck updated successfully!');
                                } catch (error) {
                                    console.error('Error updating deck:', error);
                                    
                                    let errorMessage = 'Error updating deck:\n\n';
                                    
                                    if (error.code === 'permission-denied') {
                                        errorMessage += '‚ùå Permission Denied\n\n';
                                        errorMessage += 'Possible causes:\n';
                                        errorMessage += '1. Firestore security rules need to be updated\n';
                                        errorMessage += '2. This deck belongs to another user\n';
                                        errorMessage += '3. The document doesn\'t exist in your decks collection\n\n';
                                        errorMessage += `Debug info:\n`;
                                        errorMessage += `- Deck ID: ${deckId}\n`;
                                        errorMessage += `- Your UID: ${user.uid}\n`;
                                        errorMessage += `- Deck owner: ${deckToEdit.userId || 'unknown'}\n\n`;
                                        errorMessage += 'Try using "Build Similar Deck" instead to create your own copy!';
                                    } else {
                                        errorMessage += error.message;
                                    }
                                    
                                    alert(errorMessage);
                                }
                            }}
                        />
                    )}

                     {showAuthModal && (
                        <AuthModal 
                            onClose={() => setShowAuthModal(false)}
                            onSignUp={handleSignUp}
                            onLogin={handleLogin}
                        />
                    )}

                    {/* Settings Modal */}
                    {showSettings && user && (
                        <SettingsModal 
                            onClose={() => setShowSettings(false)}
                            user={user}
                            decks={decks}
                            addToPublicDecks={addToPublicDecks}
                            removeFromPublicDecks={removeFromPublicDecks}
                            loadPublicDecks={loadPublicDecks}
                        />
                    )}

                    {/* Bug Report Modal */}
                    {showBugReportModal && (
                        <BugReportModal
                            onClose={() => setShowBugReportModal(false)}
                            onSubmit={submitBugReport}
                        />
                    )}

                    {/* Mana Calculator View - Simplified for Mobile */}
                    {view === 'calculator' && (
                        <div className="container" style={{
                            minHeight: '100vh',
                            background: 'var(--bg-primary)',
                            padding: '1rem'
                        }}>
                            <div style={{
                                maxWidth: '100%',
                                margin: '0 auto'
                            }}>
                                {/* Header with Back Button and Title */}
                                <div style={{
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '1rem',
                                    marginBottom: '1.5rem',
                                    paddingBottom: '1rem',
                                    borderBottom: '2px solid var(--border-color)'
                                }}>
                                    <button 
                                        className="btn btn-secondary"
                                        onClick={() => setView('home')}
                                        style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.5rem',
                                            fontSize: '0.9rem',
                                            padding: '0.5rem 1rem'
                                        }}
                                    >
                                        <span>üè†</span>
                                        <span>Back</span>
                                    </button>
                                    
                                    <div style={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '0.8rem',
                                        flex: 1
                                    }}>
                                        <svg width="40" height="40" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{filter: 'drop-shadow(2px 2px 4px rgba(0,0,0,0.5))'}}>
                                            <path d="M32 2C15.5 2 2 15.5 2 32c0 10 4.9 18.9 12.4 24.4v6.6c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-3.2h13.6v3.2c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-6.6C57.1 50.9 62 42 62 32 62 15.5 48.5 2 32 2z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="2" strokeLinejoin="miter"/>
                                            <ellipse cx="22" cy="26" rx="6" ry="8" fill="#000"/>
                                            <ellipse cx="42" cy="26" rx="6" ry="8" fill="#000"/>
                                            <path d="M22 28 L20 32 L22 34 M42 28 L44 32 L42 34" stroke="rgba(139, 111, 71, 0.3)" strokeWidth="1.5" fill="none"/>
                                            <path d="M28 34 Q32 37 36 34" fill="none" stroke="#000" strokeWidth="2"/>
                                            <path d="M32 36 L32 40" stroke="#000" strokeWidth="1.5"/>
                                            <rect x="26" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="29" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="32" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="35" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <path d="M15 30 Q12 32 15 34 M49 30 Q52 32 49 34" stroke="rgba(139, 111, 71, 0.4)" strokeWidth="1.5" fill="none"/>
                                            <path d="M18 32 C18 28, 20 26, 22 26 M46 32 C46 28, 44 26, 42 26" stroke="rgba(255,255,255,0.2)" strokeWidth="1" fill="none"/>
                                            <path d="M10 40 L14 36 L14 44 Z M54 40 L50 36 L50 44 Z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                        </svg>
                                        <h2 style={{
                                            fontFamily: 'Pirata One, cursive',
                                            color: 'var(--gold)',
                                            margin: 0,
                                            fontSize: '1.8rem'
                                        }}>
                                            ‚öóÔ∏è Mana Base Calculator
                                        </h2>
                                    </div>
                                </div>
                                
                                <StandaloneManaCalculator />
                            </div>
                        </div>
                    )}

                    {/* My Decks View */}
                    {view === 'mydecks' && (
                        <div className="container">
                            <div style={{
                                maxWidth: '1200px',
                                margin: '3rem auto',
                                padding: '2rem'
                            }}>
                                <div style={{
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center',
                                    marginBottom: '2rem',
                                    flexWrap: 'wrap',
                                    gap: '1rem'
                                }}>
                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.75rem'}}>
                                        <svg width="45" height="45" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{filter: 'drop-shadow(2px 2px 4px rgba(0,0,0,0.5))'}}>
                                            <path d="M32 2C15.5 2 2 15.5 2 32c0 10 4.9 18.9 12.4 24.4v6.6c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-3.2h13.6v3.2c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-6.6C57.1 50.9 62 42 62 32 62 15.5 48.5 2 32 2z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="2" strokeLinejoin="miter"/>
                                            <ellipse cx="22" cy="26" rx="6" ry="8" fill="#000"/>
                                            <ellipse cx="42" cy="26" rx="6" ry="8" fill="#000"/>
                                            <path d="M22 28 L20 32 L22 34 M42 28 L44 32 L42 34" stroke="rgba(139, 111, 71, 0.3)" strokeWidth="1.5" fill="none"/>
                                            <path d="M28 34 Q32 37 36 34" fill="none" stroke="#000" strokeWidth="2"/>
                                            <path d="M32 36 L32 40" stroke="#000" strokeWidth="1.5"/>
                                            <rect x="26" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="29" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="32" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="35" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <path d="M15 30 Q12 32 15 34 M49 30 Q52 32 49 34" stroke="rgba(139, 111, 71, 0.4)" strokeWidth="1.5" fill="none"/>
                                            <path d="M18 32 C18 28, 20 26, 22 26 M46 32 C46 28, 44 26, 42 26" stroke="rgba(255,255,255,0.2)" strokeWidth="1" fill="none"/>
                                            <path d="M10 40 L14 36 L14 44 Z M54 40 L50 36 L50 44 Z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                        </svg>
                                        <h1 style={{
                                            fontFamily: 'Pirata One, cursive',
                                            fontSize: '2.5rem',
                                            color: 'var(--bone)',
                                            margin: 0,
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '1rem',
                                            flexWrap: 'wrap'
                                        }}>
                                            My Decks
                                            <span style={{
                                                padding: '0.5rem 1rem',
                                                background: 'rgba(212, 175, 55, 0.15)',
                                                border: '2px solid var(--gold)',
                                                borderRadius: '12px',
                                                color: 'var(--gold)',
                                                fontSize: '1rem',
                                                fontWeight: 600,
                                                fontFamily: 'Cinzel, serif'
                                            }}>
                                                {decks.filter(d => !d.isExample).length}/100
                                            </span>
                                        </h1>
                                        <svg width="45" height="45" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{filter: 'drop-shadow(2px 2px 4px rgba(0,0,0,0.5))'}}>
                                            <path d="M32 2C15.5 2 2 15.5 2 32c0 10 4.9 18.9 12.4 24.4v6.6c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-3.2h13.6v3.2c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-6.6C57.1 50.9 62 42 62 32 62 15.5 48.5 2 32 2z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="2" strokeLinejoin="miter"/>
                                            <ellipse cx="22" cy="26" rx="6" ry="8" fill="#000"/>
                                            <ellipse cx="42" cy="26" rx="6" ry="8" fill="#000"/>
                                            <path d="M22 28 L20 32 L22 34 M42 28 L44 32 L42 34" stroke="rgba(139, 111, 71, 0.3)" strokeWidth="1.5" fill="none"/>
                                            <path d="M28 34 Q32 37 36 34" fill="none" stroke="#000" strokeWidth="2"/>
                                            <path d="M32 36 L32 40" stroke="#000" strokeWidth="1.5"/>
                                            <rect x="26" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="29" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="32" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="35" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <path d="M15 30 Q12 32 15 34 M49 30 Q52 32 49 34" stroke="rgba(139, 111, 71, 0.4)" strokeWidth="1.5" fill="none"/>
                                            <path d="M18 32 C18 28, 20 26, 22 26 M46 32 C46 28, 44 26, 42 26" stroke="rgba(255,255,255,0.2)" strokeWidth="1" fill="none"/>
                                            <path d="M10 40 L14 36 L14 44 Z M54 40 L50 36 L50 44 Z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                        </svg>
                                    </div>
                                    <div style={{display: 'flex', gap: '1rem', alignItems: 'center'}}>
                                        {decks.filter(d => !d.isExample).length > 0 && !deleteMode && (
                                            <button 
                                                className="btn btn-secondary"
                                                onClick={() => setDeleteMode(true)}
                                                style={{
                                                    display: 'flex', 
                                                    alignItems: 'center', 
                                                    gap: '0.5rem',
                                                    background: 'rgba(211, 32, 42, 0.2)',
                                                    borderColor: 'var(--red-mana)'
                                                }}
                                            >
                                                <span>üóëÔ∏è</span>
                                                <span>Delete Decks</span>
                                            </button>
                                        )}
                                        {deleteMode && (
                                            <>
                                                <button 
                                                    className="btn btn-primary"
                                                    onClick={handleDeleteDecks}
                                                    disabled={selectedDecksToDelete.length === 0}
                                                    style={{
                                                        display: 'flex', 
                                                        alignItems: 'center', 
                                                        gap: '0.5rem',
                                                        opacity: selectedDecksToDelete.length === 0 ? 0.5 : 1
                                                    }}
                                                >
                                                    <span>üóëÔ∏è</span>
                                                    <span>Delete {selectedDecksToDelete.length > 0 ? `(${selectedDecksToDelete.length})` : ''}</span>
                                                </button>
                                                <button 
                                                    className="btn btn-secondary"
                                                    onClick={() => {
                                                        setDeleteMode(false);
                                                        setSelectedDecksToDelete([]);
                                                    }}
                                                    style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}
                                                >
                                                    <span>‚úñÔ∏è</span>
                                                    <span>Cancel</span>
                                                </button>
                                            </>
                                        )}
                                        <button 
                                            className="btn btn-secondary"
                                            onClick={() => setView('home')}
                                            style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}
                                        >
                                            <span>üè†</span>
                                            <span>Back to Home</span>
                                        </button>
                                    </div>
                                </div>

                                {/* Search Bar for My Decks */}
                                {user && decks.filter(d => !d.isExample).length > 0 && (
                                    <div style={{marginBottom: '2rem'}}>
                                        <input
                                            type="text"
                                            value={myDecksSearch}
                                            onChange={(e) => setMyDecksSearch(e.target.value)}
                                            placeholder="üîç Search by deck name or commander..."
                                            style={{
                                                width: '100%',
                                                padding: '1rem',
                                                background: 'var(--bg-tertiary)',
                                                border: '2px solid var(--border-color)',
                                                borderRadius: '12px',
                                                color: 'var(--text-primary)',
                                                fontSize: '1.1rem',
                                                fontFamily: 'Cinzel'
                                            }}
                                        />
                                    </div>
                                )}

                                {user ? (
                                    decks.filter(d => !d.isExample).length > 0 ? (
                                        <div style={{
                                            display: 'grid',
                                            gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))',
                                            gap: '1.5rem'
                                        }}>
                                            {decks
                                                .filter(d => !d.isExample)
                                                .filter(deck => {
                                                    if (!myDecksSearch) return true;
                                                    const search = myDecksSearch.toLowerCase();
                                                    return deck.name.toLowerCase().includes(search) ||
                                                           deck.commander.toLowerCase().includes(search);
                                                })
                                                .map((deck) => (
                                                <div
                                                    key={deck.id}
                                                    style={{
                                                        background: 'var(--gradient-card)',
                                                        border: deleteMode && selectedDecksToDelete.includes(deck.id) 
                                                            ? '3px solid var(--red-mana)' 
                                                            : deck.isExample ? '2px solid var(--gold)' : '2px solid var(--border-color)',
                                                        borderRadius: '12px',
                                                        padding: '1.5rem',
                                                        cursor: deleteMode ? 'default' : 'pointer',
                                                        transition: 'all 0.3s ease',
                                                        position: 'relative',
                                                        ':hover': {
                                                            borderColor: 'var(--gold)',
                                                            transform: 'translateY(-2px)'
                                                        }
                                                    }}
                                                    onClick={() => deleteMode ? toggleDeckSelection(deck.id) : setSelectedDeck(deck)}
                                                >
                                                    {deleteMode && (
                                                        <div style={{
                                                            position: 'absolute',
                                                            top: '1rem',
                                                            left: '1rem',
                                                            zIndex: 10
                                                        }}>
                                                            <input 
                                                                type="checkbox"
                                                                checked={selectedDecksToDelete.includes(deck.id)}
                                                                onChange={() => toggleDeckSelection(deck.id)}
                                                                onClick={(e) => e.stopPropagation()}
                                                                style={{
                                                                    width: '24px',
                                                                    height: '24px',
                                                                    cursor: 'pointer'
                                                                }}
                                                            />
                                                        </div>
                                                    )}
                                                    {deck.isExample && (
                                                        <div style={{
                                                            position: 'absolute',
                                                            top: '0.5rem',
                                                            right: '0.5rem',
                                                            background: 'var(--gold)',
                                                            color: 'var(--bg-primary)',
                                                            padding: '0.25rem 0.5rem',
                                                            borderRadius: '4px',
                                                            fontSize: '0.7rem',
                                                            fontWeight: 700,
                                                            textTransform: 'uppercase'
                                                        }}>
                                                            EXAMPLE
                                                        </div>
                                                    )}
                                                    <h3 style={{
                                                        fontFamily: 'MedievalSharp, cursive',
                                                        color: 'var(--bone)',
                                                        marginBottom: '0.5rem',
                                                        fontSize: window.innerWidth <= 768 ? '1.6rem' : '1.3rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)',
                                                        paddingRight: deck.isExample ? '5rem' : '0'
                                                    }}>
                                                        {deck.name}
                                                    </h3>
                                                    <p style={{
                                                        color: 'var(--text-secondary)',
                                                        marginBottom: '1rem',
                                                        fontSize: '0.9rem'
                                                    }}>
                                                        Commander: {deck.commander}
                                                    </p>
                                                    <div style={{
                                                        display: 'flex',
                                                        gap: '0.5rem',
                                                        marginBottom: '1rem'
                                                    }}>
                                                        {deck.colors && deck.colors.map(color => (
                                                            <span key={color} style={{
                                                                width: '24px',
                                                                height: '24px',
                                                                borderRadius: '50%',
                                                                background: color === 'W' ? 'var(--white-mana)' :
                                                                           color === 'U' ? 'var(--blue-mana)' :
                                                                           color === 'B' ? 'var(--black-mana)' :
                                                                           color === 'R' ? 'var(--red-mana)' :
                                                                           color === 'G' ? 'var(--green-mana)' :
                                                                           'var(--colorless-mana)',
                                                                border: '2px solid var(--border-color)'
                                                            }}></span>
                                                        ))}
                                                    </div>
                                                    <div style={{
                                                        color: 'var(--text-muted)',
                                                        fontSize: '0.85rem'
                                                    }}>
                                                        Click to view details
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div style={{
                                            textAlign: 'center',
                                            padding: '4rem 2rem',
                                            background: 'var(--bg-card)',
                                            borderRadius: '12px',
                                            border: '2px dashed var(--border-color)'
                                        }}>
                                            <p style={{
                                                fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)',
                                                color: 'var(--text-secondary)',
                                                marginBottom: '1rem'
                                            }}>
                                                No decks yet!
                                            </p>
                                            <p style={{
                                                color: 'var(--text-muted)',
                                                marginBottom: '2rem'
                                            }}>
                                                Create your first deck to get started
                                            </p>
                                            <button 
                                                className="btn btn-primary"
                                                onClick={() => {
                                                    setView('home');
                                                    setShowCreateModal(true);
                                                }}
                                            >
                                                ‚öîÔ∏è Create Your First Deck
                                            </button>
                                        </div>
                                    )
                                ) : (
                                    <div style={{
                                        textAlign: 'center',
                                        padding: '4rem 2rem',
                                        background: 'var(--bg-card)',
                                        borderRadius: '12px'
                                    }}>
                                        <p style={{
                                            fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)',
                                            color: 'var(--text-secondary)',
                                            marginBottom: '2rem'
                                        }}>
                                            Please log in to view your decks
                                        </p>
                                        <button 
                                            className="btn btn-primary"
                                            onClick={() => {
                                                setView('home');
                                                setShowAuthModal(true);
                                            }}
                                        >
                                            Login / Sign Up
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}


                    {/* Browse Public Decks View */}
                    {view === 'browse' && (
                        <div className="container">
                            <div style={{
                                maxWidth: '1200px',
                                margin: '3rem auto',
                                padding: window.innerWidth <= 768 ? '1rem 0.5rem' : '2rem'
                            }}>
                                <div style={{
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center',
                                    marginBottom: '2rem',
                                    flexWrap: 'wrap',
                                    gap: '1rem'
                                }}>
                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.75rem'}}>
                                        <svg width="45" height="45" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{filter: 'drop-shadow(2px 2px 4px rgba(0,0,0,0.5))'}}>
                                            <path d="M32 2C15.5 2 2 15.5 2 32c0 10 4.9 18.9 12.4 24.4v6.6c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-3.2h13.6v3.2c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-6.6C57.1 50.9 62 42 62 32 62 15.5 48.5 2 32 2z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="2" strokeLinejoin="miter"/>
                                            <ellipse cx="22" cy="26" rx="6" ry="8" fill="#000"/>
                                            <ellipse cx="42" cy="26" rx="6" ry="8" fill="#000"/>
                                            <path d="M22 28 L20 32 L22 34 M42 28 L44 32 L42 34" stroke="rgba(139, 111, 71, 0.3)" strokeWidth="1.5" fill="none"/>
                                            <path d="M28 34 Q32 37 36 34" fill="none" stroke="#000" strokeWidth="2"/>
                                            <path d="M32 36 L32 40" stroke="#000" strokeWidth="1.5"/>
                                            <rect x="26" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="29" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="32" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="35" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <path d="M15 30 Q12 32 15 34 M49 30 Q52 32 49 34" stroke="rgba(139, 111, 71, 0.4)" strokeWidth="1.5" fill="none"/>
                                            <path d="M18 32 C18 28, 20 26, 22 26 M46 32 C46 28, 44 26, 42 26" stroke="rgba(255,255,255,0.2)" strokeWidth="1" fill="none"/>
                                            <path d="M10 40 L14 36 L14 44 Z M54 40 L50 36 L50 44 Z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                        </svg>
                                        <h1 style={{
                                            fontFamily: 'Pirata One, cursive',
                                            fontSize: '2.5rem',
                                            color: 'var(--bone)',
                                            margin: 0
                                        }}>
                                            Browse Public Decks
                                        </h1>
                                        <svg width="45" height="45" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{filter: 'drop-shadow(2px 2px 4px rgba(0,0,0,0.5))'}}>
                                            <path d="M32 2C15.5 2 2 15.5 2 32c0 10 4.9 18.9 12.4 24.4v6.6c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-3.2h13.6v3.2c0 1.5 1.2 2.7 2.7 2.7h5.4c1.5 0 2.7-1.2 2.7-2.7v-6.6C57.1 50.9 62 42 62 32 62 15.5 48.5 2 32 2z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="2" strokeLinejoin="miter"/>
                                            <ellipse cx="22" cy="26" rx="6" ry="8" fill="#000"/>
                                            <ellipse cx="42" cy="26" rx="6" ry="8" fill="#000"/>
                                            <path d="M22 28 L20 32 L22 34 M42 28 L44 32 L42 34" stroke="rgba(139, 111, 71, 0.3)" strokeWidth="1.5" fill="none"/>
                                            <path d="M28 34 Q32 37 36 34" fill="none" stroke="#000" strokeWidth="2"/>
                                            <path d="M32 36 L32 40" stroke="#000" strokeWidth="1.5"/>
                                            <rect x="26" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="29" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="32" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <rect x="35" y="40" width="3" height="8" rx="0.5" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                            <path d="M15 30 Q12 32 15 34 M49 30 Q52 32 49 34" stroke="rgba(139, 111, 71, 0.4)" strokeWidth="1.5" fill="none"/>
                                            <path d="M18 32 C18 28, 20 26, 22 26 M46 32 C46 28, 44 26, 42 26" stroke="rgba(255,255,255,0.2)" strokeWidth="1" fill="none"/>
                                            <path d="M10 40 L14 36 L14 44 Z M54 40 L50 36 L50 44 Z" fill="var(--bone)" stroke="var(--border-color)" strokeWidth="0.8"/>
                                        </svg>
                                    </div>
                                    <div style={{display: 'flex', gap: '1rem', alignItems: 'center'}}>
                                        <button 
                                            className="btn btn-secondary"
                                            onClick={() => {
                                                loadPublicDecks();
                                                alert('üîÑ Public decks refreshed!');
                                            }}
                                            style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}
                                        >
                                            <span>üîÑ</span>
                                            <span>Refresh</span>
                                        </button>
                                        <button 
                                            className="btn btn-secondary"
                                            onClick={() => setView('home')}
                                            style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}
                                        >
                                            <span>üè†</span>
                                            <span>Back to Home</span>
                                        </button>
                                    </div>
                                </div>

                                {/* Search Bar */}
                                <div style={{marginBottom: '1rem'}}>
                                    <input
                                        type="text"
                                        value={browseSearch}
                                        onChange={(e) => setBrowseSearch(e.target.value)}
                                        placeholder="üîç Search by deck name or commander..."
                                        style={{
                                            width: '100%',
                                            padding: '1rem',
                                            background: 'var(--bg-tertiary)',
                                            border: '2px solid var(--border-color)',
                                            borderRadius: '12px',
                                            color: 'var(--text-primary)',
                                            fontSize: '1.1rem',
                                            fontFamily: 'Cinzel'
                                        }}
                                    />
                                </div>

                                {/* Sort Dropdown */}
                                <div style={{marginBottom: '2rem', display: 'flex', alignItems: 'center', gap: '1rem'}}>
                                    <label style={{
                                        color: 'var(--text-secondary)',
                                        fontSize: '1rem',
                                        fontWeight: 600
                                    }}>
                                        Sort by:
                                    </label>
                                    <select
                                        value={browseSortBy}
                                        onChange={(e) => setBrowseSortBy(e.target.value)}
                                        style={{
                                            padding: '0.75rem 1rem',
                                            background: 'var(--bg-tertiary)',
                                            border: '2px solid var(--border-color)',
                                            borderRadius: '12px',
                                            color: 'var(--text-primary)',
                                            fontSize: '1rem',
                                            fontFamily: 'Pirata One, cursive',
                                            cursor: 'pointer',
                                            minWidth: '200px'
                                        }}
                                    >
                                        <option value="newest">üìÖ Newest First</option>
                                        <option value="mostViewed">üëÅÔ∏è Most Viewed</option>
                                        <option value="mostBuilt">üèóÔ∏è Most Built</option>
                                    </select>
                                </div>

                                {publicDecks.length > 0 ? (
                                    <div style={{
                                        display: 'grid',
                                        gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))',
                                        gap: '1.5rem'
                                    }}>
                                        {publicDecks
                                            .filter(deck => {
                                                if (!browseSearch) return true;
                                                const search = browseSearch.toLowerCase();
                                                return deck.name.toLowerCase().includes(search) ||
                                                       deck.commander.toLowerCase().includes(search);
                                            })
                                            .sort((a, b) => {
                                                // Sort based on selected option
                                                if (browseSortBy === 'mostViewed') {
                                                    return (b.viewCount || 0) - (a.viewCount || 0);
                                                } else if (browseSortBy === 'mostBuilt') {
                                                    return (b.buildSimilarCount || 0) - (a.buildSimilarCount || 0);
                                                } else { // 'newest'
                                                    return (b.updatedAt?.toDate?.() || new Date(0)) - (a.updatedAt?.toDate?.() || new Date(0));
                                                }
                                            })
                                            .map((deck) => (
                                                <div
                                                    key={deck.id}
                                                    style={{
                                                        background: 'var(--gradient-card)',
                                                        border: '2px solid var(--border-color)',
                                                        borderRadius: '12px',
                                                        padding: '1.5rem',
                                                        cursor: 'pointer',
                                                        transition: 'all 0.3s ease',
                                                        ':hover': {
                                                            borderColor: 'var(--gold)',
                                                            transform: 'translateY(-2px)'
                                                        }
                                                    }}
                                                    onClick={async () => {
                                                        console.log("üñ±Ô∏è Deck card clicked, ID:", deck.id);
                                                        // Increment view count when deck is clicked
                                                        await incrementViewCount(deck.id);
                                                        // Reload public decks to show updated count
                                                        await loadPublicDecks();
                                                        setSelectedDeck(deck);
                                                    }}
                                                >
                                                    <h3 style={{
                                                        fontFamily: 'Pirata One, cursive',
                                                        color: 'var(--accent-bright)',
                                                        marginBottom: '0.75rem',
                                                        fontSize: window.innerWidth <= 768 ? '1.6rem' : '1.3rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)'
                                                    }}>
                                                        {deck.name}
                                                    </h3>
                                                    <div style={{
                                                        color: 'var(--text-secondary)',
                                                        marginBottom: '1rem',
                                                        fontSize: '0.95rem'
                                                    }}>
                                                        Commander: {deck.commander}
                                                    </div>
                                                    <div style={{
                                                        display: 'flex',
                                                        gap: '0.3rem',
                                                        marginBottom: '1rem'
                                                    }}>
                                                        {deck.colors && deck.colors.map(color => (
                                                            <div key={color} className={`mana-pip pip-${color}`}></div>
                                                        ))}
                                                    </div>
                                                    
                                                    {/* Stats Display */}
                                                    <div style={{
                                                        display: 'flex',
                                                        gap: '1rem',
                                                        marginBottom: '1rem',
                                                        fontSize: '0.85rem',
                                                        color: 'var(--accent-bright)'
                                                    }}>
                                                        <div style={{
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            gap: '0.3rem'
                                                        }}>
                                                            <span>üëÅÔ∏è</span>
                                                            <span>{deck.viewCount || 0} views</span>
                                                        </div>
                                                        <div style={{
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            gap: '0.3rem'
                                                        }}>
                                                            <span>üèóÔ∏è</span>
                                                            <span>{deck.buildSimilarCount || 0} builds</span>
                                                        </div>
                                                    </div>
                                                    
                                                    <div style={{
                                                        display: 'flex',
                                                        justifyContent: 'space-between',
                                                        fontSize: '0.85rem',
                                                        color: 'var(--text-muted)'
                                                    }}>
                                                        <span>üåç Public Deck</span>
                                                        <span>Click to View</span>
                                                    </div>
                                                </div>
                                            ))}
                                    </div>
                                ) : (
                                    <div style={{
                                        textAlign: 'center',
                                        padding: '4rem 2rem',
                                        background: 'var(--bg-secondary)',
                                        borderRadius: '12px',
                                        border: '1px solid var(--border-color)'
                                    }}>
                                        <div style={{fontSize: '3rem', marginBottom: '1rem'}}>üìö</div>
                                        <h3 style={{
                                            color: 'var(--accent-bright)',
                                            marginBottom: '1rem'
                                        }}>
                                            No Public Decks Yet
                                        </h3>
                                        <p style={{color: 'var(--text-secondary)', lineHeight: '1.6'}}>
                                            Be the first to share your deck! Create a deck and toggle "Make Public"<br/>
                                            to add it to this community collection.
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}


                    {selectedDeck && (
                        <div style={{
                            position: 'fixed',
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            background: 'rgba(0, 0, 0, 0.85)',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            zIndex: 1000,
                            padding: '2rem'
                        }}
                        onClick={() => setSelectedDeck(null)}
                        >
                            <div style={{
                                background: 'var(--bg-card)',
                                border: '2px solid var(--accent)',
                                borderRadius: '16px',
                                padding: '2.5rem',
                                maxWidth: '900px',
                                width: '100%',
                                maxHeight: '90vh',
                                overflow: 'auto'
                            }}
                            onClick={(e) => e.stopPropagation()}
                            >
                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '1.5rem'}}>
                                    <div>
                                        <h2 style={{fontFamily: 'Pirata One, cursive', fontSize: '2rem', color: 'var(--accent-bright)', marginBottom: '0.5rem'}}>
                                            {selectedDeck.name}
                                        </h2>
                                        <div style={{color: 'var(--text-secondary)', marginBottom: '0.5rem'}}>
                                            Commander: {selectedDeck.commander}
                                        </div>
                                        <div style={{display: 'flex', gap: '0.3rem', marginBottom: '0.5rem'}}>
                                            {selectedDeck.colors.map(color => (
                                                <div key={color} className={`mana-pip pip-${color}`}></div>
                                            ))}
                                        </div>
                                        <div style={{
                                            color: 'var(--accent-bright)', 
                                            fontSize: '0.9rem', 
                                            fontWeight: 600,
                                            textTransform: 'uppercase'
                                        }}>
                                            {selectedDeck.strategy}
                                        </div>
                                    </div>
                                    <button 
                                        onClick={() => setSelectedDeck(null)}
                                        style={{
                                            background: 'transparent',
                                            border: 'none',
                                            fontSize: '2rem',
                                            cursor: 'pointer',
                                            color: 'var(--text-muted)',
                                            padding: '0',
                                            lineHeight: 1
                                        }}
                                    >
                                        √ó
                                    </button>
                                </div>

                                {/* Main Categories */}
                                <div style={{
                                    display: 'grid',
                                    gridTemplateColumns: 'repeat(3, 1fr)',
                                    gap: window.innerWidth <= 768 ? '0.5rem' : '1rem',
                                    marginBottom: '2rem'
                                }}>
                                    <div style={{background: 'var(--bg-secondary)', padding: window.innerWidth <= 768 ? '0.75rem 0.5rem' : '1rem', borderRadius: '12px', textAlign: 'center'}}>
                                        <div style={{fontSize: '2rem', fontWeight: 700, color: 'var(--accent-bright)'}}>{selectedDeck.lands}</div>
                                        <div style={{fontSize: '0.85rem', color: 'var(--text-muted)'}}>LANDS</div>
                                    </div>
                                    <div style={{background: 'var(--bg-secondary)', padding: window.innerWidth <= 768 ? '0.75rem 0.5rem' : '1rem', borderRadius: '12px', textAlign: 'center'}}>
                                        <div style={{fontSize: '2rem', fontWeight: 700, color: 'var(--accent-bright)'}}>{selectedDeck.creatures}</div>
                                        <div style={{fontSize: window.innerWidth <= 768 ? '0.75rem' : '0.85rem', color: 'var(--text-muted)'}}>
                                            {window.innerWidth <= 768 ? 'CREAT.' : 'CREATURES'}
                                        </div>
                                    </div>
                                    <div style={{background: 'var(--bg-secondary)', padding: window.innerWidth <= 768 ? '0.75rem 0.5rem' : '1rem', borderRadius: '12px', textAlign: 'center'}}>
                                        <div style={{fontSize: '2rem', fontWeight: 700, color: 'var(--accent-bright)'}}>{selectedDeck.noncreature}</div>
                                        <div style={{fontSize: window.innerWidth <= 768 ? '0.75rem' : '0.85rem', color: 'var(--text-muted)'}}>
                                            {window.innerWidth <= 768 ? 'NON-CREAT.' : 'NON-CREATURE SPELLS'}
                                        </div>
                                    </div>
                                </div>

                                {/* Subtype Breakdown - Like Homepage Example */}
                                {selectedDeck.categories && Object.keys(selectedDeck.categories).length > 0 && (
                                    <div style={{
                                        background: 'rgba(212, 175, 55, 0.1)',
                                        border: '1px solid rgba(212, 175, 55, 0.3)',
                                        borderRadius: '12px',
                                        padding: '1.5rem',
                                        marginBottom: '2rem'
                                    }}>
                                        <h4 style={{
                                            color: 'var(--accent-bright)',
                                            marginBottom: '1rem',
                                            fontSize: '1.1rem',
                                            fontWeight: 600
                                        }}>
                                            üìä Subtype Breakdown
                                        </h4>
                                        <div style={{
                                            display: 'grid',
                                            gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                                            gap: '0.8rem',
                                            fontSize: '0.95rem'
                                        }}>
                                            {Object.entries(selectedDeck.categories)
                                                .filter(([key, value]) => value > 0 && !key.includes('-quick'))
                                                .slice(0, 12)
                                                .map(([key, value]) => {
                                                    // Find the display name
                                                    let displayName = key;
                                                    Object.values(DECK_CATEGORIES).forEach(majorGroup => {
                                                        majorGroup.categories.forEach(category => {
                                                            category.subcategories.forEach(sub => {
                                                                if (sub.id === key) displayName = sub.name;
                                                            });
                                                        });
                                                    });
                                                    
                                                    return (
                                                        <div key={key} style={{display: 'flex', justifyContent: 'space-between', padding: '0.5rem', background: 'var(--bg-secondary)', borderRadius: '4px'}}>
                                                            <span style={{color: 'var(--text-secondary)'}}>{displayName}:</span>
                                                            <strong style={{color: 'var(--accent-bright)'}}>{value}</strong>
                                                        </div>
                                                    );
                                                })}
                                        </div>
                                    </div>
                                )}

                                {/* Action Buttons */}
                                <div style={{display: 'flex', gap: '1rem', marginTop: '1.5rem', flexDirection: 'column'}}>
                                    {selectedDeck.isExample && (
                                        <div style={{
                                            background: 'rgba(212, 175, 55, 0.2)',
                                            border: '1px solid var(--gold)',
                                            borderRadius: '12px',
                                            padding: '1rem',
                                            color: 'var(--text-secondary)',
                                            fontSize: '0.9rem',
                                            textAlign: 'center'
                                        }}>
                                            üí° <strong>Example Deck:</strong> This is a sample deck for demonstration purposes. You can use "Build Similar Deck" to create your own version with these ratios!
                                        </div>
                                    )}
                                    
                                    <div style={{display: 'flex', gap: '1rem'}}>
                                        {!selectedDeck.isExample && (
                                            <button
                                                className="btn btn-secondary"
                                                style={{flex: 1}}
                                                onClick={async () => {
                                                    // If this is the user's own deck from Browse, find and open the personal version
                                                    if (view === 'browse' && user && selectedDeck.userId === user.uid) {
                                                        try {
                                                            console.log("Finding personal version of deck:", selectedDeck.name);
                                                            
                                                            // Try to find by ID first
                                                            let personalDeck = decks.find(d => d.id === selectedDeck.id);
                                                            
                                                            // If not found by ID, search by name and commander
                                                            if (!personalDeck) {
                                                                console.log("Not found by ID, searching by name and commander...");
                                                                personalDeck = decks.find(d => 
                                                                    d.name === selectedDeck.name && 
                                                                    d.commander === selectedDeck.commander &&
                                                                    d.userId === user.uid
                                                                );
                                                            }
                                                            
                                                            if (personalDeck) {
                                                                console.log("‚úÖ Found personal deck!", personalDeck.id);
                                                                // Close preview
                                                                setSelectedDeck(null);
                                                                // Open edit modal with personal deck
                                                                setDeckToEdit(personalDeck);
                                                                setShowEditModal(true);
                                                            } else {
                                                                // Not found in loaded decks - try fetching from Firestore
                                                                console.log("Not in loaded decks, querying Firestore...");
                                                                
                                                                const querySnapshot = await db.collection("decks")
                                                                    .where("userId", "==", user.uid)
                                                                    .where("name", "==", selectedDeck.name)
                                                                    .where("commander", "==", selectedDeck.commander)
                                                                    .limit(1)
                                                                    .get();
                                                                
                                                                if (!querySnapshot.empty) {
                                                                    const doc = querySnapshot.docs[0];
                                                                    console.log("‚úÖ Found in Firestore!", doc.id);
                                                                    setSelectedDeck(null);
                                                                    setDeckToEdit({ ...doc.data(), id: doc.id });
                                                                    setShowEditModal(true);
                                                                } else {
                                                                    console.log("‚ö†Ô∏è Deck not found anywhere");
                                                                    alert('‚ö†Ô∏è Deck Not Found in Personal Collection\n\nThis deck exists in Browse but not in your My Decks.\n\nUse "Build Similar Deck" to create your own copy!');
                                                                }
                                                            }
                                                        } catch (error) {
                                                            console.error("Error finding deck:", error);
                                                            alert('Error loading deck: ' + error.message + '\n\nTry using "Build Similar Deck" instead!');
                                                        }
                                                        
                                                        return;
                                                    }
                                                    
                                                    // Not the owner, or viewing from My Decks - just view it
                                                    setDeckToEdit(selectedDeck);
                                                    setSelectedDeck(null);
                                                    setShowEditModal(true);
                                                }}
                                            >
                                                {view === 'browse' && user && selectedDeck.userId === user.uid ? (
                                                    '‚úèÔ∏è Edit in My Decks'
                                                ) : (
                                                    'üìã See Full Deck'
                                                )}
                                            </button>
                                        )}
                                        <button
                                            className="btn btn-primary"
                                            style={{flex: 1}}
                                            onClick={async () => {
                                                // Increment build count if this is a public deck (has viewCount field)
                                                if (selectedDeck.viewCount !== undefined && selectedDeck.id) {
                                                    await incrementBuildCount(selectedDeck.id);
                                                    // Reload public decks to show updated count
                                                    await loadPublicDecks();
                                                }
                                                // Set the deck to copy and open create modal
                                                setDeckToCopy(selectedDeck);
                                                setSelectedDeck(null);
                                                setShowCreateModal(true);
                                            }}
                                        >
                                            ‚öîÔ∏è Build Similar Deck
                                        </button>
                                    </div>
                                    
                                    {selectedDeck.isExample && (
                                        <div style={{
                                            fontSize: '0.85rem',
                                            color: 'var(--text-muted)',
                                            textAlign: 'center',
                                            fontStyle: 'italic'
                                        }}>
                                            Example decks are for reference only. Create an account to save your own decks!
                                        </div>
                                    )}
                                </div>

                                <div style={{
                                    textAlign: 'center',
                                    padding: '1rem',
                                    marginTop: '1.5rem',
                                    background: 'rgba(66, 135, 245, 0.1)',
                                    borderRadius: '12px',
                                    color: 'var(--text-secondary)',
                                    fontSize: '0.9rem'
                                }}>
                                    üí° {selectedDeck.id ? 'Click "Build Similar Deck" to start with these ratios and customize them!' : `This shows the ratio structure of a ${selectedDeck.strategy.toLowerCase()} strategy deck`}
                                </div>
                            </div>
                        </div>
                    )}
                </>
            );
        }

        function StandaloneManaCalculator() {
            const [pipCounts, setPipCounts] = useState({
                W: { single: 0, double: 0, triple: 0 },
                U: { single: 0, double: 0, triple: 0 },
                B: { single: 0, double: 0, triple: 0 },
                R: { single: 0, double: 0, triple: 0 },
                G: { single: 0, double: 0, triple: 0 }
            });
            const [dualLands, setDualLands] = useState({
                WU: 0, WB: 0, WR: 0, WG: 0,
                UB: 0, UR: 0, UG: 0,
                BR: 0, BG: 0,
                RG: 0
            });
            const [totalLands, setTotalLands] = useState(38);
            const [triLands, setTriLands] = useState(0);
            const [otherLands, setOtherLands] = useState(0);
            const [showResults, setShowResults] = useState(false);
            const [manaCalculation, setManaCalculation] = useState(null);
            const [randomQuote, setRandomQuote] = useState('');
            const [showPipsHelp, setShowPipsHelp] = useState(false);
            const [showLandsHelp, setShowLandsHelp] = useState(false);
            const [showPipsSection, setShowPipsSection] = useState(false);
            const [showLandsSection, setShowLandsSection] = useState(false);
            const [showTopHelp, setShowTopHelp] = useState(false);

            const calculateManaBase = () => {
                const colors = ['W', 'U', 'B', 'R', 'G'];
                const colorNames = {W: 'White', U: 'Blue', B: 'Black', R: 'Red', G: 'Green'};
                
                const totalPips = {};
                let grandTotal = 0;
                
                // Calculate pips from commander/cards
                colors.forEach(color => {
                    const pips = pipCounts[color];
                    const total = pips.single + (pips.double * 2) + (pips.triple * 3);
                    totalPips[color] = total;
                    grandTotal += total;
                });

                // Determine deck colors based on which colors have pips
                const deckColors = colors.filter(color => totalPips[color] > 0);

                // Add tri-lands auto-calculation for 3-color decks
                const triLandPips = calculateTriLandPips(triLands, deckColors);
                colors.forEach(color => {
                    totalPips[color] += triLandPips[color];
                    grandTotal += triLandPips[color];
                });

                if (grandTotal === 0) {
                    alert('Please enter at least one mana pip to calculate your mana base.');
                    return;
                }

                const recommendations = {};
                const totalDualLands = Object.values(dualLands).reduce((a, b) => a + b, 0);
                const totalMultiLands = totalDualLands + triLands;
                const totalOccupiedSlots = totalMultiLands + otherLands;
                const availableForBasics = totalLands - totalOccupiedSlots;

                colors.forEach(color => {
                    const percentage = (totalPips[color] / grandTotal) * 100;
                    const rawSources = (totalPips[color] / grandTotal) * totalLands;
                    
                    let dualContribution = 0;
                    Object.entries(dualLands).forEach(([pair, count]) => {
                        if (pair.includes(color)) {
                            dualContribution += count;
                        }
                    });

                    // Add tri-lands contribution for 3-color decks
                    let triContribution = 0;
                    if (deckColors.length === 3 && deckColors.includes(color)) {
                        triContribution = triLands;
                    }

                    const totalMultiContribution = dualContribution + triContribution;
                    const neededBasics = Math.max(0, Math.round(rawSources - totalMultiContribution));
                    
                    recommendations[color] = {
                        pips: totalPips[color],
                        percentage: percentage.toFixed(1),
                        totalSources: Math.round(rawSources),
                        fromDuals: dualContribution,
                        fromTri: triContribution,
                        basicsNeeded: neededBasics,
                        name: colorNames[color]
                    };
                });

                const totalBasicsNeeded = Object.values(recommendations)
                    .reduce((sum, rec) => sum + rec.basicsNeeded, 0);

                const result = {
                    recommendations,
                    totalPips: grandTotal,
                    totalDuals: totalDualLands,
                    triLands: triLands,
                    otherLands: otherLands,
                    totalMultiLands: totalMultiLands,
                    totalOccupiedSlots: totalOccupiedSlots,
                    totalBasicsNeeded,
                    availableForBasics,
                    isValid: totalBasicsNeeded <= availableForBasics
                };

                // Pick a random funny quote
                const randomIndex = Math.floor(Math.random() * FUNNY_MANA_QUOTES.length);
                setRandomQuote(FUNNY_MANA_QUOTES[randomIndex]);

                setManaCalculation(result);
                setShowResults(true);
            };

            const updatePipCount = (color, type, value) => {
                setPipCounts(prev => ({
                    ...prev,
                    [color]: {
                        ...prev[color],
                        [type]: parseInt(value) || 0
                    }
                }));
            };

            const updateDualLands = (pair, value) => {
                setDualLands(prev => ({
                    ...prev,
                    [pair]: parseInt(value) || 0
                }));
            };

            const colorPairs = [
                {pair: 'WU', colors: ['W', 'U'], name: 'Azorius'},
                {pair: 'WB', colors: ['W', 'B'], name: 'Orzhov'},
                {pair: 'WR', colors: ['W', 'R'], name: 'Boros'},
                {pair: 'WG', colors: ['W', 'G'], name: 'Selesnya'},
                {pair: 'UB', colors: ['U', 'B'], name: 'Dimir'},
                {pair: 'UR', colors: ['U', 'R'], name: 'Izzet'},
                {pair: 'UG', colors: ['U', 'G'], name: 'Simic'},
                {pair: 'BR', colors: ['B', 'R'], name: 'Rakdos'},
                {pair: 'BG', colors: ['B', 'G'], name: 'Golgari'},
                {pair: 'RG', colors: ['R', 'G'], name: 'Gruul'}
            ];

            return (
                <div className="mana-calculator" style={{maxWidth: '100%', margin: '0 auto'}}>
                    {/* Top Help Button */}
                    <div style={{marginBottom: '1.5rem', textAlign: 'right'}}>
                        <button
                            className="btn btn-secondary"
                            onClick={() => setShowTopHelp(!showTopHelp)}
                            style={{
                                padding: '0.5rem 1rem',
                                fontSize: '0.9rem',
                                display: 'inline-flex',
                                alignItems: 'center',
                                gap: '0.5rem'
                            }}
                        >
                            {showTopHelp ? '‚ñº Hide Help' : '‚ÑπÔ∏è Help'}
                        </button>
                    </div>
                    
                    {/* Expandable Help Section */}
                    {showTopHelp && (
                        <div style={{
                            background: 'var(--bg-secondary)',
                            border: '2px solid var(--border-color)',
                            borderRadius: '12px',
                            padding: '1.5rem',
                            marginBottom: '1.5rem',
                            fontSize: '0.95rem',
                            lineHeight: '1.6'
                        }}>
                            <h3 style={{
                                fontFamily: 'Pirata One, cursive',
                                color: 'var(--gold)',
                                marginTop: 0,
                                marginBottom: '1rem',
                                fontSize: window.innerWidth <= 768 ? '1.6rem' : '1.3rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)'
                            }}>
                                üìö How to Use the Mana Calculator
                            </h3>
                            
                            <div style={{
                                color: 'var(--gold)', 
                                marginBottom: '1.5rem',
                                padding: '0.8rem',
                                background: 'rgba(212, 175, 55, 0.1)',
                                borderLeft: '3px solid var(--gold)',
                                fontWeight: 600
                            }}>
                                ‚ö° Quick Start Guide
                            </div>
                            
                            <div style={{color: 'var(--text-primary)', marginBottom: '1rem'}}>
                                <strong>Step 1: Enter Your Total Lands</strong><br/>
                                <span style={{color: 'var(--text-secondary)'}}>
                                    Start with how many lands you want (usually 36-40). Tri-lands and utility lands will be subtracted from this total.
                                </span>
                            </div>
                            
                            <div style={{color: 'var(--text-primary)', marginBottom: '1rem'}}>
                                <strong>Step 2: Count Mana Pips from Spells</strong><br/>
                                <span style={{color: 'var(--text-secondary)'}}>
                                    Count colored mana symbols in your spells. The calculator weights them: {'{W}{W}'} counts more than {'{1}{W}'}.
                                </span>
                            </div>
                            
                            <div style={{color: 'var(--text-primary)', marginBottom: '1rem'}}>
                                <strong>Step 3: Count Your Dual Lands</strong><br/>
                                <span style={{color: 'var(--text-secondary)'}}>
                                    Enter your dual lands (shocklands, fetchlands, etc.).
                                </span>
                            </div>
                            
                            <div style={{
                                background: 'rgba(212, 175, 55, 0.15)',
                                border: '1px solid var(--gold)',
                                borderRadius: '12px',
                                padding: '1rem',
                                marginTop: '1rem'
                            }}>
                                <strong style={{color: 'var(--gold)'}}>üí° Result:</strong>
                                <p style={{margin: '0.5rem 0 0 0', color: 'var(--text-secondary)'}}>
                                    The calculator tells you exactly how many basic lands of each color you need to reliably cast your spells!
                                </p>
                            </div>
                            
                            <div style={{
                                background: 'rgba(66, 135, 245, 0.1)',
                                border: '1px solid rgba(66, 135, 245, 0.3)',
                                borderRadius: '12px',
                                padding: '1rem',
                                marginTop: '1rem'
                            }}>
                                <strong style={{color: 'var(--accent-bright)'}}>üìù Important Notes:</strong>
                                <ul style={{marginLeft: '1.5rem', marginTop: '0.5rem', marginBottom: 0, color: 'var(--text-secondary)', lineHeight: '1.8'}}>
                                    <li><strong>Tri-lands:</strong> If your deck has exactly 3 colors, enter tri-lands below. They'll be subtracted from your total land count.</li>
                                    <li><strong>4-5 Color Decks:</strong> This calculator is designed for 1-3 color decks only. Results for 4+ color decks will be inaccurate and are not supported.</li>
                                    <li><strong>Utility Lands:</strong> "Remaining Slots" in results are for Command Tower, utility lands, colorless lands, etc.</li>
                                </ul>
                            </div>
                        </div>
                    )}

                    <div style={{marginBottom: '1.5rem'}}>
                        <label style={{fontWeight: 600, marginBottom: '0.5rem', display: 'block'}}>
                            Total Lands in Your Deck
                        </label>
                        {window.innerWidth <= 768 ? (
                            <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                <button
                                    type="button"
                                    onClick={(e) => {
                                        e.preventDefault();
                                        const currentValue = parseInt(totalLands) || 0;
                                        if (currentValue > 0) {
                                            setTotalLands(currentValue - 1);
                                        }
                                    }}
                                    style={{
                                        width: '36px',
                                        height: '36px',
                                        fontSize: '1.2rem',
                                        padding: 0,
                                        background: 'var(--bg-secondary)',
                                        border: '2px solid var(--border-color)',
                                        borderRadius: '6px',
                                        color: 'var(--text-primary)',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        fontWeight: 'bold'
                                    }}
                                >
                                    ‚àí
                                </button>
                                <input 
                                    type="number"
                                    className="small-input"
                                    value={totalLands}
                                    onChange={(e) => setTotalLands(parseInt(e.target.value) || 38)}
                                    min="0"
                                    max="99"
                                    style={{flex: 1, textAlign: 'center', minWidth: '80px'}}
                                />
                                <button
                                    type="button"
                                    onClick={(e) => {
                                        e.preventDefault();
                                        const currentValue = parseInt(totalLands) || 0;
                                        if (currentValue < 99) {
                                            setTotalLands(currentValue + 1);
                                        }
                                    }}
                                    style={{
                                        width: '36px',
                                        height: '36px',
                                        fontSize: '1.2rem',
                                        padding: 0,
                                        background: 'var(--bg-secondary)',
                                        border: '2px solid var(--border-color)',
                                        borderRadius: '6px',
                                        color: 'var(--text-primary)',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        fontWeight: 'bold'
                                    }}
                                >
                                    +
                                </button>
                            </div>
                        ) : (
                            <input 
                                type="number"
                                className="small-input"
                                value={totalLands}
                                onChange={(e) => setTotalLands(parseInt(e.target.value) || 38)}
                                min="0"
                                max="99"
                                style={{width: '100px'}}
                            />
                        )}
                        <small style={{color: 'var(--text-muted)', marginLeft: window.innerWidth <= 768 ? '0' : '1rem', display: 'block', marginTop: window.innerWidth <= 768 ? '0.3rem' : '0'}}>
                            Recommended: 36-40 lands
                        </small>
                    </div>

                    <div style={{marginBottom: '1.5rem'}}>
                        <label style={{fontWeight: 600, marginBottom: '0.5rem', display: 'block'}}>
                            Tri-Lands
                        </label>
                        {window.innerWidth <= 768 ? (
                            <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                <button
                                    type="button"
                                    onClick={(e) => {
                                        e.preventDefault();
                                        const currentValue = parseInt(triLands) || 0;
                                        if (currentValue > 0) {
                                            setTriLands(currentValue - 1);
                                        }
                                    }}
                                    style={{
                                        width: '36px',
                                        height: '36px',
                                        fontSize: '1.2rem',
                                        padding: 0,
                                        background: 'var(--bg-secondary)',
                                        border: '2px solid var(--border-color)',
                                        borderRadius: '6px',
                                        color: 'var(--text-primary)',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        fontWeight: 'bold'
                                    }}
                                >
                                    ‚àí
                                </button>
                                <input 
                                    type="number"
                                    className="small-input"
                                    value={triLands}
                                    onChange={(e) => setTriLands(parseInt(e.target.value) || 0)}
                                    min="0"
                                    max="20"
                                    style={{flex: 1, textAlign: 'center', minWidth: '80px'}}
                                />
                                <button
                                    type="button"
                                    onClick={(e) => {
                                        e.preventDefault();
                                        const currentValue = parseInt(triLands) || 0;
                                        if (currentValue < 20) {
                                            setTriLands(currentValue + 1);
                                        }
                                    }}
                                    style={{
                                        width: '36px',
                                        height: '36px',
                                        fontSize: '1.2rem',
                                        padding: 0,
                                        background: 'var(--bg-secondary)',
                                        border: '2px solid var(--border-color)',
                                        borderRadius: '6px',
                                        color: 'var(--text-primary)',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        fontWeight: 'bold'
                                    }}
                                >
                                    +
                                </button>
                            </div>
                        ) : (
                            <input 
                                type="number"
                                className="small-input"
                                value={triLands}
                                onChange={(e) => setTriLands(parseInt(e.target.value) || 0)}
                                min="0"
                                max="20"
                                style={{width: '100px'}}
                            />
                        )}
                        <small style={{color: 'var(--text-muted)', marginLeft: window.innerWidth <= 768 ? '0' : '1rem', display: 'block', marginTop: window.innerWidth <= 768 ? '0.3rem' : '0'}}>
                            3+ color lands
                        </small>
                        {(() => {
                            // Calculate deck colors from current pip counts
                            const colors = ['W', 'U', 'B', 'R', 'G'];
                            const activeDeckColors = colors.filter(color => {
                                const pips = pipCounts[color];
                                return (pips.single + pips.double + pips.triple) > 0;
                            });
                            return activeDeckColors.length === 3 && triLands > 0;
                        })() && (
                            <small style={{
                                color: 'var(--accent-bright)',
                                marginLeft: window.innerWidth <= 768 ? '0' : '1rem',
                                display: 'block',
                                marginTop: '0.3rem',
                                fontStyle: 'italic'
                            }}>
                                üí° Auto-calculated: +{triLands} pip{triLands !== 1 ? 's' : ''} to each of your 3 colors
                            </small>
                        )}
                    </div>

                    <div style={{marginBottom: '1.5rem'}}>
                        <label style={{fontWeight: 600, marginBottom: '0.5rem', display: 'block'}}>
                            Colorless & Utility Lands
                        </label>
                        {window.innerWidth <= 768 ? (
                            <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                <button
                                    type="button"
                                    onClick={(e) => {
                                        e.preventDefault();
                                        const currentValue = parseInt(otherLands) || 0;
                                        if (currentValue > 0) {
                                            setOtherLands(currentValue - 1);
                                        }
                                    }}
                                    style={{
                                        width: '36px',
                                        height: '36px',
                                        fontSize: '1.2rem',
                                        padding: 0,
                                        background: 'var(--bg-secondary)',
                                        border: '2px solid var(--border-color)',
                                        borderRadius: '6px',
                                        color: 'var(--text-primary)',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        fontWeight: 'bold'
                                    }}
                                >
                                    ‚àí
                                </button>
                                <input 
                                    type="number"
                                    className="small-input"
                                    value={otherLands}
                                    onChange={(e) => setOtherLands(parseInt(e.target.value) || 0)}
                                    min="0"
                                    max="20"
                                    style={{flex: 1, textAlign: 'center', minWidth: '80px'}}
                                />
                                <button
                                    type="button"
                                    onClick={(e) => {
                                        e.preventDefault();
                                        const currentValue = parseInt(otherLands) || 0;
                                        if (currentValue < 20) {
                                            setOtherLands(currentValue + 1);
                                        }
                                    }}
                                    style={{
                                        width: '36px',
                                        height: '36px',
                                        fontSize: '1.2rem',
                                        padding: 0,
                                        background: 'var(--bg-secondary)',
                                        border: '2px solid var(--border-color)',
                                        borderRadius: '6px',
                                        color: 'var(--text-primary)',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        fontWeight: 'bold'
                                    }}
                                >
                                    +
                                </button>
                            </div>
                        ) : (
                            <input 
                                type="number"
                                className="small-input"
                                value={otherLands}
                                onChange={(e) => setOtherLands(parseInt(e.target.value) || 0)}
                                min="0"
                                max="20"
                                style={{width: '100px'}}
                            />
                        )}
                        <small style={{color: 'var(--text-muted)', marginLeft: window.innerWidth <= 768 ? '0' : '1rem', display: 'block', marginTop: window.innerWidth <= 768 ? '0.3rem' : '0'}}>
                            Colorless, sac lands, etc.
                        </small>
                    </div>

                    {/* STEP 1: Dual Lands */}
                    <div style={{
                        background: 'linear-gradient(135deg, rgba(0, 115, 62, 0.12) 0%, rgba(34, 139, 34, 0.12) 100%)',
                        border: '3px solid rgba(0, 115, 62, 0.4)',
                        borderRadius: '12px',
                        padding: '1rem',
                        marginBottom: '2rem'
                    }}>
                        {/* Clickable Header */}
                        <div 
                            style={{
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center',
                                cursor: 'pointer',
                                marginBottom: showLandsSection ? '1rem' : '0',
                                padding: '0.5rem'
                            }}
                            onClick={() => setShowLandsSection(!showLandsSection)}
                        >
                            <div style={{display: 'flex', alignItems: 'center', gap: '0.8rem'}}>
                                <div style={{
                                    background: 'linear-gradient(135deg, #00733e 0%, #228b22 100%)',
                                    color: 'white',
                                    width: '38px',
                                    height: '38px',
                                    borderRadius: '50%',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    fontWeight: 700,
                                    fontSize: '1.2rem'
                                }}>
                                    2
                                </div>
                                <label style={{fontWeight: 700, fontSize: window.innerWidth <= 768 ? '1.6rem' : '1.3rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)', color: 'var(--text-primary)', margin: 0, cursor: 'pointer'}}>
                                    üèîÔ∏è Count Your DUAL LANDS
                                </label>
                            </div>
                            <div style={{fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)', color: 'var(--text-primary)', fontWeight: 'bold'}}>
                                {showLandsSection ? '‚ñº' : '‚ñ∂'}
                            </div>
                        </div>

                        {/* Collapsible Content */}
                        {showLandsSection && (
                            <>
                        <div style={{
                            background: 'rgba(0, 115, 62, 0.15)',
                            border: '1px solid rgba(0, 115, 62, 0.3)',
                            borderRadius: '12px',
                            padding: '1rem',
                            marginBottom: '1rem',
                            marginLeft: '2.5rem',
                            display: window.innerWidth <= 768 ? 'none' : 'block'
                        }}>
                            <div style={{fontWeight: 600, color: 'var(--text-primary)', marginBottom: '0.5rem'}}>
                                What to count:
                            </div>
                            <div style={{color: 'var(--text-secondary)', fontSize: '0.95rem', lineHeight: '1.6'}}>
                                How many <strong>dual lands</strong> (lands that produce or fetch 2 colors) are you actually running in your deck? This is completely separate from Step 1.
                                <br/><br/>
                                <strong>Include:</strong> Shocklands (Temple Garden), Fetchlands (Flooded Strand), Pain lands (Adarkar Wastes), Check lands, etc.
                                <br/>
                                <strong>Example:</strong> If you have 4 Temple Gardens and 3 Windswept Heaths in your deck, enter 7 for Selesnya below.
                            </div>
                        </div>
                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem', paddingLeft: '2.5rem'}}>
                            {colorPairs.map(({pair, colors, name}) => (
                                <div key={pair}>
                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.3rem'}}>
                                        <div className={`pip-icon pip-${colors[0]}`} style={{width: '16px', height: '16px'}}></div>
                                        <div className={`pip-icon pip-${colors[1]}`} style={{width: '16px', height: '16px'}}></div>
                                        <span style={{fontSize: '0.85rem'}}>{name}</span>
                                    </div>
                                    {/* Mobile: Plus/Minus Buttons */}
                                    {window.innerWidth <= 768 ? (
                                        <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                            <button
                                                type="button"
                                                onClick={(e) => {
                                                    e.preventDefault();
                                                    const currentValue = parseInt(dualLands[pair]) || 0;
                                                    if (currentValue > 0) {
                                                        updateDualLands(pair, (currentValue - 1).toString());
                                                    }
                                                }}
                                                style={{
                                                    width: '36px',
                                                    height: '36px',
                                                    fontSize: '1.2rem',
                                                    padding: 0,
                                                    background: 'var(--bg-secondary)',
                                                    border: '2px solid var(--border-color)',
                                                    borderRadius: '6px',
                                                    color: 'var(--text-primary)',
                                                    cursor: 'pointer',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    fontWeight: 'bold'
                                                }}
                                            >
                                                ‚àí
                                            </button>
                                            <input 
                                                type="number"
                                                className="small-input"
                                                style={{flex: 1, textAlign: 'center', minWidth: '60px'}}
                                                value={dualLands[pair]}
                                                onChange={(e) => updateDualLands(pair, e.target.value)}
                                                min="0"
                                            />
                                            <button
                                                type="button"
                                                onClick={(e) => {
                                                    e.preventDefault();
                                                    const currentValue = parseInt(dualLands[pair]) || 0;
                                                    updateDualLands(pair, (currentValue + 1).toString());
                                                }}
                                                style={{
                                                    width: '36px',
                                                    height: '36px',
                                                    fontSize: '1.2rem',
                                                    padding: 0,
                                                    background: 'var(--bg-secondary)',
                                                    border: '2px solid var(--border-color)',
                                                    borderRadius: '6px',
                                                    color: 'var(--text-primary)',
                                                    cursor: 'pointer',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    fontWeight: 'bold'
                                                }}
                                            >
                                                +
                                            </button>
                                        </div>
                                    ) : (
                                        /* Desktop: Regular Input */
                                        <input 
                                            type="number"
                                            className="small-input"
                                            style={{width: '100%'}}
                                            value={dualLands[pair]}
                                            onChange={(e) => updateDualLands(pair, e.target.value)}
                                            min="0"
                                        />
                                    )}
                                </div>
                            ))}
                        </div>
                            </>
                        )}
                    </div>

                    {/* STEP 2: Count Mana Pips */}
                    <div style={{
                        background: 'linear-gradient(135deg, rgba(66, 135, 245, 0.12) 0%, rgba(136, 106, 234, 0.12) 100%)',
                        border: '3px solid rgba(66, 135, 245, 0.4)',
                        borderRadius: '12px',
                        padding: '1rem',
                        marginBottom: '2rem'
                    }}>
                        {/* Clickable Header */}
                        <div 
                            style={{
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center',
                                cursor: 'pointer',
                                marginBottom: showPipsSection ? '1rem' : '0',
                                padding: '0.5rem'
                            }}
                            onClick={() => setShowPipsSection(!showPipsSection)}
                        >
                            <div style={{display: 'flex', alignItems: 'center', gap: '0.8rem'}}>
                                <div style={{
                                    background: 'linear-gradient(135deg, #4287f5 0%, #886aea 100%)',
                                    color: 'white',
                                    width: '38px',
                                    height: '38px',
                                    borderRadius: '50%',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    fontWeight: 700,
                                    fontSize: '1.2rem'
                                }}>
                                    1
                                </div>
                                <label style={{fontWeight: 700, fontSize: window.innerWidth <= 768 ? '1.6rem' : '1.3rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)', color: 'var(--text-primary)', margin: 0, cursor: 'pointer'}}>
                                    üé¥ Count Mana Pips from Your SPELLS
                                </label>
                            </div>
                            <div style={{fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)', color: 'var(--text-primary)', fontWeight: 'bold'}}>
                                {showPipsSection ? '‚ñº' : '‚ñ∂'}
                            </div>
                        </div>

                        {/* Collapsible Content */}
                        {showPipsSection && (
                            <>
                        <div style={{
                            background: 'rgba(66, 135, 245, 0.15)',
                            border: '1px solid rgba(66, 135, 245, 0.3)',
                            borderRadius: '12px',
                            padding: '1rem',
                            marginBottom: '1rem',
                            marginLeft: '2.5rem',
                            display: window.innerWidth <= 768 ? 'none' : 'block'
                        }}>
                            <div style={{fontWeight: 600, color: 'var(--text-primary)', marginBottom: '0.5rem'}}>
                                What to count:
                            </div>
                            <div style={{color: 'var(--text-secondary)', fontSize: '0.95rem', lineHeight: '1.6'}}>
                                Look at <strong>all the spells in your deck</strong> (creatures, instants, sorceries, enchantments, etc.) and count the colored mana symbols {'{W}'}{'{U}'}{'{B}'}{'{R}'}{'{G}'} in their mana costs.
                                <br/><br/>
                                <strong>Example:</strong> Wrath of God {'{2}{W}{W}'} = 2 White pips (double)<br/>
                                <strong>Example:</strong> Sol Ring {'{1}'} = 0 pips (colorless doesn't count)
                                <br/><br/>
                                <div style={{
                                    background: 'rgba(212, 175, 55, 0.15)',
                                    border: '1px solid rgba(212, 175, 55, 0.3)',
                                    borderRadius: '6px',
                                    padding: '0.8rem',
                                    fontSize: '0.9rem'
                                }}>
                                    <strong style={{color: 'var(--accent-bright)'}}>üß† How it works:</strong> The calculator <strong>weights pips</strong> intelligently. Cards with {'{U}{U}'} (double) count more heavily than cards with {'{1}{U}'} (single) because they're harder to cast. This ensures your mana base can reliably cast your most color-intensive spells!
                                </div>
                            </div>
                        </div>
                        <div className="pip-counter" style={{overflowX: 'auto'}}>
                            {['W', 'U', 'B', 'R', 'G'].map(color => (
                                <div key={color} className="pip-input-group" style={{minWidth: '160px'}}>
                                    <div className="pip-label">
                                        <div className={`pip-icon pip-${color}`}></div>
                                        <span>{color}</span>
                                    </div>
                                    <div style={{marginTop: '0.5rem'}}>
                                        <div style={{flex: '1 1 50px', minWidth: '50px', marginBottom: '0.5rem'}}>
                                            <div style={{fontSize: '0.7rem', marginBottom: '0.3rem'}}>Single</div>
                                            {window.innerWidth <= 768 ? (
                                                <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(pipCounts[color].single) || 0;
                                                            if (currentValue > 0) {
                                                                updatePipCount(color, 'single', (currentValue - 1).toString());
                                                            }
                                                        }}
                                                        style={{
                                                            width: '40px',
                                                            height: '40px',
                                                            fontSize: '1rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '4px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        ‚àí
                                                    </button>
                                                    <input 
                                                        type="number"
                                                        className="small-input"
                                                        style={{flex: 1, padding: '0.5rem', fontSize: '0.95rem', textAlign: 'center', minWidth: '50px', height: '40px'}}
                                                        value={pipCounts[color].single}
                                                        onChange={(e) => updatePipCount(color, 'single', e.target.value)}
                                                        min="0"
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(pipCounts[color].single) || 0;
                                                            updatePipCount(color, 'single', (currentValue + 1).toString());
                                                        }}
                                                        style={{
                                                            width: '40px',
                                                            height: '40px',
                                                            fontSize: '1rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '4px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        +
                                                    </button>
                                                </div>
                                            ) : (
                                                <input 
                                                    type="number"
                                                    className="small-input"
                                                    style={{width: '100%', padding: '0.4rem', fontSize: '0.85rem'}}
                                                    value={pipCounts[color].single}
                                                    onChange={(e) => updatePipCount(color, 'single', e.target.value)}
                                                    min="0"
                                                />
                                            )}
                                        </div>
                                        <div style={{flex: '1 1 50px', minWidth: '50px', marginBottom: '0.5rem'}}>
                                            <div style={{fontSize: '0.7rem', marginBottom: '0.3rem'}}>Double</div>
                                            {window.innerWidth <= 768 ? (
                                                <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(pipCounts[color].double) || 0;
                                                            if (currentValue > 0) {
                                                                updatePipCount(color, 'double', (currentValue - 1).toString());
                                                            }
                                                        }}
                                                        style={{
                                                            width: '40px',
                                                            height: '40px',
                                                            fontSize: '1rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '4px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        ‚àí
                                                    </button>
                                                    <input 
                                                        type="number"
                                                        className="small-input"
                                                        style={{flex: 1, padding: '0.5rem', fontSize: '0.95rem', textAlign: 'center', minWidth: '50px', height: '40px'}}
                                                        value={pipCounts[color].double}
                                                        onChange={(e) => updatePipCount(color, 'double', e.target.value)}
                                                        min="0"
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(pipCounts[color].double) || 0;
                                                            updatePipCount(color, 'double', (currentValue + 1).toString());
                                                        }}
                                                        style={{
                                                            width: '40px',
                                                            height: '40px',
                                                            fontSize: '1rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '4px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        +
                                                    </button>
                                                </div>
                                            ) : (
                                                <input 
                                                    type="number"
                                                    className="small-input"
                                                    style={{width: '100%', padding: '0.4rem', fontSize: '0.85rem'}}
                                                    value={pipCounts[color].double}
                                                    onChange={(e) => updatePipCount(color, 'double', e.target.value)}
                                                    min="0"
                                                />
                                            )}
                                        </div>
                                        <div style={{flex: '1 1 50px', minWidth: '50px', marginBottom: '0.5rem'}}>
                                            <div style={{fontSize: '0.7rem', marginBottom: '0.3rem'}}>Triple+</div>
                                            {window.innerWidth <= 768 ? (
                                                <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(pipCounts[color].triple) || 0;
                                                            if (currentValue > 0) {
                                                                updatePipCount(color, 'triple', (currentValue - 1).toString());
                                                            }
                                                        }}
                                                        style={{
                                                            width: '40px',
                                                            height: '40px',
                                                            fontSize: '1rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '4px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        ‚àí
                                                    </button>
                                                    <input 
                                                        type="number"
                                                        className="small-input"
                                                        style={{flex: 1, padding: '0.5rem', fontSize: '0.95rem', textAlign: 'center', minWidth: '50px', height: '40px'}}
                                                        value={pipCounts[color].triple}
                                                        onChange={(e) => updatePipCount(color, 'triple', e.target.value)}
                                                        min="0"
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(pipCounts[color].triple) || 0;
                                                            updatePipCount(color, 'triple', (currentValue + 1).toString());
                                                        }}
                                                        style={{
                                                            width: '40px',
                                                            height: '40px',
                                                            fontSize: '1rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '4px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        +
                                                    </button>
                                                </div>
                                            ) : (
                                                <input 
                                                    type="number"
                                                    className="small-input"
                                                    style={{width: '100%', padding: '0.4rem', fontSize: '0.85rem'}}
                                                    value={pipCounts[color].triple}
                                                    onChange={(e) => updatePipCount(color, 'triple', e.target.value)}
                                                    min="0"
                                                />
                                            )}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                            </>
                        )}
                    </div>
                    {/* Calculate Button */}
                    <div style={{textAlign: 'center', marginBottom: '1.5rem', marginTop: '2rem'}}>
                        <button 
                            className="btn btn-primary"
                            onClick={calculateManaBase}
                            style={{
                                padding: '1rem 3rem',
                                fontSize: '1.2rem',
                                display: 'inline-flex',
                                alignItems: 'center',
                                gap: '0.8rem'
                            }}
                        >
                            <span style={{fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)'}}>‚öóÔ∏è</span>
                            <span>Calculate My Mana Base</span>
                        </button>
                    </div>

                    {/* Mobile Info Button */}
                    {window.innerWidth <= 768 && (
                        <div style={{marginTop: '1rem', marginBottom: '1rem'}}>
                            <button
                                className="btn btn-secondary"
                                onClick={() => setShowMobileAbout(!showMobileAbout)}
                                style={{width: '100%', display: 'flex', alignItems: 'center', justifyContent: 'space-between'}}
                            >
                                <span>‚ÑπÔ∏è How This Calculator Works</span>
                                <span style={{fontSize: '1.2rem'}}>{showMobileAbout ? '‚ñº' : '‚ñ∂'}</span>
                            </button>
                            
                            {showMobileAbout && (
                                <div style={{
                                    marginTop: '1rem',
                                    padding: '1rem',
                                    background: 'var(--bg-secondary)',
                                    borderRadius: '12px',
                                    border: '1px solid var(--border-color)'
                                }}>
                                    <h4 style={{color: 'var(--gold)', marginBottom: '0.5rem'}}>üìñ How This Calculator Works</h4>
                                    
                                    <div style={{marginBottom: '1rem'}}>
                                        <p style={{marginBottom: '0.5rem', fontSize: '0.85rem', lineHeight: '1.6'}}>
                                            This calculator uses <strong style={{color: 'var(--gold)'}}>pip distribution</strong> to determine your optimal mana base:
                                        </p>
                                    </div>
                                    
                                    <ul style={{paddingLeft: '1.2rem', lineHeight: '1.7', fontSize: '0.85rem', marginBottom: '1rem'}}>
                                        <li><strong>Step 1:</strong> Counts all colored mana symbols (pips) in your deck. {'{W}{W}'} = 2 pips, {'{2}{R}'} = 1 pip.</li>
                                        <li><strong>Step 2:</strong> Calculates the percentage each color represents. (e.g., 20 white pips out of 50 total = 40%)</li>
                                        <li><strong>Step 3:</strong> Distributes your total lands proportionally. (40% of 36 lands = 14-15 white sources needed)</li>
                                        <li><strong>Step 4:</strong> Subtracts dual/tri-lands from basic land requirements. (If you have 4 W/U duals, you need 4 fewer Plains)</li>
                                        <li><strong>Tri-Lands:</strong> In 3-color decks, each tri-land counts as 1 source for all 3 colors automatically!</li>
                                    </ul>
                                    
                                    <div style={{background: 'rgba(212, 175, 55, 0.1)', padding: '0.75rem', borderRadius: '6px', border: '1px solid var(--gold)'}}>
                                        <p style={{margin: 0, fontSize: '0.85rem', lineHeight: '1.5'}}>
                                            <strong style={{color: 'var(--gold)'}}>‚ö†Ô∏è Important:</strong> Designed for 1-3 color decks. Results for 4+ color decks will be inaccurate and are not supported.
                                        </p>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    {showResults && manaCalculation && (
                        <div className="mana-results">
                            <div style={{fontWeight: 600, fontSize: window.innerWidth <= 768 ? '1.6rem' : '1.3rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)', marginBottom: '1rem', color: 'var(--gold)', textAlign: 'center'}}>
                                üìä Your Optimal Mana Base
                            </div>
                            
                            {Object.entries(manaCalculation.recommendations).map(([color, data]) => {
                                if (data.pips === 0) return null;
                                return (
                                    <div key={color} className="result-item">
                                        <div className="result-label">
                                            <div className={`pip-icon pip-${color}`}></div>
                                            <span>{data.name}</span>
                                            <small style={{color: 'var(--text-muted)', marginLeft: '0.5rem'}}>
                                                ({data.pips} pips, {data.percentage}%)
                                            </small>
                                        </div>
                                        <div style={{textAlign: 'right'}}>
                                            <div className="result-value">{data.basicsNeeded}</div>
                                            <small style={{color: 'var(--text-muted)', fontSize: '0.75rem'}}>
                                                basics ({data.fromDuals} from duals)
                                            </small>
                                        </div>
                                    </div>
                                );
                            })}

                            <div style={{marginTop: '1.5rem', padding: '1rem', background: 'var(--bg-tertiary)', borderRadius: '8px'}}>
                                <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                    <span>Total Dual Lands:</span>
                                    <strong>{manaCalculation.totalDuals}</strong>
                                </div>
                                {manaCalculation.triLands > 0 && (
                                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                        <span>Tri-Lands (Triomes):</span>
                                        <strong>{manaCalculation.triLands}</strong>
                                    </div>
                                )}
                                {manaCalculation.otherLands > 0 && (
                                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                        <span>Other Lands (Colorless):</span>
                                        <strong>{manaCalculation.otherLands}</strong>
                                    </div>
                                )}
                                <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                    <span>Total Basics Needed:</span>
                                    <strong>{manaCalculation.totalBasicsNeeded}</strong>
                                </div>
                                {(totalLands - manaCalculation.totalOccupiedSlots - manaCalculation.totalBasicsNeeded) > 0 && (
                                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                        <span>Remaining Slots:</span>
                                        <strong>{totalLands - manaCalculation.totalOccupiedSlots - manaCalculation.totalBasicsNeeded}</strong>
                                        <small style={{color: 'var(--text-muted)', marginLeft: '0.5rem'}}>(for utility lands)</small>
                                    </div>
                                )}
                                <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                    <span>Target Land Count:</span>
                                    <strong>{totalLands}</strong>
                                </div>
                                <div style={{display: 'flex', justifyContent: 'space-between', marginTop: '0.5rem', paddingTop: '0.5rem', borderTop: '1px solid var(--border-color)'}}>
                                    <span>Spells Needed for 100:</span>
                                    <strong style={{color: 'var(--accent-bright)'}}>{100 - totalLands}</strong>
                                </div>
                                {!manaCalculation.isValid && (
                                    <div style={{marginTop: '1rem', padding: '0.8rem', background: 'rgba(211, 32, 42, 0.2)', borderRadius: '6px', color: 'var(--red-mana)'}}>
                                        ‚ö†Ô∏è Warning: You need {manaCalculation.totalBasicsNeeded} basics but only have {manaCalculation.availableForBasics} slots available after all lands!
                                        <div style={{marginTop: '0.8rem', fontSize: '0.9rem', color: 'var(--text-primary)', background: 'rgba(0, 0, 0, 0.3)', padding: '0.8rem', borderRadius: '4px'}}>
                                            <strong>Quick Fixes:</strong>
                                            <div style={{marginTop: '0.5rem', lineHeight: '1.8'}}>
                                                ‚Ä¢ Increase total lands to <strong>{totalLands + (manaCalculation.totalBasicsNeeded - manaCalculation.availableForBasics)}</strong> lands<br/>
                                                ‚Ä¢ Remove <strong>{manaCalculation.totalBasicsNeeded - manaCalculation.availableForBasics}</strong> colorless/utility lands<br/>
                                                ‚Ä¢ Add more dual lands (reduces basics needed)
                                            </div>
                                        </div>
                                    </div>
                                )}
                                {manaCalculation.isValid && (
                                    <div style={{marginTop: '1rem', padding: '0.8rem', background: 'rgba(0, 115, 62, 0.2)', borderRadius: '6px', color: 'var(--green-mana)'}}>
                                        ‚úì Perfect! You have enough land slots for your color requirements.
                                    </div>
                                )}
                            </div>

                            {/* Funny Random Quote */}
                            {randomQuote && (
                                <div style={{
                                    marginTop: '1.5rem',
                                    padding: '1.2rem',
                                    background: 'linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(196, 167, 125, 0.15) 100%)',
                                    border: '2px solid var(--gold)',
                                    borderRadius: '12px',
                                    textAlign: 'center',
                                    fontSize: '1.1rem',
                                    fontStyle: 'italic',
                                    color: 'var(--text-primary)',
                                    fontWeight: 500
                                }}>
                                    "{randomQuote}"
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        // Settings Modal Component
        function SettingsModal({ onClose, user, decks, addToPublicDecks, removeFromPublicDecks, loadPublicDecks }) {
            const [bulkPrivacy, setBulkPrivacy] = useState('public');
            const [updating, setUpdating] = useState(false);

            const userDecks = decks.filter(deck => 
                !deck.isExample && 
                deck.userId === user?.uid
            );

            const publicCount = userDecks.filter(d => d.isPublic).length;
            const privateCount = userDecks.filter(d => !d.isPublic).length;

            const handleBulkUpdate = async () => {
                if (!user) return;
                
                const newPrivacySetting = bulkPrivacy === 'public';
                
          
                if (userDecks.length === 0) {
                    alert("No decks found to update.");
                    return;
                }
                
                if (!window.confirm(`Are you sure you want to make all ${userDecks.length} deck(s) ${bulkPrivacy}?`)) {
                    return;
                }

                setUpdating(true);
                
                try {
                    // Update all user's decks in Firebase
                    const updates = userDecks.map(deck => 
                        db.collection("decks").doc(String(deck.id)).update({ 
                            isPublic: newPrivacySetting,
                            updatedAt: new Date()
                        })
                    );
                    
                    await Promise.all(updates);
                    
                    // Sync with public collection
                    if (newPrivacySetting) {
                        // Add all decks to public collection
                        console.log("Adding", userDecks.length, "decks to public collection...");
                        const publicSyncPromises = userDecks.map(deck => {
                            console.log("Processing deck:", deck.name, "with ID:", deck.id);
                            return addToPublicDecks({
                                ...deck, 
                                isPublic: true,
                                userId: user.uid
                            });
                        });
                        await Promise.all(publicSyncPromises);
                        console.log("‚úÖ All decks added to public collection!");
                    } else {
                        // Remove all decks from public collection
                        console.log("Removing", userDecks.length, "decks from public collection...");
                        const removeSyncPromises = userDecks.map(deck => 
                            removeFromPublicDecks(deck.id)
                        );
                        await Promise.all(removeSyncPromises);
                        console.log("‚úÖ All decks removed from public collection!");
                    }
                    
                    alert(`‚úÖ All ${userDecks.length} deck(s) are now ${bulkPrivacy}!`);
                    
                    // Reload decks from Firebase
                    const snapshot = await db.collection("decks")
                        .where("userId", "==", user.uid)
                        .orderBy("updatedAt", "desc")
                        .get();
                    
                    const updatedDecks = [];
                    snapshot.forEach((doc) => {
                        updatedDecks.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    await loadPublicDecks(); // Reload public decks
                    window.location.reload(); // Refresh to show updated decks
                } catch (error) {
                    console.error("Error updating decks:", error);
                    alert("Error updating decks: " + error.message);
                } finally {
                    setUpdating(false);
                }
            };

            return (
                <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    background: 'rgba(0, 0, 0, 0.8)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 1000
                }}>
                    <div style={{
                        background: 'var(--bg-secondary)',
                        border: '2px solid var(--gold)',
                        borderRadius: '16px',
                        padding: '2rem',
                        maxWidth: '600px',
                        width: '90%',
                        position: 'relative',
                        maxHeight: '90vh',
                        overflow: 'auto'
                    }}>
                        <button 
                            onClick={onClose}
                            style={{
                                position: 'absolute',
                                top: '1rem',
                                right: '1rem',
                                background: 'transparent',
                                border: 'none',
                                color: 'var(--text-muted)',
                                fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)',
                                cursor: 'pointer'
                            }}
                        >
                            √ó
                        </button>

                        <h2 style={{
                            fontFamily: 'Pirata One, cursive',
                            color: 'var(--gold)',
                            marginBottom: '1.5rem',
                            fontSize: '2rem'
                        }}>
                            ‚öôÔ∏è Account Settings
                        </h2>

                        {/* Account Info */}
                        <div style={{
                            background: 'var(--bg-tertiary)',
                            borderRadius: '12px',
                            padding: '1.5rem',
                            marginBottom: '2rem'
                        }}>
                            <h3 style={{
                                color: 'var(--bone)',
                                marginBottom: '1rem',
                                fontSize: '1.2rem',
                                fontFamily: 'MedievalSharp, cursive'
                            }}>
                                Account Info
                            </h3>
                            <div style={{marginBottom: '0.75rem'}}>
                                <span style={{color: 'var(--text-secondary)'}}>Email: </span>
                                <strong style={{color: 'var(--text-primary)'}}>{user?.email}</strong>
                            </div>
                            <div style={{marginBottom: '0.75rem'}}>
                                <span style={{color: 'var(--text-secondary)'}}>Total Decks: </span>
                                <strong style={{color: 'var(--accent-bright)'}}>{userDecks.length}</strong>
                            </div>
                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: '1fr 1fr',
                                gap: '1rem',
                                marginTop: '1rem'
                            }}>
                                <div style={{
                                    background: 'rgba(212, 175, 55, 0.2)',
                                    padding: '1rem',
                                    borderRadius: '12px',
                                    textAlign: 'center'
                                }}>
                                    <div style={{fontSize: '2rem', fontWeight: 700, color: 'var(--gold)'}}>
                                        {publicCount}
                                    </div>
                                    <div style={{fontSize: '0.85rem', color: 'var(--text-secondary)'}}>
                                        üåü Public Decks
                                    </div>
                                </div>
                                <div style={{
                                    background: 'var(--bg-card)',
                                    padding: '1rem',
                                    borderRadius: '12px',
                                    textAlign: 'center'
                                }}>
                                    <div style={{fontSize: '2rem', fontWeight: 700, color: 'var(--text-primary)'}}>
                                        {privateCount}
                                    </div>
                                    <div style={{fontSize: '0.85rem', color: 'var(--text-secondary)'}}>
                                        üîí Private Decks
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Bulk Privacy Settings */}
                        {userDecks.length > 0 && (
                            <div style={{
                                background: 'linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(139, 111, 71, 0.1) 100%)',
                                border: '2px solid var(--gold)',
                                borderRadius: '12px',
                                padding: '1.5rem',
                                marginBottom: '1rem'
                            }}>
                                <h3 style={{
                                    color: 'var(--bone)',
                                    marginBottom: '1rem',
                                    fontSize: '1.2rem',
                                    fontFamily: 'MedievalSharp, cursive'
                                }}>
                                    Deck Privacy Management
                                </h3>
                                <p style={{
                                    color: 'var(--text-secondary)',
                                    marginBottom: '1.5rem',
                                    fontSize: '0.95rem',
                                    lineHeight: '1.6'
                                }}>
                                    Update the privacy setting for all your decks at once. This helps you quickly share your knowledge with the community or keep your strategies private.
                                </p>

                                <div style={{marginBottom: '1.5rem'}}>
                                    <label style={{
                                        display: 'block',
                                        marginBottom: '0.75rem',
                                        color: 'var(--text-secondary)',
                                        fontWeight: 500
                                    }}>
                                        Make all my decks:
                                    </label>
                                    <select 
                                        value={bulkPrivacy}
                                        onChange={(e) => setBulkPrivacy(e.target.value)}
                                        style={{
                                            width: '100%',
                                            padding: '0.75rem',
                                            background: 'var(--bg-tertiary)',
                                            border: '1px solid var(--border-color)',
                                            borderRadius: '12px',
                                            color: 'var(--text-primary)',
                                            fontSize: '1rem',
                                            cursor: 'pointer'
                                        }}
                                    >
                                        <option value="public">üåü Public (Share with community)</option>
                                        <option value="private">üîí Private (Keep to myself)</option>
                                    </select>
                                </div>

                                <button
                                    onClick={handleBulkUpdate}
                                    disabled={updating}
                                    className="btn btn-primary"
                                    style={{
                                        width: '100%',
                                        padding: '0.75rem',
                                        fontSize: '1rem',
                                        opacity: updating ? 0.6 : 1,
                                        cursor: updating ? 'not-allowed' : 'pointer'
                                    }}
                                >
                                    {updating ? 'Updating...' : `Update All ${userDecks.length} Deck(s)`}
                                </button>

                                <p style={{
                                    marginTop: '1rem',
                                    fontSize: '0.85rem',
                                    color: 'var(--text-muted)',
                                    textAlign: 'center',
                                    fontStyle: 'italic'
                                }}>
                                    üí° You can still change individual deck privacy when editing them
                                </p>
                            </div>
                        )}

                        {userDecks.length === 0 && (
                            <div style={{
                                textAlign: 'center',
                                padding: '2rem',
                                color: 'var(--text-muted)'
                            }}>
                                <p>You haven't created any decks yet!</p>
                                <p style={{marginTop: '0.5rem', fontSize: '0.9rem'}}>
                                    Create your first deck to manage privacy settings.
                                </p>
                            </div>
                        )}

                        {/* Bug Report Button */}
                        <div style={{
                            background: 'var(--bg-tertiary)',
                            borderRadius: '12px',
                            padding: '1.5rem',
                            marginTop: '2rem',
                            textAlign: 'center'
                        }}>
                            <h3 style={{
                                color: 'var(--bone)',
                                marginBottom: '1rem',
                                fontSize: '1.2rem',
                                fontFamily: 'MedievalSharp, cursive'
                            }}>
                                Help & Feedback
                            </h3>
                            <p style={{
                                color: 'var(--text-secondary)',
                                marginBottom: '1rem',
                                fontSize: '0.9rem'
                            }}>
                                Found a bug or have a suggestion? Let us know!
                            </p>
                            <button
                                onClick={() => {
                                    onClose();
                                    setTimeout(() => setShowBugReportModal(true), 100);
                                }}
                                className="btn btn-secondary"
                                style={{
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '0.5rem',
                                    margin: '0 auto'
                                }}
                            >
                                <span>üêõ</span>
                                <span>Report a Bug</span>
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

            // Authentication Modal Component
    function AuthModal({ onClose, onSignUp, onLogin }) {
        const [isSignUp, setIsSignUp] = useState(true);
        const [email, setEmail] = useState('');
        const [password, setPassword] = useState('');
        const [isForgotPassword, setIsForgotPassword] = useState(false);
        const [resetEmailSent, setResetEmailSent] = useState(false);

        const handleSubmit = (e) => {
            e.preventDefault();
            if (isSignUp) {
                onSignUp(email, password);
            } else {
                onLogin(email, password);
            }
        };

        const handlePasswordReset = (e) => {
            e.preventDefault();
            if (!email) {
                alert('Please enter your email address');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Please enter a valid email address');
                return;
            }

            auth.sendPasswordResetEmail(email)
                .then(() => {
                    setResetEmailSent(true);
                })
                .catch((error) => {
                    if (error.code === 'auth/user-not-found') {
                        alert('No account found with this email address');
                    } else {
                        alert('Error: ' + error.message);
                    }
                });
        };

        return (
            <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                background: 'rgba(0, 0, 0, 0.8)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                zIndex: 1000
            }}>
                <div style={{
                    background: 'var(--bg-secondary)',
                    border: '2px solid var(--gold)',
                    borderRadius: '16px',
                    padding: '2rem',
                    maxWidth: '450px',
                    width: '90%',
                    position: 'relative'
                }}>
                    <button 
                        onClick={onClose}
                        style={{
                            position: 'absolute',
                            top: '1rem',
                            right: '1rem',
                            background: 'transparent',
                            border: 'none',
                            color: 'var(--text-muted)',
                            fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)',
                            cursor: 'pointer'
                        }}
                    >
                        √ó
                    </button>

                    <h2 style={{
                        fontFamily: 'Pirata One, cursive',
                        color: 'var(--gold)',
                        marginBottom: '1.5rem',
                        textAlign: 'center'
                    }}>
                        {isForgotPassword ? 'Reset Password' : (isSignUp ? 'Create Account' : 'Login')}
                    </h2>

                    {!isForgotPassword && (
                        <div style={{
                            display: 'flex',
                            gap: '1rem',
                            marginBottom: '1.5rem',
                            borderBottom: '1px solid var(--border-color)'
                        }}>
                            <button
                                onClick={() => setIsSignUp(true)}
                                style={{
                                    flex: 1,
                                    background: 'transparent',
                                    border: 'none',
                                    color: isSignUp ? 'var(--gold)' : 'var(--text-muted)',
                                    padding: '0.75rem',
                                    cursor: 'pointer',
                                    borderBottom: isSignUp ? '2px solid var(--gold)' : 'none',
                                    fontWeight: isSignUp ? 600 : 400
                                }}
                            >
                                Sign Up
                            </button>
                            <button
                                onClick={() => setIsSignUp(false)}
                                style={{
                                    flex: 1,
                                    background: 'transparent',
                                    border: 'none',
                                    color: !isSignUp ? 'var(--gold)' : 'var(--text-muted)',
                                    padding: '0.75rem',
                                    cursor: 'pointer',
                                    borderBottom: !isSignUp ? '2px solid var(--gold)' : 'none',
                                    fontWeight: !isSignUp ? 600 : 400
                                }}
                            >
                                Login
                            </button>
                        </div>
                    )}

                    {isForgotPassword ? (
                        // Password Reset Form
                        resetEmailSent ? (
                            <div style={{
                                textAlign: 'center',
                                padding: '2rem 1rem'
                            }}>
                                <div style={{
                                    fontSize: '3rem',
                                    marginBottom: '1rem'
                                }}>‚úâÔ∏è</div>
                                <h3 style={{
                                    color: 'var(--gold)',
                                    marginBottom: '1rem',
                                    fontSize: '1.2rem'
                                }}>Check Your Email</h3>
                                <p style={{
                                    color: 'var(--text-secondary)',
                                    marginBottom: '1.5rem',
                                    lineHeight: '1.6'
                                }}>
                                    We've sent a password reset link to:<br/>
                                    <strong style={{color: 'var(--gold)'}}>{email}</strong>
                                </p>
                                <p style={{
                                    color: 'var(--text-muted)',
                                    fontSize: '0.85rem',
                                    marginBottom: '1rem',
                                    lineHeight: '1.5'
                                }}>
                                    Click the link in the email to reset your password. The link will expire in 1 hour.
                                </p>
                                <p style={{
                                    color: 'var(--accent-bright)',
                                    fontSize: '0.85rem',
                                    marginBottom: '1.5rem',
                                    lineHeight: '1.5',
                                    fontStyle: 'italic'
                                }}>
                                    üì¨ Don't see the email? Check your spam/junk folder!
                                </p>
                                <button
                                    onClick={() => {
                                        setIsForgotPassword(false);
                                        setResetEmailSent(false);
                                        setEmail('');
                                    }}
                                    className="btn btn-primary"
                                    style={{
                                        width: '100%',
                                        padding: '0.75rem',
                                        fontSize: '1rem',
                                        fontWeight: 600
                                    }}
                                >
                                    Back to Login
                                </button>
                            </div>
                        ) : (
                            <form onSubmit={handlePasswordReset}>
                                <p style={{
                                    color: 'var(--text-secondary)',
                                    marginBottom: '1.5rem',
                                    fontSize: '0.9rem',
                                    lineHeight: '1.5'
                                }}>
                                    Enter your email address and we'll send you a link to reset your password.
                                </p>
                                <div style={{marginBottom: '1.5rem'}}>
                                    <label style={{
                                        display: 'block',
                                        marginBottom: '0.5rem',
                                        color: 'var(--text-secondary)'
                                    }}>
                                        Email Address
                                    </label>
                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        required
                                        style={{
                                            width: '100%',
                                            padding: '0.75rem',
                                            background: 'var(--bg-tertiary)',
                                            border: '1px solid var(--border-color)',
                                            borderRadius: '12px',
                                            color: 'var(--text-primary)',
                                            fontSize: '1rem'
                                        }}
                                        placeholder="your@email.com"
                                    />
                                </div>

                                <button
                                    type="submit"
                                    className="btn btn-primary"
                                    style={{
                                        width: '100%',
                                        padding: '0.75rem',
                                        fontSize: '1rem',
                                        fontWeight: 600,
                                        marginBottom: '1rem'
                                    }}
                                >
                                    Send Reset Link
                                </button>

                                <button
                                    type="button"
                                    onClick={() => {
                                        setIsForgotPassword(false);
                                        setEmail('');
                                    }}
                                    style={{
                                        width: '100%',
                                        padding: '0.75rem',
                                        background: 'transparent',
                                        border: '1px solid var(--border-color)',
                                        borderRadius: '12px',
                                        color: 'var(--text-secondary)',
                                        cursor: 'pointer',
                                        fontSize: '1rem'
                                    }}
                                >
                                    Back to Login
                                </button>
                            </form>
                        )
                    ) : (
                        // Normal Login/Signup Form
                        <form onSubmit={handleSubmit}>
                            <div style={{marginBottom: '1rem'}}>
                                <label style={{
                                    display: 'block',
                                    marginBottom: '0.5rem',
                                    color: 'var(--text-secondary)'
                                }}>
                                    Username or Email
                                </label>
                                <input
                                    type={isSignUp ? "text" : "text"}
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                    style={{
                                        width: '100%',
                                        padding: '0.75rem',
                                        background: 'var(--bg-tertiary)',
                                        border: '1px solid var(--border-color)',
                                        borderRadius: '12px',
                                        color: 'var(--text-primary)',
                                        fontSize: '1rem'
                                    }}
                                    placeholder={isSignUp ? "username or email@example.com" : "username or email@example.com"}
                                />
                                {isSignUp && (
                                    <div style={{
                                        fontSize: '0.75rem',
                                        color: 'var(--text-muted)',
                                        marginTop: '0.5rem',
                                        fontStyle: 'italic',
                                        lineHeight: '1.4'
                                    }}>
                                        üí° Tip: Using an email allows you to reset your password if you get locked out of your account.
                                    </div>
                                )}
                            </div>

                            <div style={{marginBottom: '1.5rem'}}>
                                <label style={{
                                    display: 'block',
                                    marginBottom: '0.5rem',
                                    color: 'var(--text-secondary)'
                                }}>
                                    Password
                                </label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                    minLength={6}
                                    style={{
                                        width: '100%',
                                        padding: '0.75rem',
                                        background: 'var(--bg-tertiary)',
                                        border: '1px solid var(--border-color)',
                                        borderRadius: '12px',
                                        color: 'var(--text-primary)',
                                        fontSize: '1rem'
                                    }}
                                    placeholder="At least 6 characters"
                                />
                                {!isSignUp && (
                                    <div style={{
                                        marginTop: '0.5rem',
                                        textAlign: 'right'
                                    }}>
                                        <button
                                            type="button"
                                            onClick={() => setIsForgotPassword(true)}
                                            style={{
                                                background: 'transparent',
                                                border: 'none',
                                                color: 'var(--gold)',
                                                fontSize: '0.8rem',
                                                cursor: 'pointer',
                                                textDecoration: 'underline',
                                                padding: '0.25rem'
                                            }}
                                        >
                                            Forgot Password?
                                        </button>
                                    </div>
                                )}
                            </div>

                            <button
                                type="submit"
                                className="btn btn-primary"
                                style={{
                                    width: '100%',
                                    padding: '0.75rem',
                                    fontSize: '1rem',
                                    fontWeight: 600
                                }}
                            >
                                {isSignUp ? 'Create Account' : 'Login'}
                            </button>
                        </form>
                    )}

                    {!isForgotPassword && (
                        <p style={{
                            marginTop: '1rem',
                            textAlign: 'center',
                            color: 'var(--text-muted)',
                            fontSize: '0.85rem'
                        }}>
                            {isSignUp 
                                ? 'Already have an account? Switch to Login above.'
                                : "Don't have an account? Switch to Sign Up above."}
                        </p>
                    )}
                </div>
            </div>
        );
    }

    // ‚Üë AUTHMODAL COMPONENT ENDS HERE ‚Üë

    // Bug Report Modal Component
    function BugReportModal({ onClose, onSubmit }) {
        const [description, setDescription] = useState('');
        const [email, setEmail] = useState('');
        const [submitting, setSubmitting] = useState(false);

        const handleSubmit = async (e) => {
            e.preventDefault();
            
            if (description.trim().length < 10) {
                alert('‚ùå Please provide a detailed description (at least 10 characters).');
                return;
            }

            setSubmitting(true);
            const success = await onSubmit(description, email);
            setSubmitting(false);

            if (success) {
                alert('‚úÖ Thank you! Your bug report has been submitted.\n\nWe\'ll look into it as soon as possible!');
                onClose();
            }
        };

        return (
            <div style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                background: 'rgba(0, 0, 0, 0.85)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                zIndex: 1001,
                padding: '1rem'
            }}>
                <div style={{
                    background: 'var(--bg-secondary)',
                    border: '2px solid var(--gold)',
                    borderRadius: '16px',
                    padding: '2rem',
                    maxWidth: '500px',
                    width: '100%',
                    position: 'relative'
                }}>
                    <button 
                        onClick={onClose}
                        style={{
                            position: 'absolute',
                            top: '1rem',
                            right: '1rem',
                            background: 'transparent',
                            border: 'none',
                            color: 'var(--text-muted)',
                            fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)',
                            cursor: 'pointer'
                        }}
                    >
                        √ó
                    </button>

                    <h2 style={{
                        fontFamily: 'Pirata One, cursive',
                        color: 'var(--gold)',
                        marginBottom: '0.5rem',
                        fontSize: '2rem',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '0.5rem'
                    }}>
                        <span>üêõ</span>
                        <span>Report a Bug</span>
                    </h2>

                    <p style={{
                        color: 'var(--text-secondary)',
                        marginBottom: '1.5rem',
                        fontSize: '0.9rem',
                        lineHeight: '1.5'
                    }}>
                        Found something wrong? Help us improve by reporting bugs or suggesting features!
                    </p>

                    <form onSubmit={handleSubmit}>
                        <div style={{marginBottom: '1.5rem'}}>
                            <label style={{
                                display: 'block',
                                marginBottom: '0.5rem',
                                color: 'var(--text-secondary)',
                                fontWeight: 600
                            }}>
                                Description *
                            </label>
                            <textarea
                                value={description}
                                onChange={(e) => setDescription(e.target.value)}
                                required
                                rows={5}
                                placeholder="Describe the bug or your suggestion in detail..."
                                style={{
                                    width: '100%',
                                    padding: '0.75rem',
                                    background: 'var(--bg-tertiary)',
                                    border: '1px solid var(--border-color)',
                                    borderRadius: '12px',
                                    color: 'var(--text-primary)',
                                    fontSize: '1rem',
                                    fontFamily: 'Cinzel, serif',
                                    resize: 'vertical'
                                }}
                            />
                        </div>

                        <div style={{marginBottom: '1.5rem'}}>
                            <label style={{
                                display: 'block',
                                marginBottom: '0.5rem',
                                color: 'var(--text-secondary)',
                                fontWeight: 600
                            }}>
                                Email (optional)
                            </label>
                            <input
                                type="email"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                placeholder="your@email.com (optional for follow-up)"
                                style={{
                                    width: '100%',
                                    padding: '0.75rem',
                                    background: 'var(--bg-tertiary)',
                                    border: '1px solid var(--border-color)',
                                    borderRadius: '12px',
                                    color: 'var(--text-primary)',
                                    fontSize: '1rem'
                                }}
                            />
                        </div>

                        <button
                            type="submit"
                            disabled={submitting}
                            className="btn btn-primary"
                            style={{
                                width: '100%',
                                padding: '0.75rem',
                                fontSize: '1rem',
                                fontWeight: 600,
                                opacity: submitting ? 0.6 : 1,
                                cursor: submitting ? 'not-allowed' : 'pointer'
                            }}
                        >
                            {submitting ? 'Submitting...' : 'Submit Report'}
                        </button>

                        <p style={{
                            marginTop: '1rem',
                            fontSize: '0.75rem',
                            color: 'var(--text-muted)',
                            textAlign: 'center',
                            lineHeight: '1.4'
                        }}>
                            üìß All reports are reviewed. Thank you for helping us improve!
                        </p>
                    </form>
                </div>
            </div>
        );
    }

    // CardAutocomplete Component - Scryfall card name suggestions
    function CardAutocomplete({ value, onChange, placeholder, onSelect }) {
        const [suggestions, setSuggestions] = useState([]);
        const [showSuggestions, setShowSuggestions] = useState(false);
        const [loading, setLoading] = useState(false);
        
        useEffect(() => {
            const fetchSuggestions = async () => {
                if (value.length < 2) {
                    setSuggestions([]);
                    return;
                }
                
                setLoading(true);
                try {
                    const response = await fetch(`https://api.scryfall.com/cards/autocomplete?q=${encodeURIComponent(value)}`);
                    const data = await response.json();
                    setSuggestions(data.data || []);
                } catch (error) {
                    console.error('Error fetching suggestions:', error);
                    setSuggestions([]);
                }
                setLoading(false);
            };
            
            const timeoutId = setTimeout(fetchSuggestions, 300);
            return () => clearTimeout(timeoutId);
        }, [value]);
        
        return (
            <div style={{position: 'relative', width: '100%'}}>
                <input 
                    type="text"
                    className="form-input"
                    placeholder={placeholder}
                    value={value}
                    onChange={(e) => onChange(e.target.value)}
                    onFocus={() => setShowSuggestions(true)}
                    onBlur={() => setTimeout(() => setShowSuggestions(false), 200)}
                    style={{width: '100%'}}
                />
                {showSuggestions && suggestions.length > 0 && (
                    <div style={{
                        position: 'absolute',
                        top: '100%',
                        left: 0,
                        right: 0,
                        background: 'var(--bg-secondary)',
                        border: '2px solid var(--border-color)',
                        borderRadius: '12px',
                        marginTop: '0.5rem',
                        maxHeight: '300px',
                        overflowY: 'auto',
                        zIndex: 1000,
                        boxShadow: '0 4px 12px rgba(0,0,0,0.5)'
                    }}>
                        {suggestions.map((cardName, index) => (
                            <div
                                key={index}
                                onClick={() => {
                                    onChange(cardName);
                                    setShowSuggestions(false);
                                    if (onSelect) onSelect(cardName);
                                }}
                                style={{
                                    padding: '0.75rem 1rem',
                                    cursor: 'pointer',
                                    borderBottom: index < suggestions.length - 1 ? '1px solid var(--border-color)' : 'none',
                                    transition: 'background 0.2s',
                                    fontSize: '1rem',
                                    fontWeight: 600,
                                    color: 'var(--text-primary)'
                                }}
                                onMouseEnter={(e) => e.target.style.background = 'var(--bg-tertiary)'}
                                onMouseLeave={(e) => e.target.style.background = 'transparent'}
                            >
                                {cardName}
                            </div>
                        ))}
                    </div>
                )}
                {loading && (
                    <div style={{
                        position: 'absolute',
                        right: '1rem',
                        top: '50%',
                        transform: 'translateY(-50%)',
                        color: 'var(--text-muted)',
                        fontSize: '0.9rem'
                    }}>
                        ‚ü≥
                    </div>
                )}
            </div>
        );
    }

        function CreateDeckModal({ onClose, onSave, initialData = null, user = null, setShowAuthModal = null }) {
            
            const [deckData, setDeckData] = useState({
                name: '',
                commander: '',
                secondCommander: '',
                hasSecondCommander: false,
                colors: [],
                categories: {},
                isPublic: true
            });
            const [commanderCard, setCommanderCard] = useState(null);
            const [secondCommanderCard, setSecondCommanderCard] = useState(null);
            const [loadingCommander, setLoadingCommander] = useState(false);
            const [loadingSecondCommander, setLoadingSecondCommander] = useState(false);
            const [notableCards, setNotableCards] = useState([]);
            const [cardInput, setCardInput] = useState('');
            const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);
            
            // Mana calculator state
            const [pipCounts, setPipCounts] = useState({
                W: { single: 0, double: 0, triple: 0 },
                U: { single: 0, double: 0, triple: 0 },
                B: { single: 0, double: 0, triple: 0 },
                R: { single: 0, double: 0, triple: 0 },
                G: { single: 0, double: 0, triple: 0 }
            });
            const [dualLands, setDualLands] = useState({
                WU: 0, WB: 0, WR: 0, WG: 0,
                UB: 0, UR: 0, UG: 0,
                BR: 0, BG: 0,
                RG: 0
            });
            const [totalLands, setTotalLands] = useState(38);
            const [triLands, setTriLands] = useState(0);
            const [otherLands, setOtherLands] = useState(0);
            const [showResults, setShowResults] = useState(false);
            const [manaCalculation, setManaCalculation] = useState(null);
            const [randomQuote, setRandomQuote] = useState('');
            
            // Sideboard state
            const [sideboardOpen, setSideboardOpen] = useState(false);
            const [sideboardCategories, setSideboardCategories] = useState({});
            const [sideboardQuickInputs, setSideboardQuickInputs] = useState({});
            
            // Mana calculator collapse state
            const [manaCalcOpen, setManaCalcOpen] = useState(false);
            
            // Update deck data when initialData changes (for "Build Similar Deck")
            useEffect(() => {
                if (initialData) {
                    // Build quick totals from the deck's top-level counts
                    const quickCategories = {};
                    if (initialData.creatures > 0) quickCategories['creatures-quick'] = initialData.creatures;
                    if (initialData.noncreature > 0) quickCategories['noncreature-quick'] = initialData.noncreature;
                    if (initialData.lands > 0) quickCategories['lands-quick'] = initialData.lands;
                    
                    setDeckData({
                        name: '',  // Blank name so user can enter their own
                        commander: initialData.commander || '',
                        colors: initialData.colors || [],
                        categories: quickCategories,
                        isPublic: true
                    });
                }
            }, [initialData]);
            
            // Category section collapse states
            const [categoryOpen, setCategoryOpen] = useState({
                creatures: true,
                noncreature: false,
                lands: false
            });
            const [statsExpanded, setStatsExpanded] = useState(true);

            useEffect(() => {
                const initialCategories = {};
                const initialSideboard = {};
                Object.values(DECK_CATEGORIES).forEach(majorGroup => {
                    majorGroup.categories.forEach(cat => {
                        cat.subcategories.forEach(sub => {
                            initialCategories[sub.id] = sub.defaultValue;
                            initialSideboard[sub.id] = 0; // Sideboard starts at 0
                        });
                    });
                });
                
                // Only set defaults if NOT copying a deck (no initialData)
                if (!initialData) {
                    setDeckData(prev => ({ ...prev, categories: initialCategories }));
                    setSideboardCategories(initialSideboard);
                }
            }, [initialData]);

            // Fetch commander card when name changes
            useEffect(() => {
                const fetchCommander = async () => {
                    if (deckData.commander.length > 3) {
                        setLoadingCommander(true);
                        const card = await fetchCardFromScryfall(deckData.commander);
                        setCommanderCard(card);
                        setLoadingCommander(false);
                    }
                };
                const timeoutId = setTimeout(fetchCommander, 500);
                return () => clearTimeout(timeoutId);
            }, [deckData.commander]);

            // Sideboard functions
            const updateSideboardCategory = (categoryId, value) => {
                setSideboardCategories(prev => ({
                    ...prev,
                    [categoryId]: parseInt(value) || 0
                }));
            };


            // Calculate totals
            const totals = useMemo(() => {
                const getCategoryKeys = (majorGroupId) => {
                    const keys = [];
                    DECK_CATEGORIES[majorGroupId].categories.forEach(cat => {
                        cat.subcategories.forEach(sub => keys.push(sub.id));
                    });
                    return keys;
                };

                // Get quick totals for major categories
                const landsQuick = deckData.categories['lands-quick'] || 0;
                const creaturesQuick = deckData.categories['creatures-quick'] || 0;
                const noncreatureQuick = deckData.categories['noncreature-quick'] || 0;

                // Get category group quick totals
                const getCategoryGroupQuick = (majorGroupId) => {
                    let total = 0;
                    DECK_CATEGORIES[majorGroupId].categories.forEach(cat => {
                        total += deckData.categories[`${cat.id}-quick`] || 0;
                    });
                    return total;
                };

                // Get detailed totals from subcategories
                const landsDetailed = getCategoryKeys('lands')
                    .reduce((sum, key) => sum + (deckData.categories[key] || 0), 0);
                const creaturesDetailed = getCategoryKeys('creatures')
                    .reduce((sum, key) => sum + (deckData.categories[key] || 0), 0);
                const noncreatureDetailed = getCategoryKeys('noncreature')
                    .reduce((sum, key) => sum + (deckData.categories[key] || 0), 0);

                // Add category group quick totals
                const landsGroupQuick = getCategoryGroupQuick('lands');
                const creaturesGroupQuick = getCategoryGroupQuick('creatures');
                const noncreatureGroupQuick = getCategoryGroupQuick('noncreature');

                // Total = quick major + quick groups + detailed
                const lands = landsQuick + landsGroupQuick + landsDetailed;
                const creatures = creaturesQuick + creaturesGroupQuick + creaturesDetailed;
                const noncreature = noncreatureQuick + noncreatureGroupQuick + noncreatureDetailed;
                
                const nonLandCards = creatures + noncreature;
                
                // Add commander count (1 or 2)
                const commanderCount = deckData.commander ? (deckData.hasSecondCommander && deckData.secondCommander ? 2 : 1) : 0;
                const total = lands + nonLandCards + commanderCount;

                return { lands, creatures, noncreature, nonLandCards, total, commanderCount };
            }, [deckData.categories, deckData.commander, deckData.hasSecondCommander, deckData.secondCommander]);

            // Sideboard totals calculation
            const sideboardTotals = useMemo(() => {
                const getCategoryKeys = (majorGroupId) => {
                    const keys = [];
                    DECK_CATEGORIES[majorGroupId].categories.forEach(cat => {
                        cat.subcategories.forEach(sub => keys.push(sub.id));
                    });
                    return keys;
                };

                // Calculate detailed totals from sideboard subcategories
                const lands = getCategoryKeys('lands')
                    .reduce((sum, key) => sum + (sideboardCategories[key] || 0), 0);
                const creatures = getCategoryKeys('creatures')
                    .reduce((sum, key) => sum + (sideboardCategories[key] || 0), 0);
                const noncreature = getCategoryKeys('noncreature')
                    .reduce((sum, key) => sum + (sideboardCategories[key] || 0), 0);
                
                const total = lands + creatures + noncreature;

                return { lands, creatures, noncreature, total };
            }, [sideboardCategories]);

            // Mana base calculator
            const calculateManaBase = () => {
                const colors = ['W', 'U', 'B', 'R', 'G'];
                const colorNames = {W: 'White', U: 'Blue', B: 'Black', R: 'Red', G: 'Green'};
                
                // Calculate total pips
                const totalPips = {};
                let grandTotal = 0;
                
                colors.forEach(color => {
                    const pips = pipCounts[color];
                    const total = pips.single + (pips.double * 2) + (pips.triple * 3);
                    totalPips[color] = total;
                    grandTotal += total;
                });

                if (grandTotal === 0) {
                    alert('Please enter at least one mana pip to calculate your mana base.');
                    return;
                }

                // Calculate percentages and recommended sources
                const recommendations = {};
                const totalDualLands = Object.values(dualLands).reduce((a, b) => a + b, 0);
                const totalMultiLands = totalDualLands + triLands;
                const totalOccupiedSlots = totalMultiLands + otherLands;
                const availableForBasics = totalLands - totalOccupiedSlots;

                colors.forEach(color => {
                    const percentage = (totalPips[color] / grandTotal) * 100;
                    const rawSources = (totalPips[color] / grandTotal) * totalLands;
                    
                    // Count dual lands that produce this color
                    let dualContribution = 0;
                    Object.entries(dualLands).forEach(([pair, count]) => {
                        if (pair.includes(color)) {
                            dualContribution += count;
                        }
                    });

                    const neededBasics = Math.max(0, Math.round(rawSources - dualContribution));
                    
                    recommendations[color] = {
                        pips: totalPips[color],
                        percentage: percentage.toFixed(1),
                        totalSources: Math.round(rawSources),
                        fromDuals: dualContribution,
                        basicsNeeded: neededBasics,
                        name: colorNames[color]
                    };
                });

                const totalBasicsNeeded = Object.values(recommendations)
                    .reduce((sum, rec) => sum + rec.basicsNeeded, 0);

                const result = {
                    recommendations,
                    totalPips: grandTotal,
                    totalDuals: totalDualLands,
                    triLands: triLands,
                    otherLands: otherLands,
                    totalMultiLands: totalMultiLands,
                    totalOccupiedSlots: totalOccupiedSlots,
                    totalBasicsNeeded,
                    availableForBasics,
                    isValid: totalBasicsNeeded <= availableForBasics
                };

                // Pick a random funny quote
                const randomIndex = Math.floor(Math.random() * FUNNY_MANA_QUOTES.length);
                setRandomQuote(FUNNY_MANA_QUOTES[randomIndex]);

                setManaCalculation(result);
                setShowResults(true);
            };

            const updatePipCount = (color, type, value) => {
                setPipCounts(prev => ({
                    ...prev,
                    [color]: {
                        ...prev[color],
                        [type]: parseInt(value) || 0
                    }
                }));
            };

            const updateDualLands = (pair, value) => {
                setDualLands(prev => ({
                    ...prev,
                    [pair]: parseInt(value) || 0
                }));
            };

            const addNotableCard = async (cardName) => {
                const nameToAdd = cardName || cardInput.trim();
                if (!nameToAdd) return;
                const cardData = await fetchCardFromScryfall(nameToAdd);
                if (cardData) {
                    setNotableCards([...notableCards, {
                        name: cardData.name,
                        imageUrl: cardData.image_uris?.normal || cardData.image_uris?.large,
                        typeLine: cardData.type_line
                    }]);
                    setCardInput('');
                }
            };

            const toggleColor = (color) => {
                setDeckData(prev => ({
                    ...prev,
                    colors: prev.colors.includes(color) 
                        ? prev.colors.filter(c => c !== color)
                        : [...prev.colors, color]
                }));
            };

            const colorPairs = [
                {pair: 'WU', colors: ['W', 'U'], name: 'Azorius'},
                {pair: 'WB', colors: ['W', 'B'], name: 'Orzhov'},
                {pair: 'WR', colors: ['W', 'R'], name: 'Boros'},
                {pair: 'WG', colors: ['W', 'G'], name: 'Selesnya'},
                {pair: 'UB', colors: ['U', 'B'], name: 'Dimir'},
                {pair: 'UR', colors: ['U', 'R'], name: 'Izzet'},
                {pair: 'UG', colors: ['U', 'G'], name: 'Simic'},
                {pair: 'BR', colors: ['B', 'R'], name: 'Rakdos'},
                {pair: 'BG', colors: ['B', 'G'], name: 'Golgari'},
                {pair: 'RG', colors: ['R', 'G'], name: 'Gruul'}
            ];

            // Check if user has unsaved changes
            useEffect(() => {
                if (deckData.name || deckData.commander || deckData.colors.length > 0 || Object.keys(deckData.categories).length > 0) {
                    setHasUnsavedChanges(true);
                }
            }, [deckData]);

            // Handle close with unsaved changes warning
            const handleClose = () => {
                if (hasUnsavedChanges) {
                    if (!user) {
                        // Not logged in - offer to login/create account
                        const wantsToSave = window.confirm('Your deck might be lost! Would you like to login or create an account to save it?');
                        if (wantsToSave && setShowAuthModal) {
                            setShowAuthModal(true);
                            // Don't close the modal so they can save after logging in
                        } else {
                            onClose();
                        }
                    } else {
                        // Logged in - just confirm
                        if (window.confirm('Your deck might be lost! Are you sure you want to leave without saving?')) {
                            onClose();
                        }
                    }
                } else {
                    onClose();
                }
            };

            return (
                <div className="modal-overlay" >
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <h2 className="modal-title">Create New Deck</h2>
                            <button className="close-btn" onClick={handleClose}>√ó</button>
                        </div>

                        <div className="modal-content-wrapper">
                            <div className="modal-body">
                                {/* Privacy Toggle Section */}
                                <div style={{
                                    background: 'linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(139, 111, 71, 0.1) 100%)',
                                    border: '2px solid var(--gold)',
                                    borderRadius: '12px',
                                    padding: '1.25rem',
                                    marginBottom: '1.5rem'
                                }}>
                                    <div style={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'space-between',
                                        marginBottom: '0.75rem'
                                    }}>
                                        <div style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.5rem',
                                            fontWeight: 600,
                                            color: 'var(--gold)',
                                            fontSize: '1.15rem'
                                        }}>
                                            <span>üåü</span>
                                            <span>Help others brew epic decks - share yours!</span>
                                        </div>
                                        <label style={{
                                            position: 'relative',
                                            display: 'inline-block',
                                            width: '60px',
                                            height: '34px',
                                            cursor: 'pointer'
                                        }}>
                                            <input
                                                type="checkbox"
                                                checked={deckData.isPublic}
                                                onChange={(e) => setDeckData({...deckData, isPublic: e.target.checked})}
                                                style={{opacity: 0, width: 0, height: 0}}
                                            />
                                            <span style={{
                                                position: 'absolute',
                                                top: 0,
                                                left: 0,
                                                right: 0,
                                                bottom: 0,
                                                background: deckData.isPublic ? 'var(--gold)' : 'var(--bg-tertiary)',
                                                borderRadius: '34px',
                                                transition: '0.3s',
                                                border: '2px solid ' + (deckData.isPublic ? 'var(--gold)' : 'var(--border-color)')
                                            }}>
                                                <span style={{
                                                    position: 'absolute',
                                                    content: '',
                                                    height: '26px',
                                                    width: '26px',
                                                    left: deckData.isPublic ? '30px' : '4px',
                                                    bottom: '2px',
                                                    background: 'white',
                                                    borderRadius: '50%',
                                                    transition: '0.3s'
                                                }}></span>
                                            </span>
                                        </label>
                                    </div>
                                    <div style={{
                                        fontSize: '1.15rem',
                                        color: 'var(--text-secondary)',
                                        lineHeight: '1.6',
                                        marginTop: '0.5rem'
                                    }}>
                                        {deckData.isPublic ? (
                                            <span>
                                                ‚ú® <strong style={{color: 'var(--gold)'}}>Deck is public!</strong> Inspire other commanders! üî•
                                            </span>
                                        ) : (
                                            <span>
                                                üîí <strong>Private deck.</strong> Share your tech with the community! üéØ
                                            </span>
                                        )}
                                    </div>
                                </div>

                                <div style={{marginBottom: '1.5rem'}}>
                                    <label style={{display: 'block', marginBottom: '0.5rem', color: 'var(--text-secondary)', fontWeight: 500}}>
                                        Deck Name
                                    </label>
                                    <input 
                                        type="text" 
                                        className="form-input" 
                                        placeholder="My Amazing Commander Deck"
                                        value={deckData.name}
                                        onChange={(e) => setDeckData({...deckData, name: e.target.value})}
                                    />
                                </div>

                                <div style={{marginBottom: '1.5rem'}}>
                                    <label style={{display: 'block', marginBottom: '0.5rem', color: 'var(--text-secondary)', fontWeight: 500}}>
                                        Commander(s)
                                    </label>
                                    <div style={{display: 'flex', gap: '0.5rem'}}>
                                        <CardAutocomplete
                                            value={deckData.commander}
                                            onChange={(val) => setDeckData({...deckData, commander: val})}
                                            placeholder="e.g., Atraxa, Praetors' Voice or Kozilek, Butcher of Truth"
                                        />
                                        <button 
                                            className="btn btn-secondary" 
                                            onClick={async () => {
                                                if (deckData.commander.length > 3) {
                                                    setLoadingCommander(true);
                                                    const card = await fetchCardFromScryfall(deckData.commander);
                                                    setCommanderCard(card);
                                                    setLoadingCommander(false);
                                                }
                                            }}
                                        >
                                            Add
                                        </button>
                                    </div>
                                    {loadingCommander && (
                                        <div style={{textAlign: 'center', marginTop: '1rem', color: 'var(--text-muted)'}}>
                                            Loading commander...
                                        </div>
                                    )}
                                    {commanderCard && (
                                        <div className="commander-preview">
                                            <img 
                                                src={commanderCard.image_uris?.normal || commanderCard.image_uris?.large}
                                                alt={commanderCard.name}
                                                className="commander-card-image"
                                            />
                                        </div>
                                    )}
                                </div>

                                {/* Second Commander Checkbox */}
                                <div style={{marginBottom: '1rem'}}>
                                    <label style={{display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer', color: 'var(--text-secondary)'}}>
                                        <input 
                                            type="checkbox"
                                            checked={deckData.hasSecondCommander}
                                            onChange={(e) => {
                                                setDeckData({
                                                    ...deckData, 
                                                    hasSecondCommander: e.target.checked,
                                                    secondCommander: e.target.checked ? deckData.secondCommander : ''
                                                });
                                                if (!e.target.checked) {
                                                    setSecondCommanderCard(null);
                                                }
                                            }}
                                            style={{width: '18px', height: '18px', cursor: 'pointer'}}
                                        />
                                        <span>Add Second Commander (Partner/Background/Companion)</span>
                                    </label>
                                </div>

                                {/* Second Commander Input */}
                                {deckData.hasSecondCommander && (
                                    <div style={{marginBottom: '1.5rem'}}>
                                        <label style={{display: 'block', marginBottom: '0.5rem', color: 'var(--text-secondary)', fontWeight: 500}}>
                                            Second Commander
                                        </label>
                                        <div style={{display: 'flex', gap: '0.5rem'}}>
                                            <CardAutocomplete
                                                value={deckData.secondCommander}
                                                onChange={(val) => setDeckData({...deckData, secondCommander: val})}
                                                placeholder="e.g., Partner commander or Background"
                                            />
                                            <button 
                                                className="btn btn-secondary" 
                                                onClick={async () => {
                                                    if (deckData.secondCommander.length > 3) {
                                                        setLoadingSecondCommander(true);
                                                        const card = await fetchCardFromScryfall(deckData.secondCommander);
                                                        setSecondCommanderCard(card);
                                                        setLoadingSecondCommander(false);
                                                    }
                                                }}
                                            >
                                                Add
                                            </button>
                                        </div>
                                        {loadingSecondCommander && (
                                            <div style={{textAlign: 'center', marginTop: '1rem', color: 'var(--text-muted)'}}>
                                                Loading second commander...
                                            </div>
                                        )}
                                        {secondCommanderCard && (
                                            <div className="commander-preview">
                                                <img 
                                                    src={secondCommanderCard.image_uris?.normal || secondCommanderCard.image_uris?.large}
                                                    alt={secondCommanderCard.name}
                                                    className="commander-card-image"
                                                />
                                            </div>
                                        )}
                                    </div>
                                )}

                                <div style={{marginBottom: '1.5rem'}}>
                                    <label style={{display: 'block', marginBottom: '0.5rem', color: 'var(--text-secondary)', fontWeight: 500}}>
                                        Color Identity
                                    </label>
                                    <div className="color-picker">
                                        {[
                                            { color: 'W', name: 'White' },
                                            { color: 'U', name: 'Blue' },
                                            { color: 'B', name: 'Black' },
                                            { color: 'R', name: 'Red' },
                                            { color: 'G', name: 'Green' },
                                            { color: 'C', name: 'Colorless' }
                                        ].map(({ color, name }) => (
                                            <div 
                                                key={color}
                                                className={`color-option pip-${color} ${deckData.colors.includes(color) ? 'selected' : ''}`}
                                                onClick={() => toggleColor(color)}
                                                title={name}
                                                style={{position: 'relative'}}
                                            ></div>
                                        ))}
                                    </div>
                                </div>

                                <div style={{marginBottom: '1.5rem'}}>
                                    <label style={{display: 'block', marginBottom: '0.5rem', color: 'var(--text-secondary)', fontWeight: 500}}>
                                        Game Plan <span style={{fontSize: '0.85rem', color: 'var(--text-muted)', fontWeight: 400}}>(Optional)</span>
                                    </label>
                                    <textarea 
                                        className="form-input" 
                                        placeholder="e.g., Ramp early, play big creatures, draw cards, control the board..."
                                        value={deckData.gamePlan || ''}
                                        onChange={(e) => setDeckData({...deckData, gamePlan: e.target.value})}
                                        rows="3"
                                        style={{
                                            width: '100%',
                                            resize: 'vertical',
                                            minHeight: '80px',
                                            fontFamily: 'inherit'
                                        }}
                                    />
                                    <small style={{color: 'var(--text-muted)', fontSize: '0.8rem', display: 'block', marginTop: '0.3rem'}}>
                                        A brief summary of what this deck is trying to do
                                    </small>
                                </div>

                                <div style={{marginBottom: '1.5rem'}}>
                                    <label style={{display: 'block', marginBottom: '0.5rem', color: 'var(--text-secondary)', fontWeight: 500}}>
                                        Notable Cards / Win Conditions
                                    </label>
                                    <div style={{display: 'flex', gap: '0.5rem', marginTop: '1rem'}}>
                                        <CardAutocomplete
                                            value={cardInput}
                                            onChange={setCardInput}
                                            placeholder="e.g., Sol Ring, Craterhoof Behemoth..."
                                            onSelect={(cardName) => addNotableCard(cardName)}
                                        />
                                        <button className="btn btn-secondary" onClick={addNotableCard}>Add</button>
                                    </div>

                                    {notableCards.length > 0 && (
                                        <div className="notable-card-list">
                                            {notableCards.map((card, idx) => (
                                                <div key={idx} className="card-preview">
                                                    <button className="card-remove" onClick={() => setNotableCards(notableCards.filter((_, i) => i !== idx))}>
                                                        √ó
                                                    </button>
                                                    {card.imageUrl && (
                                                        <img src={card.imageUrl} alt={card.name} className="card-preview-image" />
                                                    )}
                                                    <div style={{fontWeight: 600, fontSize: '0.9rem', marginTop: '0.5rem'}}>{card.name}</div>
                                                    <div style={{fontSize: '0.75rem', color: 'var(--text-muted)'}}>{card.typeLine}</div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* FULL CATEGORY SYSTEM - REORDERED & QUICK ENTRY */}
                                <div style={{marginBottom: '2rem'}}>
                                    <h3 style={{
                                        color: 'var(--accent-bright)',
                                        marginBottom: '1rem',
                                        fontSize: '1.2rem',
                                        fontWeight: 600
                                    }}>
                                        üìä Deck Categories
                                    </h3>
                                    
                                    {/* REORDERED: Creatures, Non-Creature, Lands */}
                                    {['creatures', 'noncreature', 'lands'].map(majorGroupId => {
                                        const majorGroup = DECK_CATEGORIES[majorGroupId];
                                        if (!majorGroup) return null;
                                        
                                        // Calculate total from subcategories
                                        const subtypeTotal = majorGroup.categories.reduce((sum, category) => {
                                            return sum + category.subcategories.reduce((catSum, sub) => {
                                                return catSum + (deckData.categories[sub.id] || 0);
                                            }, 0);
                                        }, 0);
                                        
                                        // Add quick total
                                        const quickTotal = deckData.categories[`${majorGroupId}-quick`] || 0;
                                        const groupTotal = subtypeTotal + quickTotal;

                                        return (
                                            <div key={majorGroupId} style={{marginBottom: '1rem'}}>
                                                <button
                                                    onClick={() => setCategoryOpen(prev => ({...prev, [majorGroupId]: !prev[majorGroupId]}))}
                                                    className="btn btn-secondary"
                                                    style={{
                                                        width: '100%',
                                                        display: 'flex',
                                                        justifyContent: 'space-between',
                                                        alignItems: 'center',
                                                        padding: '1rem 1.5rem',
                                                        fontSize: '1rem',
                                                        fontWeight: 600,
                                                        background: categoryOpen[majorGroupId] ? 'var(--bg-tertiary)' : 'var(--bg-secondary)'
                                                    }}
                                                >
                                                    <span style={{display: 'flex', alignItems: 'center', gap: '0.8rem'}}>
                                                        <span>{majorGroup.name}</span>
                                                        <span style={{
                                                            background: 'var(--accent)',
                                                            color: 'white',
                                                            padding: '0.2rem 0.6rem',
                                                            borderRadius: '12px',
                                                            fontSize: '0.85rem',
                                                            fontWeight: 700
                                                        }}>
                                                            {groupTotal}
                                                        </span>
                                                    </span>
                                                    <span style={{fontSize: '1.2rem', transform: categoryOpen[majorGroupId] ? 'rotate(180deg)' : 'rotate(0deg)', transition: 'transform 0.3s'}}>
                                                        ‚ñº
                                                    </span>
                                                </button>

                                                {categoryOpen[majorGroupId] && (
                                                    <div style={{
                                                        marginTop: '0.5rem',
                                                        padding: '1.5rem',
                                                        background: 'var(--bg-tertiary)',
                                                        border: '1px solid var(--border-color)',
                                                        borderRadius: '8px'
                                                    }}>
                                                        {/* QUICK TOTAL INPUT */}
                                                        <div style={{
                                                            background: 'rgba(212, 175, 55, 0.15)',
                                                            border: '2px dashed var(--gold)',
                                                            borderRadius: '12px',
                                                            padding: '1rem',
                                                            marginBottom: '1.5rem'
                                                        }}>
                                                            <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                                                <label style={{fontWeight: 600, color: 'var(--gold)', fontSize: '0.95rem'}}>
                                                                    ‚ö° Quick Total (Skip Subtypes)
                                                                </label>
                                                                {window.innerWidth <= 768 ? (
                                                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(deckData.categories[`${majorGroupId}-quick`]) || 0;
                                                                                if (currentValue > 0) {
                                                                                    const newCategories = {...deckData.categories};
                                                                                    newCategories[`${majorGroupId}-quick`] = currentValue - 1;
                                                                                    setDeckData({...deckData, categories: newCategories});
                                                                                }
                                                                            }}
                                                                            style={{
                                                                                width: '40px',
                                                                                height: '40px',
                                                                                fontSize: '1.2rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--gold)',
                                                                                borderRadius: '6px',
                                                                                color: 'var(--gold)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            ‚àí
                                                                        </button>
                                                                        <input
                                                                            type="number"
                                                                            placeholder="e.g., 34"
                                                                            value={deckData.categories[`${majorGroupId}-quick`] || ''}
                                                                            onChange={(e) => {
                                                                                const newCategories = {...deckData.categories};
                                                                                newCategories[`${majorGroupId}-quick`] = parseInt(e.target.value) || 0;
                                                                                setDeckData({...deckData, categories: newCategories});
                                                                            }}
                                                                            min="0"
                                                                            style={{
                                                                                width: '70px',
                                                                                padding: '0.5rem',
                                                                                fontSize: '0.95rem',
                                                                                borderRadius: '4px',
                                                                                border: '2px solid var(--gold)',
                                                                                background: 'var(--bg-secondary)',
                                                                                color: 'var(--text-primary)',
                                                                                textAlign: 'center',
                                                                                height: '40px'
                                                                            }}
                                                                        />
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(deckData.categories[`${majorGroupId}-quick`]) || 0;
                                                                                const newCategories = {...deckData.categories};
                                                                                newCategories[`${majorGroupId}-quick`] = currentValue + 1;
                                                                                setDeckData({...deckData, categories: newCategories});
                                                                            }}
                                                                            style={{
                                                                                width: '40px',
                                                                                height: '40px',
                                                                                fontSize: '1.2rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--gold)',
                                                                                borderRadius: '6px',
                                                                                color: 'var(--gold)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            +
                                                                        </button>
                                                                    </div>
                                                                ) : (
                                                                    <input
                                                                        type="number"
                                                                        placeholder="e.g., 34"
                                                                        value={deckData.categories[`${majorGroupId}-quick`] || ''}
                                                                        onChange={(e) => {
                                                                            const newCategories = {...deckData.categories};
                                                                            newCategories[`${majorGroupId}-quick`] = parseInt(e.target.value) || 0;
                                                                            setDeckData({...deckData, categories: newCategories});
                                                                        }}
                                                                        min="0"
                                                                        style={{
                                                                            width: '80px',
                                                                            padding: '0.5rem',
                                                                            fontSize: '0.95rem',
                                                                            borderRadius: '4px',
                                                                            border: '2px solid var(--gold)',
                                                                            background: 'var(--bg-secondary)',
                                                                            color: 'var(--text-primary)'
                                                                        }}
                                                                    />
                                                                )}
                                                            </div>
                                                            <small style={{color: 'var(--text-secondary)', display: 'block', lineHeight: '1.4'}}>
                                                                Enter total {majorGroup.name.toLowerCase()} count here if you don't need subtype breakdown
                                                            </small>
                                                        </div>

                                                        {/* SUBCATEGORIES WITH QUICK ENTRY */}
                                                        {majorGroup.categories.map(category => {
                                                            const categoryTotal = category.subcategories.reduce((sum, sub) => {
                                                                return sum + (deckData.categories[sub.id] || 0);
                                                            }, 0);
                                                            
                                                            return (
                                                                <div key={category.id} style={{marginBottom: '1.5rem'}}>
                                                                    <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '0.8rem'}}>
                                                                        <h4 style={{
                                                                            color: 'var(--accent-bright)',
                                                                            fontSize: '1.1rem',
                                                                            fontWeight: 700,
                                                                            textTransform: 'uppercase',
                                                                            letterSpacing: '0.5px',
                                                                            margin: 0
                                                                        }}>
                                                                            {category.name}
                                                                        </h4>
                                                                        {/* Quick entry for this category group */}
                                                                        <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                                                            <span style={{fontSize: '0.75rem', color: 'var(--text-muted)'}}>Quick:</span>
                                                                            {window.innerWidth <= 768 ? (
                                                                                <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                                    <button
                                                                                        type="button"
                                                                                        onClick={(e) => {
                                                                                            e.preventDefault();
                                                                                            const currentValue = parseInt(deckData.categories[`${category.id}-quick`]) || 0;
                                                                                            if (currentValue > 0) {
                                                                                                const newCategories = {...deckData.categories};
                                                                                                newCategories[`${category.id}-quick`] = currentValue - 1;
                                                                                                setDeckData({...deckData, categories: newCategories});
                                                                                            }
                                                                                        }}
                                                                                        style={{
                                                                                            width: '28px',
                                                                                            height: '28px',
                                                                                            fontSize: '1rem',
                                                                                            padding: 0,
                                                                                            background: 'var(--bg-primary)',
                                                                                            border: '1px solid var(--border-color)',
                                                                                            borderRadius: '4px',
                                                                                            color: 'var(--text-primary)',
                                                                                            cursor: 'pointer',
                                                                                            display: 'flex',
                                                                                            alignItems: 'center',
                                                                                            justifyContent: 'center',
                                                                                            fontWeight: 'bold'
                                                                                        }}
                                                                                    >
                                                                                        ‚àí
                                                                                    </button>
                                                                                    <input
                                                                                        type="number"
                                                                                        placeholder="0"
                                                                                        value={deckData.categories[`${category.id}-quick`] || ''}
                                                                                        onChange={(e) => {
                                                                                            const newCategories = {...deckData.categories};
                                                                                            newCategories[`${category.id}-quick`] = parseInt(e.target.value) || 0;
                                                                                            setDeckData({...deckData, categories: newCategories});
                                                                                        }}
                                                                                        min="0"
                                                                                        style={{
                                                                                            width: '50px',
                                                                                            padding: '0.3rem',
                                                                                            fontSize: '0.85rem',
                                                                                            borderRadius: '4px',
                                                                                            border: '1px solid var(--accent)',
                                                                                            background: 'var(--bg-secondary)',
                                                                                            color: 'var(--text-primary)',
                                                                                            textAlign: 'center'
                                                                                        }}
                                                                                    />
                                                                                    <button
                                                                                        type="button"
                                                                                        onClick={(e) => {
                                                                                            e.preventDefault();
                                                                                            const currentValue = parseInt(deckData.categories[`${category.id}-quick`]) || 0;
                                                                                            const newCategories = {...deckData.categories};
                                                                                            newCategories[`${category.id}-quick`] = currentValue + 1;
                                                                                            setDeckData({...deckData, categories: newCategories});
                                                                                        }}
                                                                                        style={{
                                                                                            width: '28px',
                                                                                            height: '28px',
                                                                                            fontSize: '1rem',
                                                                                            padding: 0,
                                                                                            background: 'var(--bg-primary)',
                                                                                            border: '1px solid var(--border-color)',
                                                                                            borderRadius: '4px',
                                                                                            color: 'var(--text-primary)',
                                                                                            cursor: 'pointer',
                                                                                            display: 'flex',
                                                                                            alignItems: 'center',
                                                                                            justifyContent: 'center',
                                                                                            fontWeight: 'bold'
                                                                                        }}
                                                                                    >
                                                                                        +
                                                                                    </button>
                                                                                </div>
                                                                            ) : (
                                                                                <input
                                                                                    type="number"
                                                                                    placeholder="0"
                                                                                    value={deckData.categories[`${category.id}-quick`] || ''}
                                                                                    onChange={(e) => {
                                                                                        const newCategories = {...deckData.categories};
                                                                                        newCategories[`${category.id}-quick`] = parseInt(e.target.value) || 0;
                                                                                        setDeckData({...deckData, categories: newCategories});
                                                                                    }}
                                                                                    min="0"
                                                                                    style={{
                                                                                        width: '60px',
                                                                                        padding: '0.3rem',
                                                                                        fontSize: '0.85rem',
                                                                                        borderRadius: '4px',
                                                                                        border: '1px solid var(--accent)',
                                                                                        background: 'var(--bg-secondary)',
                                                                                        color: 'var(--text-primary)'
                                                                                    }}
                                                                                />
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                    <div style={{
                                                                        display: 'grid',
                                                                        gridTemplateColumns: 'repeat(auto-fill, minmax(180px, 1fr))',
                                                                        gap: '0.5rem'
                                                                    }}>
                                                                        {category.subcategories.map(sub => (
                                                                            <div key={sub.id} style={{
                                                                                display: 'flex',
                                                                                justifyContent: 'space-between',
                                                                                alignItems: 'center',
                                                                                padding: '0.5rem',
                                                                                background: 'var(--bg-secondary)',
                                                                                borderRadius: '4px'
                                                                            }}>
                                                                                <label style={{
                                                                                    fontSize: '0.8rem',
                                                                                    color: 'var(--text-secondary)',
                                                                                    flex: 1
                                                                                }}>
                                                                                    {sub.name}
                                                                                </label>
                                                                                {window.innerWidth <= 768 ? (
                                                                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                                        <button
                                                                                            type="button"
                                                                                            onClick={(e) => {
                                                                                                e.preventDefault();
                                                                                                const currentValue = parseInt(deckData.categories[sub.id]) || 0;
                                                                                                if (currentValue > 0) {
                                                                                                    const newCategories = {...deckData.categories};
                                                                                                    newCategories[sub.id] = currentValue - 1;
                                                                                                    setDeckData({...deckData, categories: newCategories});
                                                                                                }
                                                                                            }}
                                                                                            style={{
                                                                                                width: '28px',
                                                                                                height: '28px',
                                                                                                fontSize: '1rem',
                                                                                                padding: 0,
                                                                                                background: 'var(--bg-primary)',
                                                                                                border: '1px solid var(--border-color)',
                                                                                                borderRadius: '4px',
                                                                                                color: 'var(--text-primary)',
                                                                                                cursor: 'pointer',
                                                                                                display: 'flex',
                                                                                                alignItems: 'center',
                                                                                                justifyContent: 'center',
                                                                                                fontWeight: 'bold'
                                                                                            }}
                                                                                        >
                                                                                            ‚àí
                                                                                        </button>
                                                                                        <input
                                                                                            type="number"
                                                                                            className="small-input"
                                                                                            value={deckData.categories[sub.id] || 0}
                                                                                            onChange={(e) => {
                                                                                                const newCategories = {...deckData.categories};
                                                                                                newCategories[sub.id] = parseInt(e.target.value) || 0;
                                                                                                setDeckData({...deckData, categories: newCategories});
                                                                                            }}
                                                                                            min="0"
                                                                                            style={{
                                                                                                width: '50px',
                                                                                                padding: '0.3rem',
                                                                                                fontSize: '0.85rem',
                                                                                                textAlign: 'center'
                                                                                            }}
                                                                                        />
                                                                                        <button
                                                                                            type="button"
                                                                                            onClick={(e) => {
                                                                                                e.preventDefault();
                                                                                                const currentValue = parseInt(deckData.categories[sub.id]) || 0;
                                                                                                const newCategories = {...deckData.categories};
                                                                                                newCategories[sub.id] = currentValue + 1;
                                                                                                setDeckData({...deckData, categories: newCategories});
                                                                                            }}
                                                                                            style={{
                                                                                                width: '28px',
                                                                                                height: '28px',
                                                                                                fontSize: '1rem',
                                                                                                padding: 0,
                                                                                                background: 'var(--bg-primary)',
                                                                                                border: '1px solid var(--border-color)',
                                                                                                borderRadius: '4px',
                                                                                                color: 'var(--text-primary)',
                                                                                                cursor: 'pointer',
                                                                                                display: 'flex',
                                                                                                alignItems: 'center',
                                                                                                justifyContent: 'center',
                                                                                                fontWeight: 'bold'
                                                                                            }}
                                                                                        >
                                                                                            +
                                                                                        </button>
                                                                                    </div>
                                                                                ) : (
                                                                                    <input
                                                                                        type="number"
                                                                                        className="small-input"
                                                                                        value={deckData.categories[sub.id] || 0}
                                                                                        onChange={(e) => {
                                                                                            const newCategories = {...deckData.categories};
                                                                                            newCategories[sub.id] = parseInt(e.target.value) || 0;
                                                                                            setDeckData({...deckData, categories: newCategories});
                                                                                        }}
                                                                                        min="0"
                                                                                        style={{
                                                                                            width: '60px',
                                                                                            padding: '0.3rem',
                                                                                            fontSize: '0.85rem'
                                                                                        }}
                                                                                    />
                                                                                )}
                                                                            </div>
                                                                        ))}
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>

                                {/* SIDEBOARD SECTION */}
                                <div style={{marginBottom: '2rem'}}>
                                    <button
                                        onClick={() => setSideboardOpen(!sideboardOpen)}
                                        className="btn btn-secondary"
                                        style={{
                                            width: '100%',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center',
                                            padding: '1rem 1.5rem',
                                            fontSize: '1.05rem',
                                            fontWeight: 600
                                        }}
                                    >
                                        <span style={{display: 'flex', alignItems: 'center', gap: '0.8rem'}}>
                                            <span>üìã</span>
                                            <span>Sideboard</span>
                                            <span style={{
                                                background: 'var(--accent)',
                                                color: 'white',
                                                padding: '0.2rem 0.6rem',
                                                borderRadius: '12px',
                                                fontSize: '0.85rem',
                                                fontWeight: 700
                                            }}>
                                                {sideboardTotals.total}
                                            </span>
                                            {sideboardTotals.total > 0 && (
                                                <span style={{fontSize: '0.85rem', color: 'var(--text-muted)', marginLeft: '0.5rem'}}>
                                                    ‚Ä¢ {(() => {
                                                        const creatures = Object.entries(DECK_CATEGORIES.creatures.categories).reduce((sum, [_, category]) => {
                                                            const quick = sideboardQuickInputs[category.id] || 0;
                                                            const detailed = category.subcategories.reduce((s, sub) => s + (sideboardCategories[sub.id] || 0), 0);
                                                            return sum + quick + detailed;
                                                        }, 0);
                                                        const spells = Object.entries(DECK_CATEGORIES.noncreature.categories).reduce((sum, [_, category]) => {
                                                            const quick = sideboardQuickInputs[category.id] || 0;
                                                            const detailed = category.subcategories.reduce((s, sub) => s + (sideboardCategories[sub.id] || 0), 0);
                                                            return sum + quick + detailed;
                                                        }, 0);
                                                        const lands = Object.entries(DECK_CATEGORIES.lands.categories).reduce((sum, [_, category]) => {
                                                            const quick = sideboardQuickInputs[category.id] || 0;
                                                            const detailed = category.subcategories.reduce((s, sub) => s + (sideboardCategories[sub.id] || 0), 0);
                                                            return sum + quick + detailed;
                                                        }, 0);
                                                        
                                                        const parts = [];
                                                        if (creatures > 0) parts.push(`${creatures} creature${creatures !== 1 ? 's' : ''}`);
                                                        if (spells > 0) parts.push(`${spells} spell${spells !== 1 ? 's' : ''}`);
                                                        if (lands > 0) parts.push(`${lands} land${lands !== 1 ? 's' : ''}`);
                                                        return parts.join(', ');
                                                    })()}
                                                </span>
                                            )}
                                        </span>
                                        <span style={{fontSize: '1.2rem', transform: sideboardOpen ? 'rotate(180deg)' : 'rotate(0deg)', transition: 'transform 0.3s'}}>
                                            ‚ñº
                                        </span>
                                    </button>
                                    
                                    {/* Sideboard Summary */}
                                    {sideboardTotals.total > 0 && !sideboardOpen && (
                                        <div style={{
                                            marginTop: '0.8rem',
                                            padding: '1rem',
                                            background: 'rgba(212, 175, 55, 0.1)',
                                            border: '1px solid rgba(212, 175, 55, 0.3)',
                                            borderRadius: '8px'
                                        }}>
                                            <div style={{fontSize: '0.9rem', color: 'var(--text-secondary)', marginBottom: '0.5rem', fontWeight: 600}}>
                                                üí≠ Considering:
                                            </div>
                                            <div style={{display: 'flex', flexWrap: 'wrap', gap: '0.5rem', fontSize: '0.85rem'}}>
                                                {Object.entries(DECK_CATEGORIES).map(([majorGroupId, majorGroup]) => {
                                                    return majorGroup.categories.flatMap(category => 
                                                        category.subcategories
                                                            .filter(sub => sideboardCategories[sub.id] > 0)
                                                            .map(sub => (
                                                                <span key={sub.id} style={{
                                                                    background: 'var(--bg-secondary)',
                                                                    padding: '0.3rem 0.6rem',
                                                                    borderRadius: '12px',
                                                                    color: 'var(--accent-bright)',
                                                                    fontWeight: 500
                                                                }}>
                                                                    {sideboardCategories[sub.id]} {sub.name}
                                                                </span>
                                                            ))
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    )}
                                    
                                    {sideboardOpen && (
                                        <div style={{
                                            marginTop: '1rem',
                                            padding: '1.5rem',
                                            background: 'var(--bg-tertiary)',
                                            border: '1px solid var(--border-color)',
                                            borderRadius: '8px'
                                        }}>
                                            <div style={{
                                                marginBottom: '1.5rem',
                                                padding: '1rem',
                                                background: 'rgba(212, 175, 55, 0.1)',
                                                border: '1px solid var(--accent)',
                                                borderRadius: '6px',
                                                fontSize: '0.9rem',
                                                color: 'var(--text-secondary)'
                                            }}>
                                                <strong style={{color: 'var(--accent-bright)'}}>üí° Sideboard Note:</strong> These cards don't count toward your 100-card deck total. Use this for cards you're considering, alternatives, or format-specific sideboard options.
                                            </div>

                                            {Object.entries(DECK_CATEGORIES).map(([majorGroupId, majorGroup]) => (
                                                <div key={majorGroupId} style={{marginBottom: '1.5rem'}}>
                                                    <h4 style={{
                                                        color: 'var(--accent-bright)',
                                                        marginBottom: '1rem',
                                                        fontSize: '1rem',
                                                        fontWeight: 600,
                                                        textTransform: 'uppercase',
                                                        letterSpacing: '0.5px'
                                                    }}>
                                                        {majorGroup.name}
                                                    </h4>
                                                    
                                                    {majorGroup.categories.map(category => (
                                                        <div key={category.id} style={{marginBottom: '1rem'}}>
                                                            <div style={{
                                                                fontWeight: 600,
                                                                marginBottom: '0.5rem',
                                                                color: 'var(--text-primary)',
                                                                fontSize: '0.9rem'
                                                            }}>
                                                                {category.name}
                                                            </div>
                                                            <div style={{
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                gap: '0.8rem',
                                                                marginBottom: '0.5rem',
                                                                padding: '0.5rem',
                                                                background: 'var(--bg-secondary)',
                                                                borderRadius: '4px'
                                                            }}>
                                                                <span style={{fontSize: '0.75rem', color: 'var(--text-muted)'}}>Quick:</span>
                                                                {window.innerWidth <= 768 ? (
                                                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(sideboardQuickInputs[category.id]) || 0;
                                                                                if (currentValue > 0) {
                                                                                    setSideboardQuickInputs(prev => ({...prev, [category.id]: currentValue - 1}));
                                                                                }
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-primary)',
                                                                                border: '1px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            ‚àí
                                                                        </button>
                                                                        <input
                                                                            type="number"
                                                                            placeholder="0"
                                                                            value={sideboardQuickInputs[category.id] || ''}
                                                                            onChange={(e) => {
                                                                                const val = parseInt(e.target.value) || 0;
                                                                                setSideboardQuickInputs(prev => ({...prev, [category.id]: val}));
                                                                            }}
                                                                            min="0"
                                                                            style={{
                                                                                width: '50px',
                                                                                padding: '0.3rem',
                                                                                fontSize: '0.85rem',
                                                                                borderRadius: '4px',
                                                                                border: '1px solid var(--accent)',
                                                                                background: 'var(--bg-tertiary)',
                                                                                color: 'var(--text-primary)',
                                                                                textAlign: 'center'
                                                                            }}
                                                                        />
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(sideboardQuickInputs[category.id]) || 0;
                                                                                setSideboardQuickInputs(prev => ({...prev, [category.id]: currentValue + 1}));
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-primary)',
                                                                                border: '1px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            +
                                                                        </button>
                                                                    </div>
                                                                ) : (
                                                                    <input
                                                                        type="number"
                                                                        placeholder="0"
                                                                        value={sideboardQuickInputs[category.id] || ''}
                                                                        onChange={(e) => {
                                                                            const val = parseInt(e.target.value) || 0;
                                                                            setSideboardQuickInputs(prev => ({...prev, [category.id]: val}));
                                                                        }}
                                                                        min="0"
                                                                        style={{
                                                                            width: '60px',
                                                                            padding: '0.3rem',
                                                                            fontSize: '0.85rem',
                                                                            borderRadius: '4px',
                                                                            border: '1px solid var(--accent)',
                                                                            background: 'var(--bg-tertiary)',
                                                                            color: 'var(--text-primary)',
                                                                            textAlign: 'center'
                                                                        }}
                                                                    />
                                                                )}
                                                            </div>
                                                            <div style={{
                                                                display: 'grid',
                                                                gridTemplateColumns: 'repeat(auto-fill, minmax(180px, 1fr))',
                                                                gap: '0.5rem'
                                                            }}>
                                                                {category.subcategories.map(sub => (
                                                                    <div key={sub.id} style={{
                                                                        display: 'flex',
                                                                        justifyContent: 'space-between',
                                                                        alignItems: 'center',
                                                                        padding: '0.5rem',
                                                                        background: 'var(--bg-secondary)',
                                                                        borderRadius: '4px'
                                                                    }}>
                                                                        <label style={{
                                                                            fontSize: '0.85rem',
                                                                            color: 'var(--text-secondary)',
                                                                            flex: 1
                                                                        }}>
                                                                            {sub.name}
                                                                        </label>
                                                                        {window.innerWidth <= 768 ? (
                                                                            <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                                <button
                                                                                    type="button"
                                                                                    onClick={(e) => {
                                                                                        e.preventDefault();
                                                                                        const currentValue = parseInt(sideboardCategories[sub.id]) || 0;
                                                                                        if (currentValue > 0) {
                                                                                            updateSideboardCategory(sub.id, currentValue - 1);
                                                                                        }
                                                                                    }}
                                                                                    style={{
                                                                                        width: '28px',
                                                                                        height: '28px',
                                                                                        fontSize: '1rem',
                                                                                        padding: 0,
                                                                                        background: 'var(--bg-primary)',
                                                                                        border: '1px solid var(--border-color)',
                                                                                        borderRadius: '4px',
                                                                                        color: 'var(--text-primary)',
                                                                                        cursor: 'pointer',
                                                                                        display: 'flex',
                                                                                        alignItems: 'center',
                                                                                        justifyContent: 'center',
                                                                                        fontWeight: 'bold'
                                                                                    }}
                                                                                >
                                                                                    ‚àí
                                                                                </button>
                                                                                <input
                                                                                    type="number"
                                                                                    className="small-input"
                                                                                    value={sideboardCategories[sub.id] || 0}
                                                                                    onChange={(e) => updateSideboardCategory(sub.id, e.target.value)}
                                                                                    min="0"
                                                                                    style={{
                                                                                        width: '50px',
                                                                                        padding: '0.3rem',
                                                                                        fontSize: '0.85rem',
                                                                                        textAlign: 'center'
                                                                                    }}
                                                                                />
                                                                                <button
                                                                                    type="button"
                                                                                    onClick={(e) => {
                                                                                        e.preventDefault();
                                                                                        const currentValue = parseInt(sideboardCategories[sub.id]) || 0;
                                                                                        updateSideboardCategory(sub.id, currentValue + 1);
                                                                                    }}
                                                                                    style={{
                                                                                        width: '28px',
                                                                                        height: '28px',
                                                                                        fontSize: '1rem',
                                                                                        padding: 0,
                                                                                        background: 'var(--bg-primary)',
                                                                                        border: '1px solid var(--border-color)',
                                                                                        borderRadius: '4px',
                                                                                        color: 'var(--text-primary)',
                                                                                        cursor: 'pointer',
                                                                                        display: 'flex',
                                                                                        alignItems: 'center',
                                                                                        justifyContent: 'center',
                                                                                        fontWeight: 'bold'
                                                                                    }}
                                                                                >
                                                                                    +
                                                                                </button>
                                                                            </div>
                                                                        ) : (
                                                                            <input
                                                                                type="number"
                                                                                className="small-input"
                                                                                value={sideboardCategories[sub.id] || 0}
                                                                                onChange={(e) => updateSideboardCategory(sub.id, e.target.value)}
                                                                                min="0"
                                                                                style={{
                                                                                    width: '60px',
                                                                                    padding: '0.3rem',
                                                                                    fontSize: '0.85rem'
                                                                                }}
                                                                            />
                                                                        )}
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* MANA BASE CALCULATOR - COLLAPSIBLE */}
                                <div style={{marginBottom: '2rem'}}>
                                    <button
                                        onClick={() => setManaCalcOpen(!manaCalcOpen)}
                                        className="btn btn-secondary"
                                        style={{
                                            width: '100%',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center',
                                            padding: '1rem 1.5rem',
                                            fontSize: '1.05rem',
                                            fontWeight: 600
                                        }}
                                    >
                                        <span style={{display: 'flex', alignItems: 'center', gap: '0.8rem'}}>
                                            <span>‚öóÔ∏è</span>
                                            <span>Mana Base Calculator</span>
                                            <span style={{fontSize: '0.8rem', opacity: 0.7}}>(Optional)</span>
                                        </span>
                                        <span style={{fontSize: '1.2rem', transform: manaCalcOpen ? 'rotate(180deg)' : 'rotate(0deg)', transition: 'transform 0.3s'}}>
                                            ‚ñº
                                        </span>
                                    </button>
                                    
                                    {manaCalcOpen && (
                                <div className="mana-calculator" style={{marginTop: '1rem'}}>
                                    <div className="calculator-title">‚öóÔ∏è Mana Base Calculator</div>
                                    <div style={{fontSize: '0.9rem', color: 'var(--text-secondary)', marginBottom: '1.5rem'}}>
                                        Build your optimal mana base based on your deck's color requirements!
                                    </div>

                                        <div style={{marginBottom: '1.5rem'}}>
                                            <label style={{fontWeight: 600, marginBottom: '0.5rem', display: 'block'}}>
                                                Total Lands in Deck
                                            </label>
                                            {window.innerWidth <= 768 ? (
                                                <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(totalLands) || 0;
                                                            if (currentValue > 0) {
                                                                setTotalLands(currentValue - 1);
                                                            }
                                                        }}
                                                        style={{
                                                            width: '36px',
                                                            height: '36px',
                                                            fontSize: '1.2rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '6px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        ‚àí
                                                    </button>
                                                    <input 
                                                        type="number"
                                                        className="small-input"
                                                        value={totalLands}
                                                        onChange={(e) => setTotalLands(parseInt(e.target.value) || 38)}
                                                        min="0"
                                                        max="99"
                                                        style={{flex: 1, textAlign: 'center', minWidth: '80px'}}
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(totalLands) || 0;
                                                            if (currentValue < 99) {
                                                                setTotalLands(currentValue + 1);
                                                            }
                                                        }}
                                                        style={{
                                                            width: '36px',
                                                            height: '36px',
                                                            fontSize: '1.2rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '6px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        +
                                                    </button>
                                                </div>
                                            ) : (
                                                <input 
                                                    type="number"
                                                    className="small-input"
                                                    value={totalLands}
                                                    onChange={(e) => setTotalLands(parseInt(e.target.value) || 38)}
                                                    min="0"
                                                    max="99"
                                                />
                                            )}
                                            <small style={{color: 'var(--text-muted)', marginLeft: '1rem'}}>
                                                Recommended: 36-38 lands
                                            </small>
                                        </div>

                                        <div style={{marginBottom: '1.5rem'}}>
                                            <label style={{fontWeight: 600, marginBottom: '0.5rem', display: 'block'}}>
                                                Tri-Lands (Triomes & 3+ color lands)
                                            </label>
                                            {window.innerWidth <= 768 ? (
                                                <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(triLands) || 0;
                                                            if (currentValue > 0) {
                                                                setTriLands(currentValue - 1);
                                                            }
                                                        }}
                                                        style={{
                                                            width: '36px',
                                                            height: '36px',
                                                            fontSize: '1.2rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '6px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        ‚àí
                                                    </button>
                                                    <input 
                                                        type="number"
                                                        className="small-input"
                                                        value={triLands}
                                                        onChange={(e) => setTriLands(parseInt(e.target.value) || 0)}
                                                        min="0"
                                                        max="20"
                                                        style={{flex: 1, textAlign: 'center', minWidth: '80px'}}
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(triLands) || 0;
                                                            if (currentValue < 20) {
                                                                setTriLands(currentValue + 1);
                                                            }
                                                        }}
                                                        style={{
                                                            width: '36px',
                                                            height: '36px',
                                                            fontSize: '1.2rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '6px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        +
                                                    </button>
                                                </div>
                                            ) : (
                                                <input 
                                                    type="number"
                                                    className="small-input"
                                                    value={triLands}
                                                    onChange={(e) => setTriLands(parseInt(e.target.value) || 0)}
                                                    min="0"
                                                    max="20"
                                                />
                                            )}
                                            <div style={{marginLeft: '1rem', marginTop: '0.5rem'}}>
                                                <small style={{color: 'var(--text-secondary)', display: 'block', lineHeight: '1.5', marginBottom: '0.3rem', fontSize: '0.8rem'}}>
                                                    <strong>Include:</strong> Triomes (Ketria, Savai, etc.), Panoramas, sac lands that search for 3+ basic types
                                                </small>
                                                <small style={{color: 'var(--accent-bright)', display: 'block', fontStyle: 'italic', fontSize: '0.8rem'}}>
                                                    üí° These subtract from total but provide 3+ colors
                                                </small>
                                            </div>
                                        </div>

                                        <div style={{marginBottom: '1.5rem'}}>
                                            <label style={{fontWeight: 600, marginBottom: '0.5rem', display: 'block'}}>
                                                Other Lands (Colorless & Utility)
                                            </label>
                                            {window.innerWidth <= 768 ? (
                                                <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(otherLands) || 0;
                                                            if (currentValue > 0) {
                                                                setOtherLands(currentValue - 1);
                                                            }
                                                        }}
                                                        style={{
                                                            width: '36px',
                                                            height: '36px',
                                                            fontSize: '1.2rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '6px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        ‚àí
                                                    </button>
                                                    <input 
                                                        type="number"
                                                        className="small-input"
                                                        value={otherLands}
                                                        onChange={(e) => setOtherLands(parseInt(e.target.value) || 0)}
                                                        min="0"
                                                        max="20"
                                                        style={{flex: 1, textAlign: 'center', minWidth: '80px'}}
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(otherLands) || 0;
                                                            if (currentValue < 20) {
                                                                setOtherLands(currentValue + 1);
                                                            }
                                                        }}
                                                        style={{
                                                            width: '36px',
                                                            height: '36px',
                                                            fontSize: '1.2rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '6px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        +
                                                    </button>
                                                </div>
                                            ) : (
                                                <input 
                                                    type="number"
                                                    className="small-input"
                                                    value={otherLands}
                                                    onChange={(e) => setOtherLands(parseInt(e.target.value) || 0)}
                                                    min="0"
                                                    max="20"
                                                />
                                            )}
                                            <div style={{marginLeft: '1rem', marginTop: '0.5rem'}}>
                                                <small style={{color: 'var(--text-secondary)', display: 'block', lineHeight: '1.5', marginBottom: '0.3rem', fontSize: '0.8rem'}}>
                                                    <strong>Include:</strong> Command Tower, Reliquary Tower, Wastes, utility lands
                                                </small>
                                                <small style={{color: 'var(--accent-bright)', display: 'block', fontStyle: 'italic', fontSize: '0.8rem'}}>
                                                    üí° Subtract from total but don't provide colored mana
                                                </small>
                                            </div>
                                        </div>

                                        {/* STEP 1: Dual Lands */}
                                        <div style={{
                                            background: 'linear-gradient(135deg, rgba(0, 115, 62, 0.12) 0%, rgba(34, 139, 34, 0.12) 100%)',
                                            border: '3px solid rgba(0, 115, 62, 0.4)',
                                            borderRadius: '12px',
                                            padding: '1.5rem',
                                            marginBottom: '1.5rem'
                                        }}>
                                            <div style={{
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '0.8rem',
                                                marginBottom: '0.5rem'
                                            }}>
                                                <div style={{
                                                    background: 'linear-gradient(135deg, #00733e 0%, #228b22 100%)',
                                                    color: 'white',
                                                    width: '36px',
                                                    height: '36px',
                                                    borderRadius: '50%',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    fontWeight: 700,
                                                    fontSize: '1.15rem'
                                                }}>
                                                    2
                                                </div>
                                                <label style={{fontWeight: 700, fontSize: '1.15rem', color: 'var(--text-primary)', margin: 0}}>
                                                    üèîÔ∏è Count Actual LANDS in Your Deck
                                                </label>
                                            </div>
                                            <div style={{
                                                background: 'rgba(0, 115, 62, 0.15)',
                                                border: '1px solid rgba(0, 115, 62, 0.3)',
                                                borderRadius: '12px',
                                                padding: '1rem',
                                                marginBottom: '1rem',
                                                marginLeft: '2.5rem'
                                            }}>
                                                <div style={{fontWeight: 600, color: 'var(--text-primary)', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
                                                    What to count:
                                                </div>
                                                <div style={{color: 'var(--text-secondary)', fontSize: '0.85rem', lineHeight: '1.6'}}>
                                                    How many <strong>dual lands</strong> (produce or fetch 2 colors) are you running? This is separate from Step 1.
                                                    <br/>
                                                    <strong>Include:</strong> Shocklands, Fetchlands, Pain lands, etc. Example: 4 Temple Gardens + 3 Windswept Heaths = 7 for Selesnya.
                                                </div>
                                            </div>
                                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem', paddingLeft: '2.5rem'}}>
                                                {colorPairs.map(({pair, colors, name}) => (
                                                    <div key={pair}>
                                                        <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.3rem'}}>
                                                            <div className={`pip-icon pip-${colors[0]}`} style={{width: '16px', height: '16px'}}></div>
                                                            <div className={`pip-icon pip-${colors[1]}`} style={{width: '16px', height: '16px'}}></div>
                                                            <span style={{fontSize: '0.85rem'}}>{name}</span>
                                                        </div>
                                                        {window.innerWidth <= 768 ? (
                                                            <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                                                <button
                                                                    type="button"
                                                                    onClick={(e) => {
                                                                        e.preventDefault();
                                                                        const currentValue = parseInt(dualLands[pair]) || 0;
                                                                        if (currentValue > 0) {
                                                                            updateDualLands(pair, (currentValue - 1).toString());
                                                                        }
                                                                    }}
                                                                    style={{
                                                                        width: '36px',
                                                                        height: '36px',
                                                                        fontSize: '1.2rem',
                                                                        padding: 0,
                                                                        background: 'var(--bg-secondary)',
                                                                        border: '2px solid var(--border-color)',
                                                                        borderRadius: '6px',
                                                                        color: 'var(--text-primary)',
                                                                        cursor: 'pointer',
                                                                        display: 'flex',
                                                                        alignItems: 'center',
                                                                        justifyContent: 'center',
                                                                        fontWeight: 'bold'
                                                                    }}
                                                                >
                                                                    ‚àí
                                                                </button>
                                                                <input 
                                                                    type="number"
                                                                    className="small-input"
                                                                    style={{flex: 1, textAlign: 'center'}}
                                                                    value={dualLands[pair]}
                                                                    onChange={(e) => updateDualLands(pair, e.target.value)}
                                                                    min="0"
                                                                />
                                                                <button
                                                                    type="button"
                                                                    onClick={(e) => {
                                                                        e.preventDefault();
                                                                        const currentValue = parseInt(dualLands[pair]) || 0;
                                                                        updateDualLands(pair, (currentValue + 1).toString());
                                                                    }}
                                                                    style={{
                                                                        width: '36px',
                                                                        height: '36px',
                                                                        fontSize: '1.2rem',
                                                                        padding: 0,
                                                                        background: 'var(--bg-secondary)',
                                                                        border: '2px solid var(--border-color)',
                                                                        borderRadius: '6px',
                                                                        color: 'var(--text-primary)',
                                                                        cursor: 'pointer',
                                                                        display: 'flex',
                                                                        alignItems: 'center',
                                                                        justifyContent: 'center',
                                                                        fontWeight: 'bold'
                                                                    }}
                                                                >
                                                                    +
                                                                </button>
                                                            </div>
                                                        ) : (
                                                            <input 
                                                                type="number"
                                                                className="small-input"
                                                                style={{width: '100%'}}
                                                                value={dualLands[pair]}
                                                                onChange={(e) => updateDualLands(pair, e.target.value)}
                                                                min="0"
                                                            />
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Calculate Button */}
                                        {/* STEP 2: Count Mana Pips */}
                                        <div style={{
                                            background: 'linear-gradient(135deg, rgba(66, 135, 245, 0.12) 0%, rgba(136, 106, 234, 0.12) 100%)',
                                            border: '3px solid rgba(66, 135, 245, 0.4)',
                                            borderRadius: '12px',
                                            padding: '1.5rem',
                                            marginBottom: '1.5rem'
                                        }}>
                                            <div style={{
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '0.8rem',
                                                marginBottom: '0.5rem'
                                            }}>
                                                <div style={{
                                                    background: 'linear-gradient(135deg, #4287f5 0%, #886aea 100%)',
                                                    color: 'white',
                                                    width: '36px',
                                                    height: '36px',
                                                    borderRadius: '50%',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    fontWeight: 700,
                                                    fontSize: '1.15rem'
                                                }}>
                                                    1
                                                </div>
                                                <label style={{fontWeight: 700, fontSize: '1.15rem', color: 'var(--text-primary)', margin: 0}}>
                                                    üé¥ Count Mana Pips from Your SPELLS
                                                </label>
                                            </div>
                                            <div style={{
                                                background: 'rgba(66, 135, 245, 0.15)',
                                                border: '1px solid rgba(66, 135, 245, 0.3)',
                                                borderRadius: '12px',
                                                padding: '1rem',
                                                marginBottom: '1rem',
                                                marginLeft: '2.5rem'
                                            }}>
                                                <div style={{fontWeight: 600, color: 'var(--text-primary)', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
                                                    What to count:
                                                </div>
                                                <div style={{color: 'var(--text-secondary)', fontSize: '0.85rem', lineHeight: '1.6'}}>
                                                    Look at <strong>all the spells in your deck</strong> and count colored mana symbols in their costs. Wrath of God = 2 White (double).
                                                    <br/><br/>
                                                    <div style={{
                                                        background: 'rgba(212, 175, 55, 0.15)',
                                                        border: '1px solid rgba(212, 175, 55, 0.3)',
                                                        borderRadius: '6px',
                                                        padding: '0.7rem',
                                                        fontSize: '0.82rem'
                                                    }}>
                                                        <strong style={{color: 'var(--accent-bright)'}}>üß† Smart weighting:</strong> The calculator knows {'{U}{U}'} is harder to cast than {'{1}{U}'}. It weights pips accordingly!
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="pip-counter" style={{overflowX: 'auto'}}>
                                                {['W', 'U', 'B', 'R', 'G'].map(color => (
                                                    <div key={color} className="pip-input-group" style={{minWidth: '160px'}}>
                                                        <div className="pip-label">
                                                            <div className={`pip-icon pip-${color}`}></div>
                                                            <span>{color}</span>
                                                        </div>
                                                        <div style={{marginTop: '0.5rem'}}>
                                                            <div style={{flex: '1 1 50px', minWidth: '50px', marginBottom: '0.5rem'}}>
                                                                <div style={{fontSize: '0.7rem', marginBottom: '0.3rem'}}>Single</div>
                                                                {window.innerWidth <= 768 ? (
                                                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(pipCounts[color].single) || 0;
                                                                                if (currentValue > 0) {
                                                                                    updatePipCount(color, 'single', (currentValue - 1).toString());
                                                                                }
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            ‚àí
                                                                        </button>
                                                                        <input 
                                                                            type="number"
                                                                            className="small-input"
                                                                            style={{flex: 1, padding: '0.5rem', fontSize: '0.95rem', textAlign: 'center', minWidth: '50px', height: '40px'}}
                                                                            value={pipCounts[color].single}
                                                                            onChange={(e) => updatePipCount(color, 'single', e.target.value)}
                                                                            min="0"
                                                                        />
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(pipCounts[color].single) || 0;
                                                                                updatePipCount(color, 'single', (currentValue + 1).toString());
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            +
                                                                        </button>
                                                                    </div>
                                                                ) : (
                                                                    <input 
                                                                        type="number"
                                                                        className="small-input"
                                                                        style={{width: '100%', padding: '0.4rem', fontSize: '0.85rem'}}
                                                                        value={pipCounts[color].single}
                                                                        onChange={(e) => updatePipCount(color, 'single', e.target.value)}
                                                                        min="0"
                                                                    />
                                                                )}
                                                            </div>
                                                            <div style={{flex: '1 1 50px', minWidth: '50px', marginBottom: '0.5rem'}}>
                                                                <div style={{fontSize: '0.7rem', marginBottom: '0.3rem'}}>Double</div>
                                                                {window.innerWidth <= 768 ? (
                                                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(pipCounts[color].double) || 0;
                                                                                if (currentValue > 0) {
                                                                                    updatePipCount(color, 'double', (currentValue - 1).toString());
                                                                                }
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            ‚àí
                                                                        </button>
                                                                        <input 
                                                                            type="number"
                                                                            className="small-input"
                                                                            style={{flex: 1, padding: '0.5rem', fontSize: '0.95rem', textAlign: 'center', minWidth: '50px', height: '40px'}}
                                                                            value={pipCounts[color].double}
                                                                            onChange={(e) => updatePipCount(color, 'double', e.target.value)}
                                                                            min="0"
                                                                        />
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(pipCounts[color].double) || 0;
                                                                                updatePipCount(color, 'double', (currentValue + 1).toString());
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            +
                                                                        </button>
                                                                    </div>
                                                                ) : (
                                                                    <input 
                                                                        type="number"
                                                                        className="small-input"
                                                                        style={{width: '100%', padding: '0.4rem', fontSize: '0.85rem'}}
                                                                        value={pipCounts[color].double}
                                                                        onChange={(e) => updatePipCount(color, 'double', e.target.value)}
                                                                        min="0"
                                                                    />
                                                                )}
                                                            </div>
                                                            <div style={{flex: '1 1 50px', minWidth: '50px', marginBottom: '0.5rem'}}>
                                                                <div style={{fontSize: '0.7rem', marginBottom: '0.3rem'}}>Triple+</div>
                                                                {window.innerWidth <= 768 ? (
                                                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(pipCounts[color].triple) || 0;
                                                                                if (currentValue > 0) {
                                                                                    updatePipCount(color, 'triple', (currentValue - 1).toString());
                                                                                }
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            ‚àí
                                                                        </button>
                                                                        <input 
                                                                            type="number"
                                                                            className="small-input"
                                                                            style={{flex: 1, padding: '0.5rem', fontSize: '0.95rem', textAlign: 'center', minWidth: '50px', height: '40px'}}
                                                                            value={pipCounts[color].triple}
                                                                            onChange={(e) => updatePipCount(color, 'triple', e.target.value)}
                                                                            min="0"
                                                                        />
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(pipCounts[color].triple) || 0;
                                                                                updatePipCount(color, 'triple', (currentValue + 1).toString());
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            +
                                                                        </button>
                                                                    </div>
                                                                ) : (
                                                                    <input 
                                                                        type="number"
                                                                        className="small-input"
                                                                        style={{width: '100%', padding: '0.4rem', fontSize: '0.85rem'}}
                                                                        value={pipCounts[color].triple}
                                                                        onChange={(e) => updatePipCount(color, 'triple', e.target.value)}
                                                                        min="0"
                                                                    />
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <div style={{textAlign: 'center', marginTop: '2rem', marginBottom: '1.5rem'}}>
                                            <button 
                                                className="btn btn-primary"
                                                onClick={calculateManaBase}
                                                style={{
                                                    padding: '0.9rem 2.5rem',
                                                    fontSize: '1.1rem',
                                                    display: 'inline-flex',
                                                    alignItems: 'center',
                                                    gap: '0.7rem'
                                                }}
                                            >
                                                <span style={{fontSize: window.innerWidth <= 768 ? '1.6rem' : '1.3rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)'}}>‚öóÔ∏è</span>
                                                <span>Calculate Mana Base</span>
                                            </button>
                                        </div>


                                        {showResults && manaCalculation && (
                                            <div className="mana-results">
                                                <div style={{fontWeight: 600, fontSize: '1.2rem', marginBottom: '1rem', color: 'var(--gold)'}}>
                                                    üìä Recommended Mana Base
                                                </div>
                                                
                                                {Object.entries(manaCalculation.recommendations).map(([color, data]) => {
                                                    if (data.pips === 0) return null;
                                                    return (
                                                        <div key={color} className="result-item">
                                                            <div className="result-label">
                                                                <div className={`pip-icon pip-${color}`}></div>
                                                                <span>{data.name}</span>
                                                                <small style={{color: 'var(--text-muted)', marginLeft: '0.5rem'}}>
                                                                    ({data.pips} pips, {data.percentage}%)
                                                                </small>
                                                            </div>
                                                            <div style={{textAlign: 'right'}}>
                                                                <div className="result-value">{data.basicsNeeded}</div>
                                                                <small style={{color: 'var(--text-muted)', fontSize: '0.75rem'}}>
                                                                    basics ({data.fromDuals} from duals)
                                                                </small>
                                                            </div>
                                                        </div>
                                                    );
                                                })}

                                                <div style={{marginTop: '1rem', padding: '1rem', background: 'var(--bg-tertiary)', borderRadius: '8px'}}>
                                                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                                        <span>Total Dual Lands:</span>
                                                        <strong>{manaCalculation.totalDuals}</strong>
                                                    </div>
                                                    {manaCalculation.triLands > 0 && (
                                                        <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                                            <span>Tri-Lands (Triomes):</span>
                                                            <strong>{manaCalculation.triLands}</strong>
                                                        </div>
                                                    )}
                                                    {manaCalculation.otherLands > 0 && (
                                                        <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                                            <span>Other Lands (Colorless):</span>
                                                            <strong>{manaCalculation.otherLands}</strong>
                                                        </div>
                                                    )}
                                                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                                        <span>Total Basics Needed:</span>
                                                        <strong>{manaCalculation.totalBasicsNeeded}</strong>
                                                    </div>
                                                    {(totalLands - manaCalculation.totalOccupiedSlots - manaCalculation.totalBasicsNeeded) > 0 && (
                                                        <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                                            <span>Remaining Slots:</span>
                                                            <strong>{totalLands - manaCalculation.totalOccupiedSlots - manaCalculation.totalBasicsNeeded}</strong>
                                                            <small style={{color: 'var(--text-muted)', marginLeft: '0.5rem'}}>(utility)</small>
                                                        </div>
                                                    )}
                                                    <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                                        <span>Target Land Count:</span>
                                                        <strong>{totalLands}</strong>
                                                    </div>
                                                    <div style={{display: 'flex', justifyContent: 'space-between', marginTop: '0.5rem', paddingTop: '0.5rem', borderTop: '1px solid var(--border-color)'}}>
                                                        <span>Spells Needed for 100:</span>
                                                        <strong style={{color: 'var(--accent-bright)'}}>{100 - totalLands}</strong>
                                                    </div>
                                                    {!manaCalculation.isValid && (
                                                        <div style={{marginTop: '1rem', padding: '0.8rem', background: 'rgba(211, 32, 42, 0.2)', borderRadius: '6px', color: 'var(--red-mana)'}}>
                                                            ‚ö†Ô∏è Warning: You need {manaCalculation.totalBasicsNeeded} basics but only have {manaCalculation.availableForBasics} slots available after all lands!
                                                            <div style={{marginTop: '0.8rem', fontSize: '0.85rem', color: 'var(--text-primary)', background: 'rgba(0, 0, 0, 0.3)', padding: '0.8rem', borderRadius: '4px'}}>
                                                                <strong>Quick Fixes:</strong>
                                                                <div style={{marginTop: '0.5rem', lineHeight: '1.8'}}>
                                                                    ‚Ä¢ Increase total lands to <strong>{totalLands + (manaCalculation.totalBasicsNeeded - manaCalculation.availableForBasics)}</strong> lands<br/>
                                                                    ‚Ä¢ Remove <strong>{manaCalculation.totalBasicsNeeded - manaCalculation.availableForBasics}</strong> colorless/utility lands<br/>
                                                                    ‚Ä¢ Add more dual lands (reduces basics needed)
                                                                </div>
                                                            </div>
                                                        </div>
                                                    )}
                                                    {manaCalculation.isValid && (
                                                        <div style={{marginTop: '1rem', padding: '0.8rem', background: 'rgba(0, 115, 62, 0.2)', borderRadius: '6px', color: 'var(--green-mana)'}}>
                                                            ‚úì Perfect! You have enough land slots for your color requirements.
                                                        </div>
                                                    )}
                                                </div>

                                                {/* Funny Random Quote */}
                                                {randomQuote && (
                                                    <div style={{
                                                        marginTop: '1.5rem',
                                                        padding: '1rem',
                                                        background: 'linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(196, 167, 125, 0.15) 100%)',
                                                        border: '2px solid var(--gold)',
                                                        borderRadius: '10px',
                                                        textAlign: 'center',
                                                        fontSize: '1rem',
                                                        fontStyle: 'italic',
                                                        color: 'var(--text-primary)',
                                                        fontWeight: 500
                                                    }}>
                                                        "{randomQuote}"
                                                    </div>
                                                )}
                                            </div>
                                        )}

                                        {!showResults && (
                                            <div style={{textAlign: 'center', padding: '2rem', color: 'var(--text-muted)'}}>
                                                Fill in your mana requirements above, then click "Calculate Mana Base"!
                                            </div>
                                        )}
                                    </div>
                                    )}
                                </div>

                                <div style={{textAlign: 'center', marginTop: '2rem'}}>
                                    <button 
                                        className="btn btn-primary" 
                                        style={{padding: '1rem 3rem', fontSize: '1.1rem'}}
                                        onClick={() => {
                                            setHasUnsavedChanges(false);
                                            onSave({
                                                ...deckData, 
                                                notableCards,
                                                sideboard: sideboardCategories,
                                                lands: totals.lands,
                                                creatures: totals.creatures,
                                                noncreature: totals.noncreature
                                            });
                                        }}
                                    >
                                        Save Deck
                                    </button>
                                </div>
                            </div>

                            <div className="stats-panel">
                                <div 
                                    style={{
                                        display: 'flex', 
                                        justifyContent: 'space-between', 
                                        alignItems: 'center', 
                                        marginBottom: '1rem', 
                                        cursor: window.innerWidth <= 768 ? 'pointer' : 'default', 
                                        padding: window.innerWidth <= 768 ? '1.5rem' : '0', 
                                        background: window.innerWidth <= 768 ? 'linear-gradient(135deg, rgba(212, 175, 55, 0.25) 0%, rgba(139, 111, 71, 0.15) 100%)' : 'transparent', 
                                        borderRadius: '12px',
                                        border: window.innerWidth <= 768 ? '3px solid var(--gold)' : 'none',
                                        boxShadow: window.innerWidth <= 768 ? '0 4px 12px rgba(212, 175, 55, 0.3)' : 'none',
                                        transition: 'all 0.2s ease'
                                    }} 
                                    onClick={() => window.innerWidth <= 768 && setStatsExpanded(!statsExpanded)}
                                    onTouchStart={(e) => {
                                        if (window.innerWidth <= 768) {
                                            e.currentTarget.style.transform = 'scale(0.98)';
                                        }
                                    }}
                                    onTouchEnd={(e) => {
                                        if (window.innerWidth <= 768) {
                                            e.currentTarget.style.transform = 'scale(1)';
                                        }
                                    }}
                                >
                                    <h3 style={{fontFamily: 'Pirata One, cursive', color: 'var(--gold)', margin: 0, fontSize: window.innerWidth <= 768 ? '1.6rem' : '1.3rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)'}}>
                                        üìä Live Deck Stats {window.innerWidth <= 768 && `(${statsExpanded ? 'Tap to Hide' : 'Tap to View'})`}
                                    </h3>
                                    {window.innerWidth <= 768 && (
                                        <span style={{fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)', color: 'var(--gold)', transition: 'transform 0.3s', transform: statsExpanded ? 'rotate(180deg)' : 'rotate(0deg)'}}>‚ñ≤</span>
                                    )}
                                </div>
                                {(window.innerWidth > 768 || statsExpanded) && (
                                <div style={{
                                    maxHeight: window.innerWidth <= 768 ? '60vh' : 'none',
                                    overflowY: window.innerWidth <= 768 ? 'auto' : 'visible',
                                    padding: window.innerWidth <= 768 ? '0.5rem' : '0'
                                }}>

                                <div style={{background: 'var(--bg-tertiary)', padding: '1rem', borderRadius: '12px', marginBottom: '1rem'}}>
                                    <div style={{fontWeight: 600, marginBottom: '0.5rem'}}>üèû Lands</div>
                                    <div style={{fontSize: '2rem', fontWeight: 700, color: 'var(--accent-bright)'}}>{totals.lands}</div>
                                </div>

                                <div style={{background: 'var(--bg-tertiary)', padding: '1rem', borderRadius: '12px', marginBottom: '1rem'}}>
                                    <div style={{fontWeight: 600, marginBottom: '0.5rem'}}>üßü Creatures</div>
                                    <div style={{fontSize: '2rem', fontWeight: 700, color: 'var(--accent-bright)'}}>{totals.creatures}</div>
                                </div>

                                <div style={{background: 'var(--bg-tertiary)', padding: '1rem', borderRadius: '12px', marginBottom: '1rem'}}>
                                    <div style={{fontWeight: 600, marginBottom: '0.5rem'}}>‚ö° Non-Creature</div>
                                    <div style={{fontSize: '2rem', fontWeight: 700, color: 'var(--accent-bright)'}}>{totals.noncreature}</div>
                                </div>

                                {/* Quick Totals (Category-level) */}
                                <div style={{background: 'var(--bg-secondary)', padding: '1rem', borderRadius: '12px', marginBottom: '1rem', border: '1px solid rgba(212, 175, 55, 0.5)'}}>
                                    <div style={{fontWeight: 600, marginBottom: '1rem', color: 'var(--gold)', fontSize: '0.9rem'}}>‚ö° Quick Totals</div>
                                    
                                    {Object.entries(DECK_CATEGORIES).map(([majorGroupId, majorGroup]) => {
                                        const quickCounts = [];
                                        
                                        // Major quick total
                                        const majorQuick = deckData.categories[`${majorGroupId}-quick`] || 0;
                                        if (majorQuick > 0) {
                                            quickCounts.push({ name: `Total ${majorGroup.name.replace(/[üèûüßü‚ö°]/g, '').trim()}`, count: majorQuick });
                                        }
                                        
                                        // Category group quick totals + detailed subtypes
                                        majorGroup.categories.forEach(category => {
                                            const catQuick = deckData.categories[`${category.id}-quick`] || 0;
                                            
                                            // Calculate detailed subtypes total for this category
                                            const catDetailed = category.subcategories.reduce((sum, sub) => {
                                                return sum + (deckData.categories[sub.id] || 0);
                                            }, 0);
                                            
                                            const catTotal = catQuick + catDetailed;
                                            
                                            if (catTotal > 0) {
                                                quickCounts.push({ 
                                                    name: category.name, 
                                                    count: catTotal,
                                                    quick: catQuick,
                                                    detailed: catDetailed
                                                });
                                            }
                                        });
                                        
                                        if (quickCounts.length === 0) return null;
                                        
                                        return (
                                            <div key={majorGroupId} style={{marginBottom: '1rem'}}>
                                                <div style={{fontSize: '0.75rem', color: 'var(--text-muted)', marginBottom: '0.5rem', textTransform: 'uppercase'}}>
                                                    {majorGroup.icon} {majorGroup.name.replace(/[üèûüßü‚ö°]/g, '').trim()}
                                                </div>
                                                <div style={{fontSize: '0.85rem', lineHeight: '1.8', color: 'var(--text-secondary)'}}>
                                                    {quickCounts.map((item, idx) => (
                                                        <div key={idx} style={{marginBottom: '0.5rem'}}>
                                                            <div style={{display: 'flex', justifyContent: 'space-between', padding: '0.3rem 0.5rem', background: 'rgba(212, 175, 55, 0.1)', borderRadius: '4px'}}>
                                                                <span>{item.name}</span>
                                                                <strong style={{color: 'var(--gold)'}}>{item.count}</strong>
                                                            </div>
                                                            {(item.quick > 0 || item.detailed > 0) && (item.quick > 0 && item.detailed > 0) && (
                                                                <div style={{fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '0.2rem', marginLeft: '0.5rem', fontStyle: 'italic'}}>
                                                                    (Quick: {item.quick} + Detailed: {item.detailed})
                                                                </div>
                                                            )}
                                                            {item.quick > 0 && item.detailed === 0 && (
                                                                <div style={{fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '0.2rem', marginLeft: '0.5rem', fontStyle: 'italic'}}>
                                                                    (Quick input only)
                                                                </div>
                                                            )}
                                                            {item.quick === 0 && item.detailed > 0 && (
                                                                <div style={{fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '0.2rem', marginLeft: '0.5rem', fontStyle: 'italic'}}>
                                                                    (From detailed subtypes)
                                                                </div>
                                                            )}
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })}
                                    
                                    {!Object.keys(deckData.categories).some(key => key.includes('-quick') && deckData.categories[key] > 0) && (
                                        <div style={{textAlign: 'center', color: 'var(--text-muted)', fontSize: '0.85rem', padding: '1rem'}}>
                                            No quick totals entered yet
                                        </div>
                                    )}
                                </div>

                                {/* Detailed Subtypes */}
                                <div style={{background: 'var(--bg-secondary)', padding: '1rem', borderRadius: '12px', marginBottom: '1rem', border: '1px solid var(--border-color)'}}>
                                    <div style={{fontWeight: 600, marginBottom: '1rem', color: 'var(--accent-bright)', fontSize: '0.9rem'}}>üìä Key Subtypes</div>
                                    
                                    {Object.entries(DECK_CATEGORIES).map(([majorGroupId, majorGroup]) => {
                                        const subtypeCounts = [];
                                        majorGroup.categories.forEach(category => {
                                            category.subcategories.forEach(sub => {
                                                const count = deckData.categories[sub.id] || 0;
                                                if (count > 0) {
                                                    subtypeCounts.push({ name: sub.name, count });
                                                }
                                            });
                                        });
                                        
                                        if (subtypeCounts.length === 0) return null;
                                        
                                        return (
                                            <div key={majorGroupId} style={{marginBottom: '1rem'}}>
                                                <div style={{fontSize: '0.75rem', color: 'var(--text-muted)', marginBottom: '0.5rem', textTransform: 'uppercase'}}>
                                                    {majorGroup.icon} {majorGroup.name.replace(/[üèûüßü‚ö°]/g, '').trim()}
                                                </div>
                                                <div style={{fontSize: '0.85rem', lineHeight: '1.8', color: 'var(--text-secondary)'}}>
                                                    {subtypeCounts.slice(0, 5).map((item, idx) => (
                                                        <div key={idx} style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.3rem'}}>
                                                            <span>{item.name}</span>
                                                            <strong style={{color: 'var(--accent-bright)'}}>{item.count}</strong>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })}
                                    
                                    {!Object.entries(DECK_CATEGORIES).some(([majorGroupId, majorGroup]) => {
                                        return majorGroup.categories.some(category => {
                                            return category.subcategories.some(sub => (deckData.categories[sub.id] || 0) > 0);
                                        });
                                    }) && (
                                        <div style={{textAlign: 'center', color: 'var(--text-muted)', fontSize: '0.85rem', padding: '1rem'}}>
                                            No detailed subtypes entered yet
                                        </div>
                                    )}
                                </div>

                                {/* Sideboard Totals */}
                                {sideboardTotals.total > 0 && (
                                    <div style={{background: 'var(--bg-secondary)', padding: '1rem', borderRadius: '12px', marginBottom: '1rem', border: '2px solid rgba(139, 69, 19, 0.7)'}}>
                                        <div style={{fontWeight: 700, marginBottom: '1rem', color: 'var(--accent-bright)', fontSize: '1rem'}}>üì¶ Sideboard (Total: {sideboardTotals.total})</div>
                                        <div style={{display: 'flex', flexDirection: 'column', gap: '0.5rem', fontSize: '0.9rem'}}>
                                            <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                                <span>üßü Creatures:</span>
                                                <span style={{fontWeight: 600, color: 'var(--accent-bright)'}}>{sideboardTotals.creatures}</span>
                                            </div>
                                            <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                                <span>‚ö° Non-Creature:</span>
                                                <span style={{fontWeight: 600, color: 'var(--accent-bright)'}}>{sideboardTotals.noncreature}</span>
                                            </div>
                                            <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                                <span>üåç Lands:</span>
                                                <span style={{fontWeight: 600, color: 'var(--accent-bright)'}}>{sideboardTotals.lands}</span>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                <div style={{
                                    background: 'var(--gradient-card)', 
                                    border: `2px solid ${totals.total === 100 ? 'var(--green-mana)' : totals.total > 100 ? 'var(--red-mana)' : 'var(--border-color)'}`,
                                    borderRadius: '12px',
                                    padding: '1.5rem',
                                    textAlign: 'center',
                                    marginTop: '1.5rem'
                                }}>
                                    <div style={{fontSize: '0.9rem', marginBottom: '0.5rem', color: 'var(--text-secondary)'}}>
                                        Total Cards
                                    </div>
                                    <div style={{
                                        fontSize: '3rem',
                                        fontWeight: 700,
                                        color: totals.total === 100 ? 'var(--green-mana)' : totals.total > 100 ? 'var(--red-mana)' : 'var(--accent-bright)'
                                    }}>
                                        {totals.total} / 100
                                    </div>
                                    {totals.total === 100 && (
                                        <div style={{marginTop: '0.5rem', color: 'var(--green-mana)'}}>‚úì Perfect!</div>
                                    )}
                                    {totals.total > 100 && (
                                        <div style={{marginTop: '0.5rem', color: 'var(--red-mana)'}}>‚ö† {totals.total - 100} over</div>
                                    )}
                                    {totals.total < 100 && totals.total > 0 && (
                                        <div style={{marginTop: '0.5rem', color: 'var(--text-muted)'}}>{100 - totals.total} remaining</div>
                                    )}
                                </div>
                            </div>)}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function EditDeckModal({ deck, onClose, onSave, user = null, setShowAuthModal = null }) {
            
            const [deckData, setDeckData] = useState({
                id: deck?.id,  // CRITICAL: Preserve the deck ID for updates!
                name: deck?.name || '',
                commander: deck?.commander || '',
                secondCommander: deck?.secondCommander || '',
                hasSecondCommander: deck?.hasSecondCommander || false,
                colors: deck?.colors || [],
                categories: deck?.categories || {},
                isPublic: deck?.isPublic !== undefined ? deck.isPublic : true
            });
            const [commanderCard, setCommanderCard] = useState(null);
            const [loadingCommander, setLoadingCommander] = useState(false);
            const [secondCommanderCard, setSecondCommanderCard] = useState(null);
            const [loadingSecondCommander, setLoadingSecondCommander] = useState(false);
            const [notableCards, setNotableCards] = useState(deck?.notableCards || []);
            const [cardInput, setCardInput] = useState('');
            const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);
            
            // Mana calculator state
            const [pipCounts, setPipCounts] = useState({
                W: { single: 0, double: 0, triple: 0 },
                U: { single: 0, double: 0, triple: 0 },
                B: { single: 0, double: 0, triple: 0 },
                R: { single: 0, double: 0, triple: 0 },
                G: { single: 0, double: 0, triple: 0 }
            });
            const [dualLands, setDualLands] = useState({
                WU: 0, WB: 0, WR: 0, WG: 0,
                UB: 0, UR: 0, UG: 0,
                BR: 0, BG: 0,
                RG: 0
            });
            const [totalLands, setTotalLands] = useState(38);
            const [triLands, setTriLands] = useState(0);
            const [otherLands, setOtherLands] = useState(0);
            const [showResults, setShowResults] = useState(false);
            const [manaCalculation, setManaCalculation] = useState(null);
            const [randomQuote, setRandomQuote] = useState('');
            
            // Sideboard state
            const [sideboardOpen, setSideboardOpen] = useState(false);
            const [sideboardCategories, setSideboardCategories] = useState(deck?.sideboard || {});
            const [sideboardQuickInputs, setSideboardQuickInputs] = useState({});
            
            // Mana calculator collapse state
            const [manaCalcOpen, setManaCalcOpen] = useState(false);
            
            
            // Category section collapse states
            const [categoryOpen, setCategoryOpen] = useState({
                creatures: true,
                noncreature: false,
                lands: false
            });
            const [statsExpanded, setStatsExpanded] = useState(true);

            useEffect(() => {
                const initialCategories = {};
                const initialSideboard = {};
                Object.values(DECK_CATEGORIES).forEach(majorGroup => {
                    majorGroup.categories.forEach(cat => {
                        cat.subcategories.forEach(sub => {
                            initialCategories[sub.id] = sub.defaultValue;
                            initialSideboard[sub.id] = 0; // Sideboard starts at 0
                        });
                    });
                });
                
                // Don't overwrite sideboard - it's already loaded from deck prop!
                // setSideboardCategories is initialized from deck?.sideboard in state
            }, []);

            // Fetch commander card when name changes
            useEffect(() => {
                const fetchCommander = async () => {
                    if (deckData.commander.length > 3) {
                        setLoadingCommander(true);
                        const card = await fetchCardFromScryfall(deckData.commander);
                        setCommanderCard(card);
                        setLoadingCommander(false);
                    }
                };
                const timeoutId = setTimeout(fetchCommander, 500);
                return () => clearTimeout(timeoutId);
            }, [deckData.commander]);

            // Sideboard functions
            const updateSideboardCategory = (categoryId, value) => {
                setSideboardCategories(prev => ({
                    ...prev,
                    [categoryId]: parseInt(value) || 0
                }));
            };

            const sideboardTotals = useMemo(() => {
                const getCategoryKeys = (majorGroupId) => {
                    const keys = [];
                    DECK_CATEGORIES[majorGroupId].categories.forEach(cat => {
                        cat.subcategories.forEach(sub => keys.push(sub.id));
                    });
                    return keys;
                };

                // Calculate detailed totals from sideboard subcategories
                const lands = getCategoryKeys('lands')
                    .reduce((sum, key) => sum + (sideboardCategories[key] || 0), 0);
                const creatures = getCategoryKeys('creatures')
                    .reduce((sum, key) => sum + (sideboardCategories[key] || 0), 0);
                const noncreature = getCategoryKeys('noncreature')
                    .reduce((sum, key) => sum + (sideboardCategories[key] || 0), 0);
                
                const total = lands + creatures + noncreature;

                return { lands, creatures, noncreature, total };
            }, [sideboardCategories]);

            // Calculate totals
            const totals = useMemo(() => {
                const getCategoryKeys = (majorGroupId) => {
                    const keys = [];
                    DECK_CATEGORIES[majorGroupId].categories.forEach(cat => {
                        cat.subcategories.forEach(sub => keys.push(sub.id));
                    });
                    return keys;
                };

                // Get quick totals for major categories
                const landsQuick = deckData.categories['lands-quick'] || 0;
                const creaturesQuick = deckData.categories['creatures-quick'] || 0;
                const noncreatureQuick = deckData.categories['noncreature-quick'] || 0;

                // Get category group quick totals
                const getCategoryGroupQuick = (majorGroupId) => {
                    let total = 0;
                    DECK_CATEGORIES[majorGroupId].categories.forEach(cat => {
                        total += deckData.categories[`${cat.id}-quick`] || 0;
                    });
                    return total;
                };

                // Get detailed totals from subcategories
                const landsDetailed = getCategoryKeys('lands')
                    .reduce((sum, key) => sum + (deckData.categories[key] || 0), 0);
                const creaturesDetailed = getCategoryKeys('creatures')
                    .reduce((sum, key) => sum + (deckData.categories[key] || 0), 0);
                const noncreatureDetailed = getCategoryKeys('noncreature')
                    .reduce((sum, key) => sum + (deckData.categories[key] || 0), 0);

                // Add category group quick totals
                const landsGroupQuick = getCategoryGroupQuick('lands');
                const creaturesGroupQuick = getCategoryGroupQuick('creatures');
                const noncreatureGroupQuick = getCategoryGroupQuick('noncreature');

                // Total = quick major + quick groups + detailed
                const lands = landsQuick + landsGroupQuick + landsDetailed;
                const creatures = creaturesQuick + creaturesGroupQuick + creaturesDetailed;
                const noncreature = noncreatureQuick + noncreatureGroupQuick + noncreatureDetailed;
                
                const nonLandCards = creatures + noncreature;
                
                // Add commander count (1 or 2)
                const commanderCount = deckData.commander ? (deckData.hasSecondCommander && deckData.secondCommander ? 2 : 1) : 0;
                const total = lands + nonLandCards + commanderCount;

                return { lands, creatures, noncreature, nonLandCards, total, commanderCount };
            }, [deckData.categories, deckData.commander, deckData.hasSecondCommander, deckData.secondCommander]);

            // Mana base calculator
            const calculateManaBase = () => {
                const colors = ['W', 'U', 'B', 'R', 'G'];
                const colorNames = {W: 'White', U: 'Blue', B: 'Black', R: 'Red', G: 'Green'};
                
                // Calculate total pips
                const totalPips = {};
                let grandTotal = 0;
                
                colors.forEach(color => {
                    const pips = pipCounts[color];
                    const total = pips.single + (pips.double * 2) + (pips.triple * 3);
                    totalPips[color] = total;
                    grandTotal += total;
                });

                if (grandTotal === 0) {
                    alert('Please enter at least one mana pip to calculate your mana base.');
                    return;
                }

                // Calculate percentages and recommended sources
                const recommendations = {};
                const totalDualLands = Object.values(dualLands).reduce((a, b) => a + b, 0);
                const totalMultiLands = totalDualLands + triLands;
                const totalOccupiedSlots = totalMultiLands + otherLands;
                const availableForBasics = totalLands - totalOccupiedSlots;

                colors.forEach(color => {
                    const percentage = (totalPips[color] / grandTotal) * 100;
                    const rawSources = (totalPips[color] / grandTotal) * totalLands;
                    
                    // Count dual lands that produce this color
                    let dualContribution = 0;
                    Object.entries(dualLands).forEach(([pair, count]) => {
                        if (pair.includes(color)) {
                            dualContribution += count;
                        }
                    });

                    const neededBasics = Math.max(0, Math.round(rawSources - dualContribution));
                    
                    recommendations[color] = {
                        pips: totalPips[color],
                        percentage: percentage.toFixed(1),
                        totalSources: Math.round(rawSources),
                        fromDuals: dualContribution,
                        basicsNeeded: neededBasics,
                        name: colorNames[color]
                    };
                });

                const totalBasicsNeeded = Object.values(recommendations)
                    .reduce((sum, rec) => sum + rec.basicsNeeded, 0);

                const result = {
                    recommendations,
                    totalPips: grandTotal,
                    totalDuals: totalDualLands,
                    triLands: triLands,
                    otherLands: otherLands,
                    totalMultiLands: totalMultiLands,
                    totalOccupiedSlots: totalOccupiedSlots,
                    totalBasicsNeeded,
                    availableForBasics,
                    isValid: totalBasicsNeeded <= availableForBasics
                };

                // Pick a random funny quote
                const randomIndex = Math.floor(Math.random() * FUNNY_MANA_QUOTES.length);
                setRandomQuote(FUNNY_MANA_QUOTES[randomIndex]);

                setManaCalculation(result);
                setShowResults(true);
            };

            const updatePipCount = (color, type, value) => {
                setPipCounts(prev => ({
                    ...prev,
                    [color]: {
                        ...prev[color],
                        [type]: parseInt(value) || 0
                    }
                }));
            };

            const updateDualLands = (pair, value) => {
                setDualLands(prev => ({
                    ...prev,
                    [pair]: parseInt(value) || 0
                }));
            };

            const addNotableCard = async (cardName) => {
                const nameToAdd = cardName || cardInput.trim();
                if (!nameToAdd) return;
                const cardData = await fetchCardFromScryfall(nameToAdd);
                if (cardData) {
                    setNotableCards([...notableCards, {
                        name: cardData.name,
                        imageUrl: cardData.image_uris?.normal || cardData.image_uris?.large,
                        typeLine: cardData.type_line
                    }]);
                    setCardInput('');
                }
            };

            const toggleColor = (color) => {
                setDeckData(prev => ({
                    ...prev,
                    colors: prev.colors.includes(color) 
                        ? prev.colors.filter(c => c !== color)
                        : [...prev.colors, color]
                }));
            };

            const colorPairs = [
                {pair: 'WU', colors: ['W', 'U'], name: 'Azorius'},
                {pair: 'WB', colors: ['W', 'B'], name: 'Orzhov'},
                {pair: 'WR', colors: ['W', 'R'], name: 'Boros'},
                {pair: 'WG', colors: ['W', 'G'], name: 'Selesnya'},
                {pair: 'UB', colors: ['U', 'B'], name: 'Dimir'},
                {pair: 'UR', colors: ['U', 'R'], name: 'Izzet'},
                {pair: 'UG', colors: ['U', 'G'], name: 'Simic'},
                {pair: 'BR', colors: ['B', 'R'], name: 'Rakdos'},
                {pair: 'BG', colors: ['B', 'G'], name: 'Golgari'},
                {pair: 'RG', colors: ['R', 'G'], name: 'Gruul'}
            ];

            // Check if user has unsaved changes
            useEffect(() => {
                if (deckData.name || deckData.commander || deckData.colors.length > 0 || Object.keys(deckData.categories).length > 0) {
                    setHasUnsavedChanges(true);
                }
            }, [deckData]);

            // Handle close with unsaved changes warning
            const handleClose = () => {
                if (hasUnsavedChanges) {
                    if (!user) {
                        // Not logged in - offer to login/create account
                        const wantsToSave = window.confirm('Your deck might be lost! Would you like to login or create an account to save it?');
                        if (wantsToSave && setShowAuthModal) {
                            setShowAuthModal(true);
                            // Don't close the modal so they can save after logging in
                        } else {
                            onClose();
                        }
                    } else {
                        // Logged in - just confirm
                        if (window.confirm('Your deck might be lost! Are you sure you want to leave without saving?')) {
                            onClose();
                        }
                    }
                } else {
                    onClose();
                }
            };

            return (
                <div className="modal-overlay" >
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <h2 className="modal-title">
                                {user && deck && user.uid === deck.userId ? '‚úèÔ∏è Edit Deck' : 'üëÅÔ∏è View Deck'}
                            </h2>
                            <button className="close-btn" onClick={handleClose}>√ó</button>
                        </div>

                        <div className="modal-content-wrapper">
                            <div className="modal-body">
                                {/* Privacy Toggle Section - only show if user owns this deck */}
                                {user && deck && user.uid === deck.userId && (
                                <div style={{
                                    background: 'linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(139, 111, 71, 0.1) 100%)',
                                    border: '2px solid var(--gold)',
                                    borderRadius: '12px',
                                    padding: '1.25rem',
                                    marginBottom: '1.5rem'
                                }}>
                                    <div style={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'space-between',
                                        marginBottom: '0.75rem'
                                    }}>
                                        <div style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.5rem',
                                            fontWeight: 600,
                                            color: 'var(--gold)',
                                            fontSize: '1.15rem'
                                        }}>
                                            <span>üåü</span>
                                            <span>Help others brew epic decks - share yours!</span>
                                        </div>
                                        <label style={{
                                            position: 'relative',
                                            display: 'inline-block',
                                            width: '60px',
                                            height: '34px',
                                            cursor: 'pointer'
                                        }}>
                                            <input
                                                type="checkbox"
                                                checked={deckData.isPublic}
                                                onChange={(e) => setDeckData({...deckData, isPublic: e.target.checked})}
                                                style={{opacity: 0, width: 0, height: 0}}
                                            />
                                            <span style={{
                                                position: 'absolute',
                                                top: 0,
                                                left: 0,
                                                right: 0,
                                                bottom: 0,
                                                background: deckData.isPublic ? 'var(--gold)' : 'var(--bg-tertiary)',
                                                borderRadius: '34px',
                                                transition: '0.3s',
                                                border: '2px solid ' + (deckData.isPublic ? 'var(--gold)' : 'var(--border-color)')
                                            }}>
                                                <span style={{
                                                    position: 'absolute',
                                                    content: '',
                                                    height: '26px',
                                                    width: '26px',
                                                    left: deckData.isPublic ? '30px' : '4px',
                                                    bottom: '2px',
                                                    background: 'white',
                                                    borderRadius: '50%',
                                                    transition: '0.3s'
                                                }}></span>
                                            </span>
                                        </label>
                                    </div>
                                    <div style={{
                                        fontSize: '1.15rem',
                                        color: 'var(--text-secondary)',
                                        lineHeight: '1.6',
                                        marginTop: '0.5rem'
                                    }}>
                                        {deckData.isPublic ? (
                                            <span>
                                                ‚ú® <strong style={{color: 'var(--gold)'}}>Deck is public!</strong> Inspire other commanders! üî•
                                            </span>
                                        ) : (
                                            <span>
                                                üîí <strong>Private deck.</strong> Share your tech with the community! üéØ
                                            </span>
                                        )}
                                    </div>
                                </div>
                                )}
                                <div style={{marginBottom: '1.5rem'}}>
                                    <label style={{display: 'block', marginBottom: '0.5rem', color: 'var(--text-secondary)', fontWeight: 500}}>
                                        Deck Name
                                    </label>
                                    <input 
                                        type="text" 
                                        className="form-input" 
                                        placeholder="My Amazing Commander Deck"
                                        value={deckData.name}
                                        onChange={(e) => setDeckData({...deckData, name: e.target.value})}
                                    />
                                </div>

                                <div style={{marginBottom: '1.5rem'}}>
                                    <label style={{display: 'block', marginBottom: '0.5rem', color: 'var(--text-secondary)', fontWeight: 500}}>
                                        Commander(s)
                                    </label>
                                    <div style={{display: 'flex', gap: '0.5rem'}}>
                                        <CardAutocomplete
                                            value={deckData.commander}
                                            onChange={(val) => setDeckData({...deckData, commander: val})}
                                            placeholder="e.g., Atraxa, Praetors' Voice or Kozilek, Butcher of Truth"
                                        />
                                        <button 
                                            className="btn btn-secondary" 
                                            onClick={async () => {
                                                if (deckData.commander.length > 3) {
                                                    setLoadingCommander(true);
                                                    const card = await fetchCardFromScryfall(deckData.commander);
                                                    setCommanderCard(card);
                                                    setLoadingCommander(false);
                                                }
                                            }}
                                        >
                                            Add
                                        </button>
                                    </div>
                                    {loadingCommander && (
                                        <div style={{textAlign: 'center', marginTop: '1rem', color: 'var(--text-muted)'}}>
                                            Loading commander...
                                        </div>
                                    )}
                                    {commanderCard && (
                                        <div className="commander-preview">
                                            <img 
                                                src={commanderCard.image_uris?.normal || commanderCard.image_uris?.large}
                                                alt={commanderCard.name}
                                                className="commander-card-image"
                                            />
                                        </div>
                                    )}
                                </div>

                                {/* Second Commander Checkbox */}
                                <div style={{marginBottom: '1rem'}}>
                                    <label style={{display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer', color: 'var(--text-secondary)'}}>
                                        <input 
                                            type="checkbox"
                                            checked={deckData.hasSecondCommander}
                                            onChange={(e) => {
                                                setDeckData({
                                                    ...deckData, 
                                                    hasSecondCommander: e.target.checked,
                                                    secondCommander: e.target.checked ? deckData.secondCommander : ''
                                                });
                                                if (!e.target.checked) {
                                                    setSecondCommanderCard(null);
                                                }
                                            }}
                                            style={{width: '18px', height: '18px', cursor: 'pointer'}}
                                        />
                                        <span>Add Second Commander (Partner/Background/Companion)</span>
                                    </label>
                                </div>

                                {/* Second Commander Input */}
                                {deckData.hasSecondCommander && (
                                    <div style={{marginBottom: '1.5rem'}}>
                                        <label style={{display: 'block', marginBottom: '0.5rem', color: 'var(--text-secondary)', fontWeight: 500}}>
                                            Second Commander
                                        </label>
                                        <div style={{display: 'flex', gap: '0.5rem'}}>
                                            <CardAutocomplete
                                                value={deckData.secondCommander}
                                                onChange={(val) => setDeckData({...deckData, secondCommander: val})}
                                                placeholder="e.g., Partner commander or Background"
                                            />
                                            <button 
                                                className="btn btn-secondary" 
                                                onClick={async () => {
                                                    if (deckData.secondCommander.length > 3) {
                                                        setLoadingSecondCommander(true);
                                                        const card = await fetchCardFromScryfall(deckData.secondCommander);
                                                        setSecondCommanderCard(card);
                                                        setLoadingSecondCommander(false);
                                                    }
                                                }}
                                            >
                                                Add
                                            </button>
                                        </div>
                                        {loadingSecondCommander && (
                                            <div style={{textAlign: 'center', marginTop: '1rem', color: 'var(--text-muted)'}}>
                                                Loading second commander...
                                            </div>
                                        )}
                                        {secondCommanderCard && (
                                            <div className="commander-preview">
                                                <img 
                                                    src={secondCommanderCard.image_uris?.normal || secondCommanderCard.image_uris?.large}
                                                    alt={secondCommanderCard.name}
                                                    className="commander-card-image"
                                                />
                                            </div>
                                        )}
                                    </div>
                                )}

                                <div style={{marginBottom: '1.5rem'}}>
                                    <label style={{display: 'block', marginBottom: '0.5rem', color: 'var(--text-secondary)', fontWeight: 500}}>
                                        Color Identity
                                    </label>
                                    <div className="color-picker">
                                        {[
                                            { color: 'W', name: 'White' },
                                            { color: 'U', name: 'Blue' },
                                            { color: 'B', name: 'Black' },
                                            { color: 'R', name: 'Red' },
                                            { color: 'G', name: 'Green' },
                                            { color: 'C', name: 'Colorless' }
                                        ].map(({ color, name }) => (
                                            <div 
                                                key={color}
                                                className={`color-option pip-${color} ${deckData.colors.includes(color) ? 'selected' : ''}`}
                                                onClick={() => toggleColor(color)}
                                                title={name}
                                                style={{position: 'relative'}}
                                            ></div>
                                        ))}
                                    </div>

                                <div style={{marginBottom: '1.5rem'}}>
                                    <label style={{display: 'block', marginBottom: '0.5rem', color: 'var(--text-secondary)', fontWeight: 500}}>
                                        Game Plan <span style={{fontSize: '0.85rem', color: 'var(--text-muted)', fontWeight: 400}}>(Optional)</span>
                                    </label>
                                    <textarea 
                                        className="form-input" 
                                        placeholder="e.g., Ramp early, play big creatures, draw cards, control the board..."
                                        value={deckData.gamePlan || ''}
                                        onChange={(e) => setDeckData({...deckData, gamePlan: e.target.value})}
                                        rows="3"
                                        style={{
                                            width: '100%',
                                            resize: 'vertical',
                                            minHeight: '80px',
                                            fontFamily: 'inherit'
                                        }}
                                    />
                                    <small style={{color: 'var(--text-muted)', fontSize: '0.8rem', display: 'block', marginTop: '0.3rem'}}>
                                        A brief summary of what this deck is trying to do
                                    </small>
                                </div>
                                </div>

                                <div style={{marginBottom: '1.5rem'}}>
                                    <label style={{display: 'block', marginBottom: '0.5rem', color: 'var(--text-secondary)', fontWeight: 500}}>
                                        Notable Cards / Win Conditions
                                    </label>
                                    <div style={{display: 'flex', gap: '0.5rem', marginTop: '1rem'}}>
                                        <CardAutocomplete
                                            value={cardInput}
                                            onChange={setCardInput}
                                            placeholder="e.g., Sol Ring, Craterhoof Behemoth..."
                                            onSelect={(cardName) => addNotableCard(cardName)}
                                        />
                                        <button className="btn btn-secondary" onClick={addNotableCard}>Add</button>
                                    </div>

                                    {notableCards.length > 0 && (
                                        <div className="notable-card-list">
                                            {notableCards.map((card, idx) => (
                                                <div key={idx} className="card-preview">
                                                    <button className="card-remove" onClick={() => setNotableCards(notableCards.filter((_, i) => i !== idx))}>
                                                        √ó
                                                    </button>
                                                    {card.imageUrl && (
                                                        <img src={card.imageUrl} alt={card.name} className="card-preview-image" />
                                                    )}
                                                    <div style={{fontWeight: 600, fontSize: '0.9rem', marginTop: '0.5rem'}}>{card.name}</div>
                                                    <div style={{fontSize: '0.75rem', color: 'var(--text-muted)'}}>{card.typeLine}</div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* FULL CATEGORY SYSTEM - REORDERED & QUICK ENTRY */}
                                <div style={{marginBottom: '2rem'}}>
                                    <h3 style={{
                                        color: 'var(--accent-bright)',
                                        marginBottom: '1rem',
                                        fontSize: '1.2rem',
                                        fontWeight: 600
                                    }}>
                                        üìä Deck Categories
                                    </h3>
                                    
                                    {/* REORDERED: Creatures, Non-Creature, Lands */}
                                    {['creatures', 'noncreature', 'lands'].map(majorGroupId => {
                                        const majorGroup = DECK_CATEGORIES[majorGroupId];
                                        if (!majorGroup) return null;
                                        
                                        // Calculate total from subcategories
                                        const subtypeTotal = majorGroup.categories.reduce((sum, category) => {
                                            return sum + category.subcategories.reduce((catSum, sub) => {
                                                return catSum + (deckData.categories[sub.id] || 0);
                                            }, 0);
                                        }, 0);
                                        
                                        // Add quick total
                                        const quickTotal = deckData.categories[`${majorGroupId}-quick`] || 0;
                                        const groupTotal = subtypeTotal + quickTotal;

                                        return (
                                            <div key={majorGroupId} style={{marginBottom: '1rem'}}>
                                                <button
                                                    onClick={() => setCategoryOpen(prev => ({...prev, [majorGroupId]: !prev[majorGroupId]}))}
                                                    className="btn btn-secondary"
                                                    style={{
                                                        width: '100%',
                                                        display: 'flex',
                                                        justifyContent: 'space-between',
                                                        alignItems: 'center',
                                                        padding: '1rem 1.5rem',
                                                        fontSize: '1rem',
                                                        fontWeight: 600,
                                                        background: categoryOpen[majorGroupId] ? 'var(--bg-tertiary)' : 'var(--bg-secondary)'
                                                    }}
                                                >
                                                    <span style={{display: 'flex', alignItems: 'center', gap: '0.8rem'}}>
                                                        <span>{majorGroup.name}</span>
                                                        <span style={{
                                                            background: 'var(--accent)',
                                                            color: 'white',
                                                            padding: '0.2rem 0.6rem',
                                                            borderRadius: '12px',
                                                            fontSize: '0.85rem',
                                                            fontWeight: 700
                                                        }}>
                                                            {groupTotal}
                                                        </span>
                                                    </span>
                                                    <span style={{fontSize: '1.2rem', transform: categoryOpen[majorGroupId] ? 'rotate(180deg)' : 'rotate(0deg)', transition: 'transform 0.3s'}}>
                                                        ‚ñº
                                                    </span>
                                                </button>

                                                {categoryOpen[majorGroupId] && (
                                                    <div style={{
                                                        marginTop: '0.5rem',
                                                        padding: '1.5rem',
                                                        background: 'var(--bg-tertiary)',
                                                        border: '1px solid var(--border-color)',
                                                        borderRadius: '8px'
                                                    }}>
                                                        {/* QUICK TOTAL INPUT */}
                                                        <div style={{
                                                            background: 'rgba(212, 175, 55, 0.15)',
                                                            border: '2px dashed var(--gold)',
                                                            borderRadius: '12px',
                                                            padding: '1rem',
                                                            marginBottom: '1.5rem'
                                                        }}>
                                                            <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                                                <label style={{fontWeight: 600, color: 'var(--gold)', fontSize: '0.95rem'}}>
                                                                    ‚ö° Quick Total (Skip Subtypes)
                                                                </label>
                                                                {window.innerWidth <= 768 ? (
                                                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(deckData.categories[`${majorGroupId}-quick`]) || 0;
                                                                                if (currentValue > 0) {
                                                                                    const newCategories = {...deckData.categories};
                                                                                    newCategories[`${majorGroupId}-quick`] = currentValue - 1;
                                                                                    setDeckData({...deckData, categories: newCategories});
                                                                                }
                                                                            }}
                                                                            style={{
                                                                                width: '40px',
                                                                                height: '40px',
                                                                                fontSize: '1.2rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--gold)',
                                                                                borderRadius: '6px',
                                                                                color: 'var(--gold)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            ‚àí
                                                                        </button>
                                                                        <input
                                                                            type="number"
                                                                            placeholder="e.g., 34"
                                                                            value={deckData.categories[`${majorGroupId}-quick`] || ''}
                                                                            onChange={(e) => {
                                                                                const newCategories = {...deckData.categories};
                                                                                newCategories[`${majorGroupId}-quick`] = parseInt(e.target.value) || 0;
                                                                                setDeckData({...deckData, categories: newCategories});
                                                                            }}
                                                                            min="0"
                                                                            style={{
                                                                                width: '70px',
                                                                                padding: '0.5rem',
                                                                                fontSize: '0.95rem',
                                                                                borderRadius: '4px',
                                                                                border: '2px solid var(--gold)',
                                                                                background: 'var(--bg-secondary)',
                                                                                color: 'var(--text-primary)',
                                                                                textAlign: 'center',
                                                                                height: '40px'
                                                                            }}
                                                                        />
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(deckData.categories[`${majorGroupId}-quick`]) || 0;
                                                                                const newCategories = {...deckData.categories};
                                                                                newCategories[`${majorGroupId}-quick`] = currentValue + 1;
                                                                                setDeckData({...deckData, categories: newCategories});
                                                                            }}
                                                                            style={{
                                                                                width: '40px',
                                                                                height: '40px',
                                                                                fontSize: '1.2rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--gold)',
                                                                                borderRadius: '6px',
                                                                                color: 'var(--gold)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            +
                                                                        </button>
                                                                    </div>
                                                                ) : (
                                                                    <input
                                                                        type="number"
                                                                        placeholder="e.g., 34"
                                                                        value={deckData.categories[`${majorGroupId}-quick`] || ''}
                                                                        onChange={(e) => {
                                                                            const newCategories = {...deckData.categories};
                                                                            newCategories[`${majorGroupId}-quick`] = parseInt(e.target.value) || 0;
                                                                            setDeckData({...deckData, categories: newCategories});
                                                                        }}
                                                                        min="0"
                                                                        style={{
                                                                            width: '80px',
                                                                            padding: '0.5rem',
                                                                            fontSize: '0.95rem',
                                                                            borderRadius: '4px',
                                                                            border: '2px solid var(--gold)',
                                                                            background: 'var(--bg-secondary)',
                                                                            color: 'var(--text-primary)'
                                                                        }}
                                                                    />
                                                                )}
                                                            </div>
                                                            <small style={{color: 'var(--text-secondary)', display: 'block', lineHeight: '1.4'}}>
                                                                Enter total {majorGroup.name.toLowerCase()} count here if you don't need subtype breakdown
                                                            </small>
                                                        </div>

                                                        {/* SUBCATEGORIES WITH QUICK ENTRY */}
                                                        {majorGroup.categories.map(category => {
                                                            const categoryTotal = category.subcategories.reduce((sum, sub) => {
                                                                return sum + (deckData.categories[sub.id] || 0);
                                                            }, 0);
                                                            
                                                            return (
                                                                <div key={category.id} style={{marginBottom: '1.5rem'}}>
                                                                    <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '0.8rem'}}>
                                                                        <h4 style={{
                                                                            color: 'var(--accent-bright)',
                                                                            fontSize: '1.1rem',
                                                                            fontWeight: 700,
                                                                            textTransform: 'uppercase',
                                                                            letterSpacing: '0.5px',
                                                                            margin: 0
                                                                        }}>
                                                                            {category.name}
                                                                        </h4>
                                                                        {/* Quick entry for this category group */}
                                                                        <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                                                            <span style={{fontSize: '0.75rem', color: 'var(--text-muted)'}}>Quick:</span>
                                                                            {window.innerWidth <= 768 ? (
                                                                                <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                                    <button
                                                                                        type="button"
                                                                                        onClick={(e) => {
                                                                                            e.preventDefault();
                                                                                            const currentValue = parseInt(deckData.categories[`${category.id}-quick`]) || 0;
                                                                                            if (currentValue > 0) {
                                                                                                const newCategories = {...deckData.categories};
                                                                                                newCategories[`${category.id}-quick`] = currentValue - 1;
                                                                                                setDeckData({...deckData, categories: newCategories});
                                                                                            }
                                                                                        }}
                                                                                        style={{
                                                                                            width: '28px',
                                                                                            height: '28px',
                                                                                            fontSize: '1rem',
                                                                                            padding: 0,
                                                                                            background: 'var(--bg-primary)',
                                                                                            border: '1px solid var(--border-color)',
                                                                                            borderRadius: '4px',
                                                                                            color: 'var(--text-primary)',
                                                                                            cursor: 'pointer',
                                                                                            display: 'flex',
                                                                                            alignItems: 'center',
                                                                                            justifyContent: 'center',
                                                                                            fontWeight: 'bold'
                                                                                        }}
                                                                                    >
                                                                                        ‚àí
                                                                                    </button>
                                                                                    <input
                                                                                        type="number"
                                                                                        placeholder="0"
                                                                                        value={deckData.categories[`${category.id}-quick`] || ''}
                                                                                        onChange={(e) => {
                                                                                            const newCategories = {...deckData.categories};
                                                                                            newCategories[`${category.id}-quick`] = parseInt(e.target.value) || 0;
                                                                                            setDeckData({...deckData, categories: newCategories});
                                                                                        }}
                                                                                        min="0"
                                                                                        style={{
                                                                                            width: '50px',
                                                                                            padding: '0.3rem',
                                                                                            fontSize: '0.85rem',
                                                                                            borderRadius: '4px',
                                                                                            border: '1px solid var(--accent)',
                                                                                            background: 'var(--bg-secondary)',
                                                                                            color: 'var(--text-primary)',
                                                                                            textAlign: 'center'
                                                                                        }}
                                                                                    />
                                                                                    <button
                                                                                        type="button"
                                                                                        onClick={(e) => {
                                                                                            e.preventDefault();
                                                                                            const currentValue = parseInt(deckData.categories[`${category.id}-quick`]) || 0;
                                                                                            const newCategories = {...deckData.categories};
                                                                                            newCategories[`${category.id}-quick`] = currentValue + 1;
                                                                                            setDeckData({...deckData, categories: newCategories});
                                                                                        }}
                                                                                        style={{
                                                                                            width: '28px',
                                                                                            height: '28px',
                                                                                            fontSize: '1rem',
                                                                                            padding: 0,
                                                                                            background: 'var(--bg-primary)',
                                                                                            border: '1px solid var(--border-color)',
                                                                                            borderRadius: '4px',
                                                                                            color: 'var(--text-primary)',
                                                                                            cursor: 'pointer',
                                                                                            display: 'flex',
                                                                                            alignItems: 'center',
                                                                                            justifyContent: 'center',
                                                                                            fontWeight: 'bold'
                                                                                        }}
                                                                                    >
                                                                                        +
                                                                                    </button>
                                                                                </div>
                                                                            ) : (
                                                                                <input
                                                                                    type="number"
                                                                                    placeholder="0"
                                                                                    value={deckData.categories[`${category.id}-quick`] || ''}
                                                                                    onChange={(e) => {
                                                                                        const newCategories = {...deckData.categories};
                                                                                        newCategories[`${category.id}-quick`] = parseInt(e.target.value) || 0;
                                                                                        setDeckData({...deckData, categories: newCategories});
                                                                                    }}
                                                                                    min="0"
                                                                                    style={{
                                                                                        width: '60px',
                                                                                        padding: '0.3rem',
                                                                                        fontSize: '0.85rem',
                                                                                        borderRadius: '4px',
                                                                                        border: '1px solid var(--accent)',
                                                                                        background: 'var(--bg-secondary)',
                                                                                        color: 'var(--text-primary)'
                                                                                    }}
                                                                                />
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                    <div style={{
                                                                        display: 'grid',
                                                                        gridTemplateColumns: 'repeat(auto-fill, minmax(180px, 1fr))',
                                                                        gap: '0.5rem'
                                                                    }}>
                                                                        {category.subcategories.map(sub => (
                                                                            <div key={sub.id} style={{
                                                                                display: 'flex',
                                                                                justifyContent: 'space-between',
                                                                                alignItems: 'center',
                                                                                padding: '0.5rem',
                                                                                background: 'var(--bg-secondary)',
                                                                                borderRadius: '4px'
                                                                            }}>
                                                                                <label style={{
                                                                                    fontSize: '0.8rem',
                                                                                    color: 'var(--text-secondary)',
                                                                                    flex: 1
                                                                                }}>
                                                                                    {sub.name}
                                                                                </label>
                                                                                {window.innerWidth <= 768 ? (
                                                                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                                        <button
                                                                                            type="button"
                                                                                            onClick={(e) => {
                                                                                                e.preventDefault();
                                                                                                const currentValue = parseInt(deckData.categories[sub.id]) || 0;
                                                                                                if (currentValue > 0) {
                                                                                                    const newCategories = {...deckData.categories};
                                                                                                    newCategories[sub.id] = currentValue - 1;
                                                                                                    setDeckData({...deckData, categories: newCategories});
                                                                                                }
                                                                                            }}
                                                                                            style={{
                                                                                                width: '28px',
                                                                                                height: '28px',
                                                                                                fontSize: '1rem',
                                                                                                padding: 0,
                                                                                                background: 'var(--bg-primary)',
                                                                                                border: '1px solid var(--border-color)',
                                                                                                borderRadius: '4px',
                                                                                                color: 'var(--text-primary)',
                                                                                                cursor: 'pointer',
                                                                                                display: 'flex',
                                                                                                alignItems: 'center',
                                                                                                justifyContent: 'center',
                                                                                                fontWeight: 'bold'
                                                                                            }}
                                                                                        >
                                                                                            ‚àí
                                                                                        </button>
                                                                                        <input
                                                                                            type="number"
                                                                                            className="small-input"
                                                                                            value={deckData.categories[sub.id] || 0}
                                                                                            onChange={(e) => {
                                                                                                const newCategories = {...deckData.categories};
                                                                                                newCategories[sub.id] = parseInt(e.target.value) || 0;
                                                                                                setDeckData({...deckData, categories: newCategories});
                                                                                            }}
                                                                                            min="0"
                                                                                            style={{
                                                                                                width: '50px',
                                                                                                padding: '0.3rem',
                                                                                                fontSize: '0.85rem',
                                                                                                textAlign: 'center'
                                                                                            }}
                                                                                        />
                                                                                        <button
                                                                                            type="button"
                                                                                            onClick={(e) => {
                                                                                                e.preventDefault();
                                                                                                const currentValue = parseInt(deckData.categories[sub.id]) || 0;
                                                                                                const newCategories = {...deckData.categories};
                                                                                                newCategories[sub.id] = currentValue + 1;
                                                                                                setDeckData({...deckData, categories: newCategories});
                                                                                            }}
                                                                                            style={{
                                                                                                width: '28px',
                                                                                                height: '28px',
                                                                                                fontSize: '1rem',
                                                                                                padding: 0,
                                                                                                background: 'var(--bg-primary)',
                                                                                                border: '1px solid var(--border-color)',
                                                                                                borderRadius: '4px',
                                                                                                color: 'var(--text-primary)',
                                                                                                cursor: 'pointer',
                                                                                                display: 'flex',
                                                                                                alignItems: 'center',
                                                                                                justifyContent: 'center',
                                                                                                fontWeight: 'bold'
                                                                                            }}
                                                                                        >
                                                                                            +
                                                                                        </button>
                                                                                    </div>
                                                                                ) : (
                                                                                    <input
                                                                                        type="number"
                                                                                        className="small-input"
                                                                                        value={deckData.categories[sub.id] || 0}
                                                                                        onChange={(e) => {
                                                                                            const newCategories = {...deckData.categories};
                                                                                            newCategories[sub.id] = parseInt(e.target.value) || 0;
                                                                                            setDeckData({...deckData, categories: newCategories});
                                                                                        }}
                                                                                        min="0"
                                                                                        style={{
                                                                                            width: '60px',
                                                                                            padding: '0.3rem',
                                                                                            fontSize: '0.85rem'
                                                                                        }}
                                                                                    />
                                                                                )}
                                                                            </div>
                                                                        ))}
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>

                                {/* SIDEBOARD SECTION */}
                                <div style={{marginBottom: '2rem'}}>
                                    <button
                                        onClick={() => setSideboardOpen(!sideboardOpen)}
                                        className="btn btn-secondary"
                                        style={{
                                            width: '100%',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center',
                                            padding: '1rem 1.5rem',
                                            fontSize: '1.05rem',
                                            fontWeight: 600
                                        }}
                                    >
                                        <span style={{display: 'flex', alignItems: 'center', gap: '0.8rem'}}>
                                            <span>üìã</span>
                                            <span>Sideboard</span>
                                            <span style={{
                                                background: 'var(--accent)',
                                                color: 'white',
                                                padding: '0.2rem 0.6rem',
                                                borderRadius: '12px',
                                                fontSize: '0.85rem',
                                                fontWeight: 700
                                            }}>
                                                {sideboardTotals.total}
                                            </span>
                                            {sideboardTotals.total > 0 && (
                                                <span style={{fontSize: '0.85rem', color: 'var(--text-muted)', marginLeft: '0.5rem'}}>
                                                    ‚Ä¢ {(() => {
                                                        const creatures = Object.entries(DECK_CATEGORIES.creatures.categories).reduce((sum, [_, category]) => {
                                                            const quick = sideboardQuickInputs[category.id] || 0;
                                                            const detailed = category.subcategories.reduce((s, sub) => s + (sideboardCategories[sub.id] || 0), 0);
                                                            return sum + quick + detailed;
                                                        }, 0);
                                                        const spells = Object.entries(DECK_CATEGORIES.noncreature.categories).reduce((sum, [_, category]) => {
                                                            const quick = sideboardQuickInputs[category.id] || 0;
                                                            const detailed = category.subcategories.reduce((s, sub) => s + (sideboardCategories[sub.id] || 0), 0);
                                                            return sum + quick + detailed;
                                                        }, 0);
                                                        const lands = Object.entries(DECK_CATEGORIES.lands.categories).reduce((sum, [_, category]) => {
                                                            const quick = sideboardQuickInputs[category.id] || 0;
                                                            const detailed = category.subcategories.reduce((s, sub) => s + (sideboardCategories[sub.id] || 0), 0);
                                                            return sum + quick + detailed;
                                                        }, 0);
                                                        
                                                        const parts = [];
                                                        if (creatures > 0) parts.push(`${creatures} creature${creatures !== 1 ? 's' : ''}`);
                                                        if (spells > 0) parts.push(`${spells} spell${spells !== 1 ? 's' : ''}`);
                                                        if (lands > 0) parts.push(`${lands} land${lands !== 1 ? 's' : ''}`);
                                                        return parts.join(', ');
                                                    })()}
                                                </span>
                                            )}
                                        </span>
                                        <span style={{fontSize: '1.2rem', transform: sideboardOpen ? 'rotate(180deg)' : 'rotate(0deg)', transition: 'transform 0.3s'}}>
                                            ‚ñº
                                        </span>
                                    </button>
                                    
                                    {/* Sideboard Summary */}
                                    {sideboardTotals.total > 0 && !sideboardOpen && (
                                        <div style={{
                                            marginTop: '0.8rem',
                                            padding: '1rem',
                                            background: 'rgba(212, 175, 55, 0.1)',
                                            border: '1px solid rgba(212, 175, 55, 0.3)',
                                            borderRadius: '8px'
                                        }}>
                                            <div style={{fontSize: '0.9rem', color: 'var(--text-secondary)', marginBottom: '0.5rem', fontWeight: 600}}>
                                                üí≠ Considering:
                                            </div>
                                            <div style={{display: 'flex', flexWrap: 'wrap', gap: '0.5rem', fontSize: '0.85rem'}}>
                                                {Object.entries(DECK_CATEGORIES).map(([majorGroupId, majorGroup]) => {
                                                    return majorGroup.categories.flatMap(category => 
                                                        category.subcategories
                                                            .filter(sub => sideboardCategories[sub.id] > 0)
                                                            .map(sub => (
                                                                <span key={sub.id} style={{
                                                                    background: 'var(--bg-secondary)',
                                                                    padding: '0.3rem 0.6rem',
                                                                    borderRadius: '12px',
                                                                    color: 'var(--accent-bright)',
                                                                    fontWeight: 500
                                                                }}>
                                                                    {sideboardCategories[sub.id]} {sub.name}
                                                                </span>
                                                            ))
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    )}
                                    
                                    {sideboardOpen && (
                                        <div style={{
                                            marginTop: '1rem',
                                            padding: '1.5rem',
                                            background: 'var(--bg-tertiary)',
                                            border: '1px solid var(--border-color)',
                                            borderRadius: '8px'
                                        }}>
                                            <div style={{
                                                marginBottom: '1.5rem',
                                                padding: '1rem',
                                                background: 'rgba(212, 175, 55, 0.1)',
                                                border: '1px solid var(--accent)',
                                                borderRadius: '6px',
                                                fontSize: '0.9rem',
                                                color: 'var(--text-secondary)'
                                            }}>
                                                <strong style={{color: 'var(--accent-bright)'}}>üí° Sideboard Note:</strong> These cards don't count toward your 100-card deck total. Use this for cards you're considering, alternatives, or format-specific sideboard options.
                                            </div>

                                            {Object.entries(DECK_CATEGORIES).map(([majorGroupId, majorGroup]) => (
                                                <div key={majorGroupId} style={{marginBottom: '1.5rem'}}>
                                                    <h4 style={{
                                                        color: 'var(--accent-bright)',
                                                        marginBottom: '1rem',
                                                        fontSize: '1rem',
                                                        fontWeight: 600,
                                                        textTransform: 'uppercase',
                                                        letterSpacing: '0.5px'
                                                    }}>
                                                        {majorGroup.name}
                                                    </h4>
                                                    
                                                    {majorGroup.categories.map(category => (
                                                        <div key={category.id} style={{marginBottom: '1rem'}}>
                                                            <div style={{
                                                                fontWeight: 600,
                                                                marginBottom: '0.5rem',
                                                                color: 'var(--text-primary)',
                                                                fontSize: '0.9rem'
                                                            }}>
                                                                {category.name}
                                                            </div>
                                                            <div style={{
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                gap: '0.8rem',
                                                                marginBottom: '0.5rem',
                                                                padding: '0.5rem',
                                                                background: 'var(--bg-secondary)',
                                                                borderRadius: '4px'
                                                            }}>
                                                                <span style={{fontSize: '0.75rem', color: 'var(--text-muted)'}}>Quick:</span>
                                                                {window.innerWidth <= 768 ? (
                                                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(sideboardQuickInputs[category.id]) || 0;
                                                                                if (currentValue > 0) {
                                                                                    setSideboardQuickInputs(prev => ({...prev, [category.id]: currentValue - 1}));
                                                                                }
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-primary)',
                                                                                border: '1px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            ‚àí
                                                                        </button>
                                                                        <input
                                                                            type="number"
                                                                            placeholder="0"
                                                                            value={sideboardQuickInputs[category.id] || ''}
                                                                            onChange={(e) => {
                                                                                const val = parseInt(e.target.value) || 0;
                                                                                setSideboardQuickInputs(prev => ({...prev, [category.id]: val}));
                                                                            }}
                                                                            min="0"
                                                                            style={{
                                                                                width: '50px',
                                                                                padding: '0.3rem',
                                                                                fontSize: '0.85rem',
                                                                                borderRadius: '4px',
                                                                                border: '1px solid var(--accent)',
                                                                                background: 'var(--bg-tertiary)',
                                                                                color: 'var(--text-primary)',
                                                                                textAlign: 'center'
                                                                            }}
                                                                        />
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(sideboardQuickInputs[category.id]) || 0;
                                                                                setSideboardQuickInputs(prev => ({...prev, [category.id]: currentValue + 1}));
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-primary)',
                                                                                border: '1px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            +
                                                                        </button>
                                                                    </div>
                                                                ) : (
                                                                    <input
                                                                        type="number"
                                                                        placeholder="0"
                                                                        value={sideboardQuickInputs[category.id] || ''}
                                                                        onChange={(e) => {
                                                                            const val = parseInt(e.target.value) || 0;
                                                                            setSideboardQuickInputs(prev => ({...prev, [category.id]: val}));
                                                                        }}
                                                                        min="0"
                                                                        style={{
                                                                            width: '60px',
                                                                            padding: '0.3rem',
                                                                            fontSize: '0.85rem',
                                                                            borderRadius: '4px',
                                                                            border: '1px solid var(--accent)',
                                                                            background: 'var(--bg-tertiary)',
                                                                            color: 'var(--text-primary)',
                                                                            textAlign: 'center'
                                                                        }}
                                                                    />
                                                                )}
                                                            </div>
                                                            <div style={{
                                                                display: 'grid',
                                                                gridTemplateColumns: 'repeat(auto-fill, minmax(180px, 1fr))',
                                                                gap: '0.5rem'
                                                            }}>
                                                                {category.subcategories.map(sub => (
                                                                    <div key={sub.id} style={{
                                                                        display: 'flex',
                                                                        justifyContent: 'space-between',
                                                                        alignItems: 'center',
                                                                        padding: '0.5rem',
                                                                        background: 'var(--bg-secondary)',
                                                                        borderRadius: '4px'
                                                                    }}>
                                                                        <label style={{
                                                                            fontSize: '0.85rem',
                                                                            color: 'var(--text-secondary)',
                                                                            flex: 1
                                                                        }}>
                                                                            {sub.name}
                                                                        </label>
                                                                        {window.innerWidth <= 768 ? (
                                                                            <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                                <button
                                                                                    type="button"
                                                                                    onClick={(e) => {
                                                                                        e.preventDefault();
                                                                                        const currentValue = parseInt(sideboardCategories[sub.id]) || 0;
                                                                                        if (currentValue > 0) {
                                                                                            updateSideboardCategory(sub.id, currentValue - 1);
                                                                                        }
                                                                                    }}
                                                                                    style={{
                                                                                        width: '28px',
                                                                                        height: '28px',
                                                                                        fontSize: '1rem',
                                                                                        padding: 0,
                                                                                        background: 'var(--bg-primary)',
                                                                                        border: '1px solid var(--border-color)',
                                                                                        borderRadius: '4px',
                                                                                        color: 'var(--text-primary)',
                                                                                        cursor: 'pointer',
                                                                                        display: 'flex',
                                                                                        alignItems: 'center',
                                                                                        justifyContent: 'center',
                                                                                        fontWeight: 'bold'
                                                                                    }}
                                                                                >
                                                                                    ‚àí
                                                                                </button>
                                                                                <input
                                                                                    type="number"
                                                                                    className="small-input"
                                                                                    value={sideboardCategories[sub.id] || 0}
                                                                                    onChange={(e) => updateSideboardCategory(sub.id, e.target.value)}
                                                                                    min="0"
                                                                                    style={{
                                                                                        width: '50px',
                                                                                        padding: '0.3rem',
                                                                                        fontSize: '0.85rem',
                                                                                        textAlign: 'center'
                                                                                    }}
                                                                                />
                                                                                <button
                                                                                    type="button"
                                                                                    onClick={(e) => {
                                                                                        e.preventDefault();
                                                                                        const currentValue = parseInt(sideboardCategories[sub.id]) || 0;
                                                                                        updateSideboardCategory(sub.id, currentValue + 1);
                                                                                    }}
                                                                                    style={{
                                                                                        width: '28px',
                                                                                        height: '28px',
                                                                                        fontSize: '1rem',
                                                                                        padding: 0,
                                                                                        background: 'var(--bg-primary)',
                                                                                        border: '1px solid var(--border-color)',
                                                                                        borderRadius: '4px',
                                                                                        color: 'var(--text-primary)',
                                                                                        cursor: 'pointer',
                                                                                        display: 'flex',
                                                                                        alignItems: 'center',
                                                                                        justifyContent: 'center',
                                                                                        fontWeight: 'bold'
                                                                                    }}
                                                                                >
                                                                                    +
                                                                                </button>
                                                                            </div>
                                                                        ) : (
                                                                            <input
                                                                                type="number"
                                                                                className="small-input"
                                                                                value={sideboardCategories[sub.id] || 0}
                                                                                onChange={(e) => updateSideboardCategory(sub.id, e.target.value)}
                                                                                min="0"
                                                                                style={{
                                                                                    width: '60px',
                                                                                    padding: '0.3rem',
                                                                                    fontSize: '0.85rem'
                                                                                }}
                                                                            />
                                                                        )}
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* MANA BASE CALCULATOR - COLLAPSIBLE */}
                                <div style={{marginBottom: '2rem'}}>
                                    <button
                                        onClick={() => setManaCalcOpen(!manaCalcOpen)}
                                        className="btn btn-secondary"
                                        style={{
                                            width: '100%',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center',
                                            padding: '1rem 1.5rem',
                                            fontSize: '1.05rem',
                                            fontWeight: 600
                                        }}
                                    >
                                        <span style={{display: 'flex', alignItems: 'center', gap: '0.8rem'}}>
                                            <span>‚öóÔ∏è</span>
                                            <span>Mana Base Calculator</span>
                                            <span style={{fontSize: '0.8rem', opacity: 0.7}}>(Optional)</span>
                                        </span>
                                        <span style={{fontSize: '1.2rem', transform: manaCalcOpen ? 'rotate(180deg)' : 'rotate(0deg)', transition: 'transform 0.3s'}}>
                                            ‚ñº
                                        </span>
                                    </button>
                                    
                                    {manaCalcOpen && (
                                <div className="mana-calculator" style={{marginTop: '1rem'}}>
                                    <div className="calculator-title">‚öóÔ∏è Mana Base Calculator</div>
                                    <div style={{fontSize: '0.9rem', color: 'var(--text-secondary)', marginBottom: '1.5rem'}}>
                                        Build your optimal mana base based on your deck's color requirements!
                                    </div>

                                        <div style={{marginBottom: '1.5rem'}}>
                                            <label style={{fontWeight: 600, marginBottom: '0.5rem', display: 'block'}}>
                                                Total Lands in Deck
                                            </label>
                                            {window.innerWidth <= 768 ? (
                                                <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(totalLands) || 0;
                                                            if (currentValue > 0) {
                                                                setTotalLands(currentValue - 1);
                                                            }
                                                        }}
                                                        style={{
                                                            width: '36px',
                                                            height: '36px',
                                                            fontSize: '1.2rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '6px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        ‚àí
                                                    </button>
                                                    <input 
                                                        type="number"
                                                        className="small-input"
                                                        value={totalLands}
                                                        onChange={(e) => setTotalLands(parseInt(e.target.value) || 38)}
                                                        min="0"
                                                        max="99"
                                                        style={{flex: 1, textAlign: 'center', minWidth: '80px'}}
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(totalLands) || 0;
                                                            if (currentValue < 99) {
                                                                setTotalLands(currentValue + 1);
                                                            }
                                                        }}
                                                        style={{
                                                            width: '36px',
                                                            height: '36px',
                                                            fontSize: '1.2rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '6px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        +
                                                    </button>
                                                </div>
                                            ) : (
                                                <input 
                                                    type="number"
                                                    className="small-input"
                                                    value={totalLands}
                                                    onChange={(e) => setTotalLands(parseInt(e.target.value) || 38)}
                                                    min="0"
                                                    max="99"
                                                />
                                            )}
                                            <small style={{color: 'var(--text-muted)', marginLeft: '1rem'}}>
                                                Recommended: 36-38 lands
                                            </small>
                                        </div>

                                        <div style={{marginBottom: '1.5rem'}}>
                                            <label style={{fontWeight: 600, marginBottom: '0.5rem', display: 'block'}}>
                                                Tri-Lands (Triomes & 3+ color lands)
                                            </label>
                                            {window.innerWidth <= 768 ? (
                                                <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(triLands) || 0;
                                                            if (currentValue > 0) {
                                                                setTriLands(currentValue - 1);
                                                            }
                                                        }}
                                                        style={{
                                                            width: '36px',
                                                            height: '36px',
                                                            fontSize: '1.2rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '6px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        ‚àí
                                                    </button>
                                                    <input 
                                                        type="number"
                                                        className="small-input"
                                                        value={triLands}
                                                        onChange={(e) => setTriLands(parseInt(e.target.value) || 0)}
                                                        min="0"
                                                        max="20"
                                                        style={{flex: 1, textAlign: 'center', minWidth: '80px'}}
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(triLands) || 0;
                                                            if (currentValue < 20) {
                                                                setTriLands(currentValue + 1);
                                                            }
                                                        }}
                                                        style={{
                                                            width: '36px',
                                                            height: '36px',
                                                            fontSize: '1.2rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '6px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        +
                                                    </button>
                                                </div>
                                            ) : (
                                                <input 
                                                    type="number"
                                                    className="small-input"
                                                    value={triLands}
                                                    onChange={(e) => setTriLands(parseInt(e.target.value) || 0)}
                                                    min="0"
                                                    max="20"
                                                />
                                            )}
                                            <div style={{marginLeft: '1rem', marginTop: '0.5rem'}}>
                                                <small style={{color: 'var(--text-secondary)', display: 'block', lineHeight: '1.5', marginBottom: '0.3rem', fontSize: '0.8rem'}}>
                                                    <strong>Include:</strong> Triomes (Ketria, Savai, etc.), Panoramas, sac lands that search for 3+ basic types
                                                </small>
                                                <small style={{color: 'var(--accent-bright)', display: 'block', fontStyle: 'italic', fontSize: '0.8rem'}}>
                                                    üí° These subtract from total but provide 3+ colors
                                                </small>
                                            </div>
                                        </div>

                                        <div style={{marginBottom: '1.5rem'}}>
                                            <label style={{fontWeight: 600, marginBottom: '0.5rem', display: 'block'}}>
                                                Other Lands (Colorless & Utility)
                                            </label>
                                            {window.innerWidth <= 768 ? (
                                                <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(otherLands) || 0;
                                                            if (currentValue > 0) {
                                                                setOtherLands(currentValue - 1);
                                                            }
                                                        }}
                                                        style={{
                                                            width: '36px',
                                                            height: '36px',
                                                            fontSize: '1.2rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '6px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        ‚àí
                                                    </button>
                                                    <input 
                                                        type="number"
                                                        className="small-input"
                                                        value={otherLands}
                                                        onChange={(e) => setOtherLands(parseInt(e.target.value) || 0)}
                                                        min="0"
                                                        max="20"
                                                        style={{flex: 1, textAlign: 'center', minWidth: '80px'}}
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            const currentValue = parseInt(otherLands) || 0;
                                                            if (currentValue < 20) {
                                                                setOtherLands(currentValue + 1);
                                                            }
                                                        }}
                                                        style={{
                                                            width: '36px',
                                                            height: '36px',
                                                            fontSize: '1.2rem',
                                                            padding: 0,
                                                            background: 'var(--bg-secondary)',
                                                            border: '2px solid var(--border-color)',
                                                            borderRadius: '6px',
                                                            color: 'var(--text-primary)',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            fontWeight: 'bold'
                                                        }}
                                                    >
                                                        +
                                                    </button>
                                                </div>
                                            ) : (
                                                <input 
                                                    type="number"
                                                    className="small-input"
                                                    value={otherLands}
                                                    onChange={(e) => setOtherLands(parseInt(e.target.value) || 0)}
                                                    min="0"
                                                    max="20"
                                                />
                                            )}
                                            <div style={{marginLeft: '1rem', marginTop: '0.5rem'}}>
                                                <small style={{color: 'var(--text-secondary)', display: 'block', lineHeight: '1.5', marginBottom: '0.3rem', fontSize: '0.8rem'}}>
                                                    <strong>Include:</strong> Command Tower, Reliquary Tower, Wastes, utility lands
                                                </small>
                                                <small style={{color: 'var(--accent-bright)', display: 'block', fontStyle: 'italic', fontSize: '0.8rem'}}>
                                                    üí° Subtract from total but don't provide colored mana
                                                </small>
                                            </div>
                                        </div>

                                        {/* STEP 1: Dual Lands */}
                                        <div style={{
                                            background: 'linear-gradient(135deg, rgba(0, 115, 62, 0.12) 0%, rgba(34, 139, 34, 0.12) 100%)',
                                            border: '3px solid rgba(0, 115, 62, 0.4)',
                                            borderRadius: '12px',
                                            padding: '1.5rem',
                                            marginBottom: '1.5rem'
                                        }}>
                                            <div style={{
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '0.8rem',
                                                marginBottom: '0.5rem'
                                            }}>
                                                <div style={{
                                                    background: 'linear-gradient(135deg, #00733e 0%, #228b22 100%)',
                                                    color: 'white',
                                                    width: '36px',
                                                    height: '36px',
                                                    borderRadius: '50%',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    fontWeight: 700,
                                                    fontSize: '1.15rem'
                                                }}>
                                                    2
                                                </div>
                                                <label style={{fontWeight: 700, fontSize: '1.15rem', color: 'var(--text-primary)', margin: 0}}>
                                                    üèîÔ∏è Count Actual LANDS in Your Deck
                                                </label>
                                            </div>
                                            <div style={{
                                                background: 'rgba(0, 115, 62, 0.15)',
                                                border: '1px solid rgba(0, 115, 62, 0.3)',
                                                borderRadius: '12px',
                                                padding: '1rem',
                                                marginBottom: '1rem',
                                                marginLeft: '2.5rem'
                                            }}>
                                                <div style={{fontWeight: 600, color: 'var(--text-primary)', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
                                                    What to count:
                                                </div>
                                                <div style={{color: 'var(--text-secondary)', fontSize: '0.85rem', lineHeight: '1.6'}}>
                                                    How many <strong>dual lands</strong> (produce or fetch 2 colors) are you running? This is separate from Step 1.
                                                    <br/>
                                                    <strong>Include:</strong> Shocklands, Fetchlands, Pain lands, etc. Example: 4 Temple Gardens + 3 Windswept Heaths = 7 for Selesnya.
                                                </div>
                                            </div>
                                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem', paddingLeft: '2.5rem'}}>
                                                {colorPairs.map(({pair, colors, name}) => (
                                                    <div key={pair}>
                                                        <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.3rem'}}>
                                                            <div className={`pip-icon pip-${colors[0]}`} style={{width: '16px', height: '16px'}}></div>
                                                            <div className={`pip-icon pip-${colors[1]}`} style={{width: '16px', height: '16px'}}></div>
                                                            <span style={{fontSize: '0.85rem'}}>{name}</span>
                                                        </div>
                                                        {window.innerWidth <= 768 ? (
                                                            <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                                                <button
                                                                    type="button"
                                                                    onClick={(e) => {
                                                                        e.preventDefault();
                                                                        const currentValue = parseInt(dualLands[pair]) || 0;
                                                                        if (currentValue > 0) {
                                                                            updateDualLands(pair, (currentValue - 1).toString());
                                                                        }
                                                                    }}
                                                                    style={{
                                                                        width: '36px',
                                                                        height: '36px',
                                                                        fontSize: '1.2rem',
                                                                        padding: 0,
                                                                        background: 'var(--bg-secondary)',
                                                                        border: '2px solid var(--border-color)',
                                                                        borderRadius: '6px',
                                                                        color: 'var(--text-primary)',
                                                                        cursor: 'pointer',
                                                                        display: 'flex',
                                                                        alignItems: 'center',
                                                                        justifyContent: 'center',
                                                                        fontWeight: 'bold'
                                                                    }}
                                                                >
                                                                    ‚àí
                                                                </button>
                                                                <input 
                                                                    type="number"
                                                                    className="small-input"
                                                                    style={{flex: 1, textAlign: 'center'}}
                                                                    value={dualLands[pair]}
                                                                    onChange={(e) => updateDualLands(pair, e.target.value)}
                                                                    min="0"
                                                                />
                                                                <button
                                                                    type="button"
                                                                    onClick={(e) => {
                                                                        e.preventDefault();
                                                                        const currentValue = parseInt(dualLands[pair]) || 0;
                                                                        updateDualLands(pair, (currentValue + 1).toString());
                                                                    }}
                                                                    style={{
                                                                        width: '36px',
                                                                        height: '36px',
                                                                        fontSize: '1.2rem',
                                                                        padding: 0,
                                                                        background: 'var(--bg-secondary)',
                                                                        border: '2px solid var(--border-color)',
                                                                        borderRadius: '6px',
                                                                        color: 'var(--text-primary)',
                                                                        cursor: 'pointer',
                                                                        display: 'flex',
                                                                        alignItems: 'center',
                                                                        justifyContent: 'center',
                                                                        fontWeight: 'bold'
                                                                    }}
                                                                >
                                                                    +
                                                                </button>
                                                            </div>
                                                        ) : (
                                                            <input 
                                                                type="number"
                                                                className="small-input"
                                                                style={{width: '100%'}}
                                                                value={dualLands[pair]}
                                                                onChange={(e) => updateDualLands(pair, e.target.value)}
                                                                min="0"
                                                            />
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Calculate Button */}
                                        {/* STEP 2: Count Mana Pips */}
                                        <div style={{
                                            background: 'linear-gradient(135deg, rgba(66, 135, 245, 0.12) 0%, rgba(136, 106, 234, 0.12) 100%)',
                                            border: '3px solid rgba(66, 135, 245, 0.4)',
                                            borderRadius: '12px',
                                            padding: '1.5rem',
                                            marginBottom: '1.5rem'
                                        }}>
                                            <div style={{
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '0.8rem',
                                                marginBottom: '0.5rem'
                                            }}>
                                                <div style={{
                                                    background: 'linear-gradient(135deg, #4287f5 0%, #886aea 100%)',
                                                    color: 'white',
                                                    width: '36px',
                                                    height: '36px',
                                                    borderRadius: '50%',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    fontWeight: 700,
                                                    fontSize: '1.15rem'
                                                }}>
                                                    1
                                                </div>
                                                <label style={{fontWeight: 700, fontSize: '1.15rem', color: 'var(--text-primary)', margin: 0}}>
                                                    üé¥ Count Mana Pips from Your SPELLS
                                                </label>
                                            </div>
                                            <div style={{
                                                background: 'rgba(66, 135, 245, 0.15)',
                                                border: '1px solid rgba(66, 135, 245, 0.3)',
                                                borderRadius: '12px',
                                                padding: '1rem',
                                                marginBottom: '1rem',
                                                marginLeft: '2.5rem'
                                            }}>
                                                <div style={{fontWeight: 600, color: 'var(--text-primary)', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
                                                    What to count:
                                                </div>
                                                <div style={{color: 'var(--text-secondary)', fontSize: '0.85rem', lineHeight: '1.6'}}>
                                                    Look at <strong>all the spells in your deck</strong> and count colored mana symbols in their costs. Wrath of God = 2 White (double).
                                                    <br/><br/>
                                                    <div style={{
                                                        background: 'rgba(212, 175, 55, 0.15)',
                                                        border: '1px solid rgba(212, 175, 55, 0.3)',
                                                        borderRadius: '6px',
                                                        padding: '0.7rem',
                                                        fontSize: '0.82rem'
                                                    }}>
                                                        <strong style={{color: 'var(--accent-bright)'}}>üß† Smart weighting:</strong> The calculator knows {'{U}{U}'} is harder to cast than {'{1}{U}'}. It weights pips accordingly!
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="pip-counter" style={{overflowX: 'auto'}}>
                                                {['W', 'U', 'B', 'R', 'G'].map(color => (
                                                    <div key={color} className="pip-input-group" style={{minWidth: '160px'}}>
                                                        <div className="pip-label">
                                                            <div className={`pip-icon pip-${color}`}></div>
                                                            <span>{color}</span>
                                                        </div>
                                                        <div style={{marginTop: '0.5rem'}}>
                                                            <div style={{flex: '1 1 50px', minWidth: '50px', marginBottom: '0.5rem'}}>
                                                                <div style={{fontSize: '0.7rem', marginBottom: '0.3rem'}}>Single</div>
                                                                {window.innerWidth <= 768 ? (
                                                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(pipCounts[color].single) || 0;
                                                                                if (currentValue > 0) {
                                                                                    updatePipCount(color, 'single', (currentValue - 1).toString());
                                                                                }
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            ‚àí
                                                                        </button>
                                                                        <input 
                                                                            type="number"
                                                                            className="small-input"
                                                                            style={{flex: 1, padding: '0.5rem', fontSize: '0.95rem', textAlign: 'center', minWidth: '50px', height: '40px'}}
                                                                            value={pipCounts[color].single}
                                                                            onChange={(e) => updatePipCount(color, 'single', e.target.value)}
                                                                            min="0"
                                                                        />
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(pipCounts[color].single) || 0;
                                                                                updatePipCount(color, 'single', (currentValue + 1).toString());
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            +
                                                                        </button>
                                                                    </div>
                                                                ) : (
                                                                    <input 
                                                                        type="number"
                                                                        className="small-input"
                                                                        style={{width: '100%', padding: '0.4rem', fontSize: '0.85rem'}}
                                                                        value={pipCounts[color].single}
                                                                        onChange={(e) => updatePipCount(color, 'single', e.target.value)}
                                                                        min="0"
                                                                    />
                                                                )}
                                                            </div>
                                                            <div style={{flex: '1 1 50px', minWidth: '50px', marginBottom: '0.5rem'}}>
                                                                <div style={{fontSize: '0.7rem', marginBottom: '0.3rem'}}>Double</div>
                                                                {window.innerWidth <= 768 ? (
                                                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(pipCounts[color].double) || 0;
                                                                                if (currentValue > 0) {
                                                                                    updatePipCount(color, 'double', (currentValue - 1).toString());
                                                                                }
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            ‚àí
                                                                        </button>
                                                                        <input 
                                                                            type="number"
                                                                            className="small-input"
                                                                            style={{flex: 1, padding: '0.5rem', fontSize: '0.95rem', textAlign: 'center', minWidth: '50px', height: '40px'}}
                                                                            value={pipCounts[color].double}
                                                                            onChange={(e) => updatePipCount(color, 'double', e.target.value)}
                                                                            min="0"
                                                                        />
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(pipCounts[color].double) || 0;
                                                                                updatePipCount(color, 'double', (currentValue + 1).toString());
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            +
                                                                        </button>
                                                                    </div>
                                                                ) : (
                                                                    <input 
                                                                        type="number"
                                                                        className="small-input"
                                                                        style={{width: '100%', padding: '0.4rem', fontSize: '0.85rem'}}
                                                                        value={pipCounts[color].double}
                                                                        onChange={(e) => updatePipCount(color, 'double', e.target.value)}
                                                                        min="0"
                                                                    />
                                                                )}
                                                            </div>
                                                            <div style={{flex: '1 1 50px', minWidth: '50px', marginBottom: '0.5rem'}}>
                                                                <div style={{fontSize: '0.7rem', marginBottom: '0.3rem'}}>Triple+</div>
                                                                {window.innerWidth <= 768 ? (
                                                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.3rem'}}>
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(pipCounts[color].triple) || 0;
                                                                                if (currentValue > 0) {
                                                                                    updatePipCount(color, 'triple', (currentValue - 1).toString());
                                                                                }
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            ‚àí
                                                                        </button>
                                                                        <input 
                                                                            type="number"
                                                                            className="small-input"
                                                                            style={{flex: 1, padding: '0.5rem', fontSize: '0.95rem', textAlign: 'center', minWidth: '50px', height: '40px'}}
                                                                            value={pipCounts[color].triple}
                                                                            onChange={(e) => updatePipCount(color, 'triple', e.target.value)}
                                                                            min="0"
                                                                        />
                                                                        <button
                                                                            type="button"
                                                                            onClick={(e) => {
                                                                                e.preventDefault();
                                                                                const currentValue = parseInt(pipCounts[color].triple) || 0;
                                                                                updatePipCount(color, 'triple', (currentValue + 1).toString());
                                                                            }}
                                                                            style={{
                                                                                width: '28px',
                                                                                height: '28px',
                                                                                fontSize: '1rem',
                                                                                padding: 0,
                                                                                background: 'var(--bg-secondary)',
                                                                                border: '2px solid var(--border-color)',
                                                                                borderRadius: '4px',
                                                                                color: 'var(--text-primary)',
                                                                                cursor: 'pointer',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                fontWeight: 'bold'
                                                                            }}
                                                                        >
                                                                            +
                                                                        </button>
                                                                    </div>
                                                                ) : (
                                                                    <input 
                                                                        type="number"
                                                                        className="small-input"
                                                                        style={{width: '100%', padding: '0.4rem', fontSize: '0.85rem'}}
                                                                        value={pipCounts[color].triple}
                                                                        onChange={(e) => updatePipCount(color, 'triple', e.target.value)}
                                                                        min="0"
                                                                    />
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <div style={{textAlign: 'center', marginTop: '2rem', marginBottom: '1.5rem'}}>
                                            <button 
                                                className="btn btn-primary"
                                                onClick={calculateManaBase}
                                                style={{
                                                    padding: '0.9rem 2.5rem',
                                                    fontSize: '1.1rem',
                                                    display: 'inline-flex',
                                                    alignItems: 'center',
                                                    gap: '0.7rem'
                                                }}
                                            >
                                                <span style={{fontSize: window.innerWidth <= 768 ? '1.6rem' : '1.3rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)'}}>‚öóÔ∏è</span>
                                                <span>Calculate Mana Base</span>
                                            </button>
                                        </div>


                                        {showResults && manaCalculation && (
                                            <div className="mana-results">
                                                <div style={{fontWeight: 600, fontSize: '1.2rem', marginBottom: '1rem', color: 'var(--gold)'}}>
                                                    üìä Recommended Mana Base
                                                </div>
                                                
                                                {Object.entries(manaCalculation.recommendations).map(([color, data]) => {
                                                    if (data.pips === 0) return null;
                                                    return (
                                                        <div key={color} className="result-item">
                                                            <div className="result-label">
                                                                <div className={`pip-icon pip-${color}`}></div>
                                                                <span>{data.name}</span>
                                                                <small style={{color: 'var(--text-muted)', marginLeft: '0.5rem'}}>
                                                                    ({data.pips} pips, {data.percentage}%)
                                                                </small>
                                                            </div>
                                                            <div style={{textAlign: 'right'}}>
                                                                <div className="result-value">{data.basicsNeeded}</div>
                                                                <small style={{color: 'var(--text-muted)', fontSize: '0.75rem'}}>
                                                                    basics ({data.fromDuals} from duals)
                                                                </small>
                                                            </div>
                                                        </div>
                                                    );
                                                })}

                                                <div style={{marginTop: '1rem', padding: '1rem', background: 'var(--bg-tertiary)', borderRadius: '8px'}}>
                                                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                                        <span>Total Dual Lands:</span>
                                                        <strong>{manaCalculation.totalDuals}</strong>
                                                    </div>
                                                    {manaCalculation.triLands > 0 && (
                                                        <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                                            <span>Tri-Lands (Triomes):</span>
                                                            <strong>{manaCalculation.triLands}</strong>
                                                        </div>
                                                    )}
                                                    {manaCalculation.otherLands > 0 && (
                                                        <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                                            <span>Other Lands (Colorless):</span>
                                                            <strong>{manaCalculation.otherLands}</strong>
                                                        </div>
                                                    )}
                                                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                                        <span>Total Basics Needed:</span>
                                                        <strong>{manaCalculation.totalBasicsNeeded}</strong>
                                                    </div>
                                                    {(totalLands - manaCalculation.totalOccupiedSlots - manaCalculation.totalBasicsNeeded) > 0 && (
                                                        <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem'}}>
                                                            <span>Remaining Slots:</span>
                                                            <strong>{totalLands - manaCalculation.totalOccupiedSlots - manaCalculation.totalBasicsNeeded}</strong>
                                                            <small style={{color: 'var(--text-muted)', marginLeft: '0.5rem'}}>(utility)</small>
                                                        </div>
                                                    )}
                                                    <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                                        <span>Target Land Count:</span>
                                                        <strong>{totalLands}</strong>
                                                    </div>
                                                    <div style={{display: 'flex', justifyContent: 'space-between', marginTop: '0.5rem', paddingTop: '0.5rem', borderTop: '1px solid var(--border-color)'}}>
                                                        <span>Spells Needed for 100:</span>
                                                        <strong style={{color: 'var(--accent-bright)'}}>{100 - totalLands}</strong>
                                                    </div>
                                                    {!manaCalculation.isValid && (
                                                        <div style={{marginTop: '1rem', padding: '0.8rem', background: 'rgba(211, 32, 42, 0.2)', borderRadius: '6px', color: 'var(--red-mana)'}}>
                                                            ‚ö†Ô∏è Warning: You need {manaCalculation.totalBasicsNeeded} basics but only have {manaCalculation.availableForBasics} slots available after all lands!
                                                            <div style={{marginTop: '0.8rem', fontSize: '0.85rem', color: 'var(--text-primary)', background: 'rgba(0, 0, 0, 0.3)', padding: '0.8rem', borderRadius: '4px'}}>
                                                                <strong>Quick Fixes:</strong>
                                                                <div style={{marginTop: '0.5rem', lineHeight: '1.8'}}>
                                                                    ‚Ä¢ Increase total lands to <strong>{totalLands + (manaCalculation.totalBasicsNeeded - manaCalculation.availableForBasics)}</strong> lands<br/>
                                                                    ‚Ä¢ Remove <strong>{manaCalculation.totalBasicsNeeded - manaCalculation.availableForBasics}</strong> colorless/utility lands<br/>
                                                                    ‚Ä¢ Add more dual lands (reduces basics needed)
                                                                </div>
                                                            </div>
                                                        </div>
                                                    )}
                                                    {manaCalculation.isValid && (
                                                        <div style={{marginTop: '1rem', padding: '0.8rem', background: 'rgba(0, 115, 62, 0.2)', borderRadius: '6px', color: 'var(--green-mana)'}}>
                                                            ‚úì Perfect! You have enough land slots for your color requirements.
                                                        </div>
                                                    )}
                                                </div>

                                                {/* Funny Random Quote */}
                                                {randomQuote && (
                                                    <div style={{
                                                        marginTop: '1.5rem',
                                                        padding: '1rem',
                                                        background: 'linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(196, 167, 125, 0.15) 100%)',
                                                        border: '2px solid var(--gold)',
                                                        borderRadius: '10px',
                                                        textAlign: 'center',
                                                        fontSize: '1rem',
                                                        fontStyle: 'italic',
                                                        color: 'var(--text-primary)',
                                                        fontWeight: 500
                                                    }}>
                                                        "{randomQuote}"
                                                    </div>
                                                )}
                                            </div>
                                        )}

                                        {!showResults && (
                                            <div style={{textAlign: 'center', padding: '2rem', color: 'var(--text-muted)'}}>
                                                Fill in your mana requirements above, then click "Calculate Mana Base"!
                                            </div>
                                        )}
                                    </div>
                                    )}
                                </div>

                                {/* Save button - only show if user owns this deck */}
                                <div style={{textAlign: 'center', marginTop: '2rem'}}>
                                    {user && deck && user.uid === deck.userId ? (
                                        <button 
                                            className="btn btn-primary" 
                                            style={{padding: '1rem 3rem', fontSize: '1.1rem'}}
                                            onClick={() => {
                                                setHasUnsavedChanges(false);
                                                onSave({
                                                    ...deckData, 
                                                    notableCards,
                                                    sideboard: sideboardCategories,  // Include sideboard!
                                                    lands: totals.lands,
                                                    creatures: totals.creatures,
                                                    noncreature: totals.noncreature
                                                });
                                            }}
                                        >
                                            üíæ Save Changes
                                        </button>
                                    ) : (
                                        <div style={{
                                            padding: '1rem',
                                            background: 'rgba(66, 135, 245, 0.1)',
                                            borderRadius: '12px',
                                            color: 'var(--text-secondary)',
                                            fontSize: '0.95rem',
                                            fontStyle: 'italic'
                                        }}>
                                            üë§ This is {deck?.userId ? 'another user\'s' : 'an example'} deck. Use "Build Similar Deck" to create your own version!
                                        </div>
                                    )}
                                </div>
                            </div>

                            <div className="stats-panel">
                                <div 
                                    style={{
                                        display: 'flex', 
                                        justifyContent: 'space-between', 
                                        alignItems: 'center', 
                                        marginBottom: '1rem', 
                                        cursor: window.innerWidth <= 768 ? 'pointer' : 'default', 
                                        padding: window.innerWidth <= 768 ? '1.5rem' : '0', 
                                        background: window.innerWidth <= 768 ? 'linear-gradient(135deg, rgba(212, 175, 55, 0.25) 0%, rgba(139, 111, 71, 0.15) 100%)' : 'transparent', 
                                        borderRadius: '12px',
                                        border: window.innerWidth <= 768 ? '3px solid var(--gold)' : 'none',
                                        boxShadow: window.innerWidth <= 768 ? '0 4px 12px rgba(212, 175, 55, 0.3)' : 'none',
                                        transition: 'all 0.2s ease'
                                    }} 
                                    onClick={() => window.innerWidth <= 768 && setStatsExpanded(!statsExpanded)}
                                    onTouchStart={(e) => {
                                        if (window.innerWidth <= 768) {
                                            e.currentTarget.style.transform = 'scale(0.98)';
                                        }
                                    }}
                                    onTouchEnd={(e) => {
                                        if (window.innerWidth <= 768) {
                                            e.currentTarget.style.transform = 'scale(1)';
                                        }
                                    }}
                                >
                                    <h3 style={{fontFamily: 'Pirata One, cursive', color: 'var(--gold)', margin: 0, fontSize: window.innerWidth <= 768 ? '1.6rem' : '1.3rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)'}}>
                                        üìä Live Deck Stats {window.innerWidth <= 768 && `(${statsExpanded ? 'Tap to Hide' : 'Tap to View'})`}
                                    </h3>
                                    {window.innerWidth <= 768 && (
                                        <span style={{fontSize: '2rem', textShadow: '2px 2px 4px rgba(0,0,0,0.5)', color: 'var(--gold)', transition: 'transform 0.3s', transform: statsExpanded ? 'rotate(180deg)' : 'rotate(0deg)'}}>‚ñ≤</span>
                                    )}
                                </div>
                                {(window.innerWidth > 768 || statsExpanded) && (
                                <div style={{
                                    maxHeight: window.innerWidth <= 768 ? '60vh' : 'none',
                                    overflowY: window.innerWidth <= 768 ? 'auto' : 'visible',
                                    padding: window.innerWidth <= 768 ? '0.5rem' : '0'
                                }}>

                                <div style={{background: 'var(--bg-tertiary)', padding: '1rem', borderRadius: '12px', marginBottom: '1rem'}}>
                                    <div style={{fontWeight: 600, marginBottom: '0.5rem'}}>üèû Lands</div>
                                    <div style={{fontSize: '2rem', fontWeight: 700, color: 'var(--accent-bright)'}}>{totals.lands}</div>
                                </div>

                                <div style={{background: 'var(--bg-tertiary)', padding: '1rem', borderRadius: '12px', marginBottom: '1rem'}}>
                                    <div style={{fontWeight: 600, marginBottom: '0.5rem'}}>üßü Creatures</div>
                                    <div style={{fontSize: '2rem', fontWeight: 700, color: 'var(--accent-bright)'}}>{totals.creatures}</div>
                                </div>

                                <div style={{background: 'var(--bg-tertiary)', padding: '1rem', borderRadius: '12px', marginBottom: '1rem'}}>
                                    <div style={{fontWeight: 600, marginBottom: '0.5rem'}}>‚ö° Non-Creature</div>
                                    <div style={{fontSize: '2rem', fontWeight: 700, color: 'var(--accent-bright)'}}>{totals.noncreature}</div>
                                </div>

                                {/* Quick Totals (Category-level) */}
                                <div style={{background: 'var(--bg-secondary)', padding: '1rem', borderRadius: '12px', marginBottom: '1rem', border: '1px solid rgba(212, 175, 55, 0.5)'}}>
                                    <div style={{fontWeight: 600, marginBottom: '1rem', color: 'var(--gold)', fontSize: '0.9rem'}}>‚ö° Quick Totals</div>
                                    
                                    {Object.entries(DECK_CATEGORIES).map(([majorGroupId, majorGroup]) => {
                                        const quickCounts = [];
                                        
                                        // Major quick total
                                        const majorQuick = deckData.categories[`${majorGroupId}-quick`] || 0;
                                        if (majorQuick > 0) {
                                            quickCounts.push({ name: `Total ${majorGroup.name.replace(/[üèûüßü‚ö°]/g, '').trim()}`, count: majorQuick });
                                        }
                                        
                                        // Category group quick totals + detailed subtypes
                                        majorGroup.categories.forEach(category => {
                                            const catQuick = deckData.categories[`${category.id}-quick`] || 0;
                                            
                                            // Calculate detailed subtypes total for this category
                                            const catDetailed = category.subcategories.reduce((sum, sub) => {
                                                return sum + (deckData.categories[sub.id] || 0);
                                            }, 0);
                                            
                                            const catTotal = catQuick + catDetailed;
                                            
                                            if (catTotal > 0) {
                                                quickCounts.push({ 
                                                    name: category.name, 
                                                    count: catTotal,
                                                    quick: catQuick,
                                                    detailed: catDetailed
                                                });
                                            }
                                        });
                                        
                                        if (quickCounts.length === 0) return null;
                                        
                                        return (
                                            <div key={majorGroupId} style={{marginBottom: '1rem'}}>
                                                <div style={{fontSize: '0.75rem', color: 'var(--text-muted)', marginBottom: '0.5rem', textTransform: 'uppercase'}}>
                                                    {majorGroup.icon} {majorGroup.name.replace(/[üèûüßü‚ö°]/g, '').trim()}
                                                </div>
                                                <div style={{fontSize: '0.85rem', lineHeight: '1.8', color: 'var(--text-secondary)'}}>
                                                    {quickCounts.map((item, idx) => (
                                                        <div key={idx} style={{marginBottom: '0.5rem'}}>
                                                            <div style={{display: 'flex', justifyContent: 'space-between', padding: '0.3rem 0.5rem', background: 'rgba(212, 175, 55, 0.1)', borderRadius: '4px'}}>
                                                                <span>{item.name}</span>
                                                                <strong style={{color: 'var(--gold)'}}>{item.count}</strong>
                                                            </div>
                                                            {(item.quick > 0 || item.detailed > 0) && (item.quick > 0 && item.detailed > 0) && (
                                                                <div style={{fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '0.2rem', marginLeft: '0.5rem', fontStyle: 'italic'}}>
                                                                    (Quick: {item.quick} + Detailed: {item.detailed})
                                                                </div>
                                                            )}
                                                            {item.quick > 0 && item.detailed === 0 && (
                                                                <div style={{fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '0.2rem', marginLeft: '0.5rem', fontStyle: 'italic'}}>
                                                                    (Quick input only)
                                                                </div>
                                                            )}
                                                            {item.quick === 0 && item.detailed > 0 && (
                                                                <div style={{fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '0.2rem', marginLeft: '0.5rem', fontStyle: 'italic'}}>
                                                                    (From detailed subtypes)
                                                                </div>
                                                            )}
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })}
                                    
                                    {!Object.keys(deckData.categories).some(key => key.includes('-quick') && deckData.categories[key] > 0) && (
                                        <div style={{textAlign: 'center', color: 'var(--text-muted)', fontSize: '0.85rem', padding: '1rem'}}>
                                            No quick totals entered yet
                                        </div>
                                    )}
                                </div>

                                {/* Detailed Subtypes */}
                                <div style={{background: 'var(--bg-secondary)', padding: '1rem', borderRadius: '12px', marginBottom: '1rem', border: '1px solid var(--border-color)'}}>
                                    <div style={{fontWeight: 600, marginBottom: '1rem', color: 'var(--accent-bright)', fontSize: '0.9rem'}}>üìä Key Subtypes</div>
                                    
                                    {Object.entries(DECK_CATEGORIES).map(([majorGroupId, majorGroup]) => {
                                        const subtypeCounts = [];
                                        majorGroup.categories.forEach(category => {
                                            category.subcategories.forEach(sub => {
                                                const count = deckData.categories[sub.id] || 0;
                                                if (count > 0) {
                                                    subtypeCounts.push({ name: sub.name, count });
                                                }
                                            });
                                        });
                                        
                                        if (subtypeCounts.length === 0) return null;
                                        
                                        return (
                                            <div key={majorGroupId} style={{marginBottom: '1rem'}}>
                                                <div style={{fontSize: '0.75rem', color: 'var(--text-muted)', marginBottom: '0.5rem', textTransform: 'uppercase'}}>
                                                    {majorGroup.icon} {majorGroup.name.replace(/[üèûüßü‚ö°]/g, '').trim()}
                                                </div>
                                                <div style={{fontSize: '0.85rem', lineHeight: '1.8', color: 'var(--text-secondary)'}}>
                                                    {subtypeCounts.slice(0, 5).map((item, idx) => (
                                                        <div key={idx} style={{display: 'flex', justifyContent: 'space-between', marginBottom: '0.3rem'}}>
                                                            <span>{item.name}</span>
                                                            <strong style={{color: 'var(--accent-bright)'}}>{item.count}</strong>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })}
                                    
                                    {!Object.entries(DECK_CATEGORIES).some(([majorGroupId, majorGroup]) => {
                                        return majorGroup.categories.some(category => {
                                            return category.subcategories.some(sub => (deckData.categories[sub.id] || 0) > 0);
                                        });
                                    }) && (
                                        <div style={{textAlign: 'center', color: 'var(--text-muted)', fontSize: '0.85rem', padding: '1rem'}}>
                                            No detailed subtypes entered yet
                                        </div>
                                    )}
                                </div>

                                {/* Sideboard Totals */}
                                {sideboardTotals.total > 0 && (
                                    <div style={{background: 'var(--bg-secondary)', padding: '1rem', borderRadius: '12px', marginBottom: '1rem', border: '2px solid rgba(139, 69, 19, 0.7)'}}>
                                        <div style={{fontWeight: 700, marginBottom: '1rem', color: 'var(--accent-bright)', fontSize: '1rem'}}>üì¶ Sideboard (Total: {sideboardTotals.total})</div>
                                        <div style={{display: 'flex', flexDirection: 'column', gap: '0.5rem', fontSize: '0.9rem'}}>
                                            <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                                <span>üßü Creatures:</span>
                                                <span style={{fontWeight: 600, color: 'var(--accent-bright)'}}>{sideboardTotals.creatures}</span>
                                            </div>
                                            <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                                <span>‚ö° Non-Creature:</span>
                                                <span style={{fontWeight: 600, color: 'var(--accent-bright)'}}>{sideboardTotals.noncreature}</span>
                                            </div>
                                            <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                                <span>üåç Lands:</span>
                                                <span style={{fontWeight: 600, color: 'var(--accent-bright)'}}>{sideboardTotals.lands}</span>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                <div style={{
                                    background: 'var(--gradient-card)', 
                                    border: `2px solid ${totals.total === 100 ? 'var(--green-mana)' : totals.total > 100 ? 'var(--red-mana)' : 'var(--border-color)'}`,
                                    borderRadius: '12px',
                                    padding: '1.5rem',
                                    textAlign: 'center',
                                    marginTop: '1.5rem'
                                }}>
                                    <div style={{fontSize: '0.9rem', marginBottom: '0.5rem', color: 'var(--text-secondary)'}}>
                                        Total Cards
                                    </div>
                                    <div style={{
                                        fontSize: '3rem',
                                        fontWeight: 700,
                                        color: totals.total === 100 ? 'var(--green-mana)' : totals.total > 100 ? 'var(--red-mana)' : 'var(--accent-bright)'
                                    }}>
                                        {totals.total} / 100
                                    </div>
                                    {totals.total === 100 && (
                                        <div style={{marginTop: '0.5rem', color: 'var(--green-mana)'}}>‚úì Perfect!</div>
                                    )}
                                    {totals.total > 100 && (
                                        <div style={{marginTop: '0.5rem', color: 'var(--red-mana)'}}>‚ö† {totals.total - 100} over</div>
                                    )}
                                    {totals.total < 100 && totals.total > 0 && (
                                        <div style={{marginTop: '0.5rem', color: 'var(--text-muted)'}}>{100 - totals.total} remaining</div>
                                    )}
                                </div>
                            </div>)}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>


</body>
</html>
